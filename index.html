<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHEF DSKIM SYSTEM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --bg: #f5f7fa;
            --white: #ffffff;
            --border: #e1e4e8;
            --text-main: #222;
            --point-blue: #3498db;
            --point-red: #e74c3c;
            --point-green: #27ae60;
        }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: var(--text-main); padding-bottom: 80px; }
        
        .app-header { background: url('https://images.unsplash.com/photo-1556910103-1c02745a30bf?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80') center/cover; height: 160px; position: relative; display: flex; align-items: flex-end; padding: 20px; }
        .header-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.8)); }
        .header-content { position: relative; z-index: 1; color: white; }
        .header-title { font-size: 24px; font-weight: 700; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .header-sub { font-size: 13px; opacity: 0.9; margin-top: 5px; font-weight: 300; }
        .container { max-width: 600px; margin: 0 auto; }
        
        .shortcut-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px 5px; background: var(--white); padding: 25px 10px; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-radius: 0 0 20px 20px; }
        .shortcut-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .icon-box { width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: white; margin-bottom: 8px; box-shadow: 0 3px 6px rgba(0,0,0,0.15); }
        .shortcut-label { font-size: 11px; font-weight: 500; color: #444; }

        .workspace { display: none; background: var(--bg); min-height: 100vh; }
        .page-header { padding: 15px 20px; background: var(--white); border-bottom: 1px solid var(--border); display: flex; align-items: center; position: sticky; top: 0; z-index: 50; }
        .back-btn { border: none; background: none; font-size: 20px; margin-right: 15px; cursor: pointer; color: var(--text-main); }
        .page-name { font-size: 18px; font-weight: 700; color: var(--primary); }
        .detail-container { padding: 15px; }
        
        .console-box { background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .console-input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; outline: none; }
        .console-btn { padding: 0 15px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }

        /* ì¼ì •/ê³µì§€ ìŠ¤íƒ€ì¼ (ë²„íŠ¼ ì¶”ê°€ë¨) */
        .schedule-item { background: white; padding: 15px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; }
        .schedule-left { display: flex; align-items: center; flex: 1; }
        .schedule-date { background: #f0f7ff; color: var(--point-blue); padding: 8px 12px; border-radius: 8px; font-weight: bold; font-size: 13px; margin-right: 15px; text-align: center; min-width: 40px; }
        .schedule-type { font-size: 11px; color: #888; border: 1px solid #ddd; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
        .item-actions { display: flex; gap: 10px; margin-left: 10px; }
        .action-icon { color: #aaa; cursor: pointer; font-size: 14px; }
        .action-icon:hover { color: var(--primary); }
        .action-icon.delete:hover { color: var(--point-red); }

        .notice-item { background: white; border-bottom: 1px solid #eee; }
        .notice-head { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .notice-badge { font-size: 11px; font-weight: bold; padding: 3px 6px; border-radius: 4px; margin-right: 8px; }
        .notice-badge.urgent { background: #ffeaea; color: var(--point-red); }
        .notice-badge.normal { background: #eee; color: #555; }
        .notice-body { display: none; padding: 15px; background: #fafafa; border-top: 1px solid #eee; font-size: 14px; line-height: 1.6; white-space: pre-wrap; color: #444; }
        .notice-item.active .notice-body { display: block; }
        
        .input-form { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; display: none; }
        .form-row { margin-bottom: 10px; }
        .form-label { display: block; font-size: 12px; color: #666; margin-bottom: 4px; }
        .form-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; outline: none; }
        .form-select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; background: white; }

        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ë“¤ (ë‹¬ë ¥, ë ˆì‹œí”¼ ë“±) */
        .calendar-wrap { background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .cal-header { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 15px; }
        .cal-select { font-size: 18px; font-weight: bold; border: none; background: transparent; padding: 5px; cursor: pointer; outline: none; border-bottom: 2px solid transparent; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .cal-day-name { font-size: 12px; color: #888; padding-bottom: 5px; }
        .cal-day { height: 60px; border: 1px solid #eee; border-radius: 4px; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; padding-top: 5px; cursor: pointer; }
        .cal-day.today { border: 1px solid var(--point-blue); background: #f0f7ff; }
        .cal-num { font-size: 11px; margin-bottom: 2px; }
        .cal-val { font-size: 10px; font-weight: bold; color: var(--point-blue); word-break: break-all; }
        .cal-input-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 200; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 80%; max-width: 300px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .modal-input { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; margin: 15px 0; outline: none; text-align: right; }
        .total-box { background: var(--primary); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .data-table { width: 100%; border-collapse: collapse; background: white; font-size: 13px; }
        .data-table th { background: #f8f9fa; padding: 10px; border-bottom: 2px solid #ddd; text-align: left; }
        .data-table td { padding: 12px 10px; border-bottom: 1px solid #eee; }
        .mode-tabs { display: flex; background: #f0f0f0; border-radius: 8px; padding: 4px; margin-bottom: 15px; }
        .mode-tab { flex: 1; border: none; background: none; padding: 8px; font-size: 13px; font-weight: bold; color: #777; cursor: pointer; border-radius: 6px; }
        .mode-tab.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .recipe-card { background: white; border-radius: 12px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid #eee; }
        .recipe-head { background: var(--primary); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .recipe-name { font-size: 18px; font-weight: bold; }
        .recipe-body { padding: 20px; }
        .recipe-step { margin-bottom: 15px; border-bottom: 1px dashed #eee; padding-bottom: 15px; }
        .rnd-card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); display: flex; gap: 15px; }
        .rnd-thumb { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .rnd-info { flex: 1; }
        .manual-item { background: white; border-bottom: 1px solid #eee; }
        .manual-header { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 500; }
        .manual-body { display: none; padding: 15px; background: #fafafa; border-top: 1px solid #eee; }
        .manual-item.active .manual-body { display: block; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; color: #999; font-size: 10px; cursor: pointer; flex: 1; }
        .nav-btn.active { color: var(--primary); font-weight: bold; }
        .nav-btn i { font-size: 20px; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div id="main-view">
        <div class="app-header">
            <div class="header-overlay"></div>
            <div class="header-content"><h1 class="header-title">CHEF DSKIM</h1><div class="header-sub">Professional Kitchen Management</div></div>
        </div>
        <div class="container">
            <div class="shortcut-grid">
                <div class="shortcut-item" onclick="openModule('100')"><div class="icon-box" style="background:#f39c12"><i class="fas fa-book-open"></i></div><span class="shortcut-label">ë ˆì‹œí”¼</span></div>
                <div class="shortcut-item" onclick="openModule('400')"><div class="icon-box" style="background:#9b59b6"><i class="fas fa-flask"></i></div><span class="shortcut-label">ì—°êµ¬ë…¸íŠ¸</span></div>
                <div class="shortcut-item" onclick="openModule('010')"><div class="icon-box" style="background:#34495e"><i class="fas fa-boxes"></i></div><span class="shortcut-label">ìì‚°/ì¬ê³ </span></div>
                <div class="shortcut-item" onclick="openModule('020')"><div class="icon-box" style="background:#e74c3c"><i class="fas fa-chart-line"></i></div><span class="shortcut-label">ì†ìµê´€ë¦¬</span></div>
                <div class="shortcut-item" onclick="openModule('030')"><div class="icon-box" style="background:#27ae60"><i class="fas fa-graduation-cap"></i></div><span class="shortcut-label">ì§ì›êµìœ¡</span></div>
                <div class="shortcut-item" onclick="openModule('900')"><div class="icon-box" style="background:#3498db"><i class="fas fa-folder-open"></i></div><span class="shortcut-label">ìë£Œì‹¤</span></div>
                <div class="shortcut-item" onclick="openModule('500')"><div class="icon-box" style="background:#e67e22"><i class="fas fa-calendar-alt"></i></div><span class="shortcut-label">ì¼ì •</span></div>
                <div class="shortcut-item" onclick="openModule('600')"><div class="icon-box" style="background:#7f8c8d"><i class="fas fa-bullhorn"></i></div><span class="shortcut-label">ê³µì§€ì‚¬í•­</span></div>
            </div>
            <div style="padding: 10px 20px; font-weight: bold; color: #333; display: flex; justify-content: space-between;"><span>ìµœì‹  ì—°êµ¬ ê¸°ë¡</span><span style="font-size:12px; color:#888; font-weight:normal;" onclick="openModule('400')">ë”ë³´ê¸° ></span></div>
            <div id="recent-rnd" style="padding: 0 20px;"></div>
        </div>
    </div>

    <div id="workspace-500" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ë§¤ì¥ ì¼ì •</span></div>
        <div class="detail-container">
            <button onclick="openSchForm()" class="console-btn" style="width:100%; margin-bottom:15px;">+ ì¼ì • ì¶”ê°€í•˜ê¸°</button>
            <div id="schedule-form" class="input-form">
                <input type="hidden" id="sch-row"> <div class="form-row"><label class="form-label">ë‚ ì§œ</label><input type="date" id="sch-date" class="form-input"></div>
                <div class="form-row"><label class="form-label">êµ¬ë¶„</label><select id="sch-type" class="form-select"><option>íœ´ë¬´</option><option>ì˜ˆì•½</option><option>í–‰ì‚¬</option><option>ê¸°íƒ€</option></select></div>
                <div class="form-row"><label class="form-label">ë‚´ìš©</label><input type="text" id="sch-content" class="form-input" placeholder="ì¼ì • ë‚´ìš©"></div>
                <div style="display:flex; gap:10px;"><button class="console-btn" style="flex:1; background:#ccc;" onclick="document.getElementById('schedule-form').style.display='none'">ì·¨ì†Œ</button><button id="sch-save-btn" class="console-btn" style="flex:1;" onclick="saveSchedule()">ì €ì¥</button></div>
            </div>
            <div id="schedule-list"></div>
        </div>
    </div>

    <div id="workspace-600" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ê³µì§€ì‚¬í•­</span></div>
        <div class="detail-container">
            <button onclick="openNotForm()" class="console-btn" style="width:100%; margin-bottom:15px;">+ ê³µì§€ ì“°ê¸°</button>
            <div id="notice-form" class="input-form">
                <input type="hidden" id="not-row"> <div class="form-row"><label class="form-label">ì¤‘ìš”ë„</label><select id="not-type" class="form-select"><option value="ì¼ë°˜">ì¼ë°˜</option><option value="í•„ë…">í•„ë…</option></select></div>
                <div class="form-row"><label class="form-label">ì œëª©</label><input type="text" id="not-title" class="form-input" placeholder="ì œëª©"></div>
                <div class="form-row"><label class="form-label">ë‚´ìš©</label><textarea id="not-content" class="form-input" rows="4" placeholder="ë‚´ìš©"></textarea></div>
                <div style="display:flex; gap:10px;"><button class="console-btn" style="flex:1; background:#ccc;" onclick="document.getElementById('notice-form').style.display='none'">ì·¨ì†Œ</button><button id="not-save-btn" class="console-btn" style="flex:1;" onclick="saveNotice()">ì €ì¥</button></div>
            </div>
            <div id="notice-list"></div>
        </div>
    </div>

    <div id="workspace-010" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ìì‚° ë° ì¬ê³ </span></div>
        <div class="detail-container">
            <div class="console-box">
                <div style="font-size:12px; font-weight:bold; margin-bottom:10px; color:#555;">ğŸ“‹ ì…ì¶œê³  ë° ì¬ê³ í™•ì¸</div>
                <div class="mode-tabs">
                    <button id="tab-in" class="mode-tab active" onclick="setMode('in')">ğŸ“¥ ë§¤ì…</button>
                    <button id="tab-out" class="mode-tab" onclick="setMode('out')">ğŸ“¤ ì¶œê³ </button>
                    <button id="tab-stock" class="mode-tab" onclick="setMode('stock')">ğŸ“¦ ì¬ê³ í™•ì¸</button>
                </div>
                <div id="input-area">
                    <div style="display:flex; gap:8px; margin-bottom:10px;"><input type="text" id="searchInput" class="console-input" style="flex:1;" placeholder="í’ˆëª©ëª… ì…ë ¥"><button class="console-btn" id="searchBtn">ì°¾ê¸°</button></div>
                    <div id="search-result" style="margin-bottom:10px;"></div>
                    <div class="staging-list" id="saved-list"><div style="text-align:center; color:#ccc; font-size:12px; padding-top:15px;">ëª©ë¡ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤</div></div>
                    <button class="save-btn" onclick="saveToSheet()" style="width:100%; padding:12px; background:var(--primary); color:white; border:none; border-radius:8px;">ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
                </div>
            </div>
            <div class="total-box"><div style="font-size:13px; opacity:0.8;">í˜„ì¬ ì´ ì¬ê³  ìì‚°</div><div id="asset-value" style="font-size:28px; font-weight:bold;">0 ì›</div></div>
            <h4 style="margin: 20px 0 10px 0;">ğŸ“¦ ìƒì„¸ ë‚´ì—­</h4>
            <div id="stock-list-area"></div>
        </div>
    </div>
    <div id="workspace-020" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ì†ìµ ë° ì›ê°€</span></div>
        <div class="detail-container">
            <div class="calendar-wrap">
                <div class="cal-header"><select id="cal-year" class="cal-select" onchange="changeCalendarMonth()"></select>ë…„ <select id="cal-month" class="cal-select" onchange="changeCalendarMonth()"></select>ì›”</div>
                <div class="cal-grid" id="calendar-grid"></div>
            </div>
            <div class="total-box" style="background:#2c3e50;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span id="display-month-title">ì›” ë§¤ì¶œ í•©ê³„</span> <span id="fin-current" style="font-weight:bold;">0</span></div>
                <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:12px; opacity:0.8;"><span>(ê³ ì •ë¹„+ë³€ë™ë¹„)</span> <span id="fin-cost">0</span></div>
                <div style="display:flex; justify-content:space-between; color:#e74c3c; background:white; padding:10px; border-radius:8px; margin-top:10px;"><span style="color:#333;">ìˆœì´ìµ</span> <span id="fin-profit" style="font-weight:bold; font-size:18px;">0</span></div>
            </div>
            <h4 style="margin: 20px 0 10px 0;">ğŸ“Š ë©”ë‰´ë³„ ì›ê°€ìœ¨</h4>
            <div id="menu-cost-area"></div>
        </div>
    </div>
    <div id="sales-modal" class="cal-input-modal">
        <div class="modal-content">
            <h3 id="modal-date" style="margin-top:0;">DATE</h3>
            <div style="font-size:12px; color:#888; margin-bottom:5px;">ë§¤ì¶œì•¡ ì…ë ¥ (ì—”í„° ì €ì¥)</div>
            <input type="number" id="modal-amount" class="modal-input" placeholder="0">
            <div style="display:flex; gap:10px;"><button class="console-btn" style="flex:1; background:#ccc;" onclick="closeModal()">ì·¨ì†Œ</button><button class="console-btn" style="flex:1;" onclick="saveSales()">ì €ì¥</button></div>
        </div>
    </div>
    <div id="workspace-100" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">í‘œì¤€ ë ˆì‹œí”¼</span></div>
        <div style="padding:15px; background:white; border-bottom:1px solid #eee; display:flex; gap:10px;"><input type="text" id="recipeInput" class="console-input" style="flex:1;" placeholder="ë©”ë‰´ëª…"><button class="console-btn" onclick="loadRecipe()">ê²€ìƒ‰</button></div>
        <div id="recipe-list-area" class="detail-container"></div>
    </div>
    <div id="workspace-400" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">R&D ì—°êµ¬ë…¸íŠ¸</span></div>
        <div style="height:400px; border-bottom:1px solid #eee;"><iframe id="google-form-frame" style="width:100%; height:100%; border:none;"></iframe></div>
        <div style="padding:15px; display:flex; justify-content:space-between; align-items:center; background:#f9f9f9;"><span style="font-weight:bold;">ê¸°ë¡ ëª©ë¡</span><button onclick="loadRnD()" style="font-size:11px; padding:5px; border:1px solid #ddd; background:white;">ìƒˆë¡œê³ ì¹¨</button></div>
        <div id="rnd-list-area" class="detail-container"></div>
    </div>
    <div id="workspace-030" class="workspace"><div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ì§ì› êµìœ¡</span></div><div id="manual-list-area"></div></div>
    <div id="workspace-900" class="workspace"><div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ìë£Œì‹¤</span></div><div style="text-align:center; padding:20px; color:#666; font-size:13px; background:#f0f7ff;"><i class="fab fa-google-drive"></i> Drive ì—°ë™</div><div id="archive-list-area"></div></div>

    <div class="bottom-nav">
        <div class="nav-btn active" onclick="goMain()"><i class="fas fa-home"></i><span>í™ˆ</span></div>
        <div class="nav-btn" onclick="openModule('100')"><i class="fas fa-book"></i><span>ë ˆì‹œí”¼</span></div>
        <div class="nav-btn" onclick="openModule('400')"><i class="fas fa-flask"></i><span>ì—°êµ¬</span></div>
        <div class="nav-btn" onclick="openModule('900')"><i class="fas fa-folder"></i><span>ìë£Œì‹¤</span></div>
        <div class="nav-btn" onclick="openModule('010')"><i class="fas fa-bars"></i><span>ê´€ë¦¬</span></div>
    </div>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSejJy628hEvS5_0QpukHJsFJF228YCEBgW0W6BDutfpjm-UDQ/viewform?embedded=true"; 
        
        let currentMode = 'in';

        function goMain() { document.querySelectorAll('.workspace').forEach(e=>e.style.display='none'); document.getElementById('main-view').style.display='block'; window.scrollTo(0,0); updateNav('í™ˆ'); }
        function openModule(code) {
            document.getElementById('main-view').style.display='none'; document.querySelectorAll('.workspace').forEach(e=>e.style.display='none');
            
            if(code==='010'){ document.getElementById('workspace-010').style.display='block'; loadAssetValueOnly(); setMode('in'); updateNav('ê´€ë¦¬'); }
            else if(code==='020'){ document.getElementById('workspace-020').style.display='block'; initCalendar(); updateNav('ê´€ë¦¬'); }
            else if(code==='100'){ document.getElementById('workspace-100').style.display='block'; loadRecipe(); updateNav('ë ˆì‹œí”¼'); }
            else if(code==='400'){ document.getElementById('workspace-400').style.display='block'; document.getElementById('google-form-frame').src=formUrl; loadRnD(); updateNav('ì—°êµ¬'); }
            else if(code==='900'){ document.getElementById('workspace-900').style.display='block'; loadArchive(); updateNav('ìë£Œì‹¤'); }
            else if(code==='030'){ document.getElementById('workspace-030').style.display='block'; loadManual(); updateNav('ê´€ë¦¬'); }
            else if(code==='500'){ document.getElementById('workspace-500').style.display='block'; loadSchedule(); updateNav('í™ˆ'); }
            else if(code==='600'){ document.getElementById('workspace-600').style.display='block'; loadNotice(); updateNav('í™ˆ'); }
        }
        function updateNav(n){ document.querySelectorAll('.nav-btn').forEach(b=>{ b.classList.remove('active'); if(b.querySelector('span').innerText===n) b.classList.add('active'); }); }

        // [500] ì¼ì • (ìˆ˜ì •/ì‚­ì œ ì¶”ê°€)
        function loadSchedule() {
            document.getElementById('schedule-list').innerHTML="<div style='text-align:center;padding:20px;'>ë¡œë”© ì¤‘...</div>";
            fetch(`${gasUrl}?action=get_schedule`).then(r=>r.json()).then(l => {
                let h=""; l.forEach(i=>{ 
                    h+=`<div class="schedule-item">
                        <div class="schedule-left"><div class="schedule-date">${i.date.substring(5)}</div><div><div>${i.content}</div></div><div class="schedule-type">${i.type}</div></div>
                        <div class="item-actions">
                            <i class="fas fa-edit action-icon" onclick="editSchedule('${i.row}', '${i.date}', '${i.type}', '${i.content}')"></i>
                            <i class="fas fa-trash-alt action-icon delete" onclick="deleteItem('ì¼ì •ê´€ë¦¬', '${i.row}')"></i>
                        </div>
                    </div>`; 
                });
                document.getElementById('schedule-list').innerHTML = h || "<div style='text-align:center;padding:20px;color:#999;'>ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
            });
        }
        function openSchForm() { document.getElementById('schedule-form').style.display='block'; document.getElementById('sch-row').value=""; document.getElementById('sch-save-btn').innerText="ì €ì¥"; document.getElementById('sch-content').value=""; }
        function editSchedule(r,d,t,c) { document.getElementById('schedule-form').style.display='block'; document.getElementById('sch-row').value=r; document.getElementById('sch-date').value=d; document.getElementById('sch-type').value=t; document.getElementById('sch-content').value=c; document.getElementById('sch-save-btn').innerText="ìˆ˜ì •"; }
        function saveSchedule() {
            const r=document.getElementById('sch-row').value, d=document.getElementById('sch-date').value, t=document.getElementById('sch-type').value, c=document.getElementById('sch-content').value;
            if(!d || !c) { alert("ë‚ ì§œì™€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"); return; }
            fetch(`${gasUrl}?action=save_schedule&row=${r}&date=${d}&type=${t}&content=${c}`).then(()=>{ alert("ì™„ë£Œë¨"); document.getElementById('schedule-form').style.display='none'; loadSchedule(); });
        }

        // [600] ê³µì§€ì‚¬í•­ (ìˆ˜ì •/ì‚­ì œ ì¶”ê°€)
        function loadNotice() {
            document.getElementById('notice-list').innerHTML="<div style='text-align:center;padding:20px;'>ë¡œë”© ì¤‘...</div>";
            fetch(`${gasUrl}?action=get_notice`).then(r=>r.json()).then(l => {
                let h=""; l.forEach(i=>{ 
                    let b = i.type==='í•„ë…'?'urgent':'normal';
                    h+=`<div class="notice-item">
                        <div class="notice-head" onclick="this.parentNode.classList.toggle('active')">
                            <div><span class="notice-badge ${b}">${i.type}</span> <b>${i.title}</b></div>
                            <div style="font-size:12px;color:#888;">${i.date}</div>
                        </div>
                        <div class="notice-body">
                            <div style="white-space:pre-wrap; margin-bottom:15px;">${i.content}</div>
                            <div style="text-align:right;">
                                <button class="console-btn" style="padding:5px 10px; font-size:11px;" onclick="editNotice('${i.row}', '${i.date}', '${i.type}', '${i.title}', \`${i.content.replace(/`/g, "\\`")}\`)">ìˆ˜ì •</button>
                                <button class="console-btn" style="padding:5px 10px; font-size:11px; background:#e74c3c;" onclick="deleteItem('ê³µì§€ì‚¬í•­', '${i.row}')">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>`; 
                });
                document.getElementById('notice-list').innerHTML = h || "<div style='text-align:center;padding:20px;color:#999;'>ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
            });
        }
        function openNotForm() { document.getElementById('notice-form').style.display='block'; document.getElementById('not-row').value=""; document.getElementById('not-save-btn').innerText="ì €ì¥"; document.getElementById('not-title').value=""; document.getElementById('not-content').value=""; }
        function editNotice(r,d,t,ti,c) { document.getElementById('notice-form').style.display='block'; document.getElementById('not-row').value=r; document.getElementById('not-type').value=t; document.getElementById('not-title').value=ti; document.getElementById('not-content').value=c; document.getElementById('not-save-btn').innerText="ìˆ˜ì •"; }
        function saveNotice() {
            const r=document.getElementById('not-row').value, t=document.getElementById('not-type').value, ti=document.getElementById('not-title').value, c=document.getElementById('not-content').value;
            if(!ti || !c) { alert("ì…ë ¥í•˜ì„¸ìš”"); return; }
            const d = new Date().toISOString().split('T')[0];
            fetch(`${gasUrl}?action=save_notice&row=${r}&date=${d}&type=${t}&title=${ti}&content=${encodeURIComponent(c)}`).then(()=>{ alert("ì™„ë£Œë¨"); document.getElementById('notice-form').style.display='none'; loadNotice(); });
        }

        // ê³µí†µ ì‚­ì œ
        function deleteItem(sheet, row) {
            if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                fetch(`${gasUrl}?action=delete_item&sheetName=${sheet}&row=${row}`).then(()=>{ 
                    alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."); 
                    if(sheet==='ì¼ì •ê´€ë¦¬') loadSchedule(); else loadNotice(); 
                });
            }
        }

        // [ê¸°ì¡´ í•¨ìˆ˜ë“¤ ìƒëµì—†ì´ í¬í•¨]
        function setMode(m) { currentMode=m; document.querySelectorAll('.mode-tab').forEach(t=>t.classList.remove('active')); document.getElementById('tab-'+m).classList.add('active'); if(m==='stock'){document.getElementById('input-area').style.display='none';loadStockTableSafe();}else{document.getElementById('input-area').style.display='block';loadAssetListSafe();} }
        function loadAssetValueOnly(){ fetch(`${gasUrl}?action=asset`).then(r=>r.json()).then(d=>{document.getElementById('asset-value').innerText=Number(d.total).toLocaleString()+" ì›"}); }
        function loadAssetListSafe(){ if(currentMode==='stock')return; document.getElementById('stock-list-area').innerHTML="<div style='text-align:center;padding:20px;color:#999;'>ë¡œë”© ì¤‘...</div>"; fetch(`${gasUrl}?action=asset`).then(r=>r.json()).then(d=>{if(currentMode==='stock')return; let h=`<table class="data-table"><thead><tr><th>ìì‚° í’ˆëª©</th><th style="text-align:right">ê¸ˆì•¡</th></tr></thead><tbody>`; d.list.forEach(i=>h+=`<tr><td>${i.name}</td><td style="text-align:right;">${Number(i.value).toLocaleString()}</td></tr>`); document.getElementById('stock-list-area').innerHTML=h+"</tbody></table>"}); }
        function loadStockTableSafe(){ if(currentMode!=='stock')return; document.getElementById('stock-list-area').innerHTML="<div style='text-align:center;padding:20px;color:#999;'>ë¡œë”© ì¤‘...</div>"; fetch(`${gasUrl}?action=inventory`).then(r=>r.json()).then(d=>{if(currentMode!=='stock')return; let h=`<table class="data-table"><thead><tr><th>í’ˆëª©</th><th style="text-align:right">ìˆ˜ëŸ‰</th></tr></thead><tbody>`; d.forEach(i=>h+=`<tr><td>${i.name}</td><td style="text-align:right;">${i.qty}</td></tr>`); document.getElementById('stock-list-area').innerHTML=h+"</tbody></table>"}); }
        let salesData={}, viewYear=new Date().getFullYear(), viewMonth=new Date().getMonth();
        function initCalendar(){const yS=document.getElementById('cal-year'), mS=document.getElementById('cal-month'); yS.innerHTML=""; mS.innerHTML=""; for(let y=new Date().getFullYear()-5; y<=2050; y++){let o=document.createElement('option'); o.value=y; o.innerText=y; if(y===viewYear)o.selected=true; yS.appendChild(o);} for(let m=1; m<=12; m++){let o=document.createElement('option'); o.value=m-1; o.innerText=m; if(m-1===viewMonth)o.selected=true; mS.appendChild(o);} loadSalesData();}
        function changeCalendarMonth(){ viewYear=parseInt(document.getElementById('cal-year').value); viewMonth=parseInt(document.getElementById('cal-month').value); renderCalendar(); calculateProfit(); }
        function loadSalesData(){ fetch(`${gasUrl}?action=get_sales`).then(r=>r.json()).then(d=>{ salesData={}; d.forEach(i=>{salesData[i.date]=i.amount}); renderCalendar(); calculateProfit(); loadMenuCost(); }); }
        function renderCalendar(){ const g=document.getElementById('calendar-grid'); g.innerHTML=""; const f=new Date(viewYear,viewMonth,1).getDay(), l=new Date(viewYear,viewMonth+1,0).getDate(); ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>g.innerHTML+=`<div class="cal-day-name">${d}</div>`); for(let i=0;i<f;i++)g.innerHTML+=`<div></div>`; for(let i=1;i<=l;i++){ let ds=`${viewYear}-${(viewMonth+1).toString().padStart(2,'0')}-${i.toString().padStart(2,'0')}`; let v=salesData[ds]?Number(salesData[ds]).toLocaleString():"", t=(i===new Date().getDate()&&viewMonth===new Date().getMonth()&&viewYear===new Date().getFullYear())?"today":""; g.innerHTML+=`<div class="cal-day ${t}" onclick="openSalesModal('${ds}')"><span class="cal-num">${i}</span><span class="cal-val">${v}</span></div>`; } document.getElementById('display-month-title').innerText=`${viewMonth+1}ì›” ë§¤ì¶œ í•©ê³„`; }
        const mIn=document.getElementById('modal-amount'); mIn.addEventListener('keypress',e=>{if(e.key==='Enter')saveSales()});
        function openSalesModal(d){document.getElementById('modal-date').innerText=d; document.getElementById('modal-amount').value=salesData[d]||""; document.getElementById('sales-modal').style.display='flex'; setTimeout(()=>mIn.focus(),100);}
        function closeModal(){document.getElementById('sales-modal').style.display='none'; mIn.value="";}
        function saveSales(){const d=document.getElementById('modal-date').innerText, a=mIn.value; salesData[d]=a; renderCalendar(); calculateProfit(); closeModal(); fetch(`${gasUrl}?action=save_sales&date=${d}&amount=${a}`);}
        function calculateProfit(){ const pf=`${viewYear}-${(viewMonth+1).toString().padStart(2,'0')}`; let t=0; for(let d in salesData)if(d.startsWith(pf))t+=Number(salesData[d]); document.getElementById('fin-current').innerText=t.toLocaleString(); fetch(`${gasUrl}?action=bep`).then(r=>r.json()).then(b=>{let v=Math.round(t*b.variableRatio), tc=b.fixed+v; document.getElementById('fin-cost').innerText=tc.toLocaleString(); document.getElementById('fin-profit').innerText=(t-tc).toLocaleString();}); }
        function loadMenuCost(){fetch(`${gasUrl}?action=menu_cost`).then(r=>r.json()).then(l=>{let h=`<table class="data-table"><thead><tr><th>ë©”ë‰´</th><th style="text-align:right">ì›ê°€ìœ¨(%)</th></tr></thead><tbody>`; l.forEach(i=>{let c=i.ratio>=35?"red":"green"; h+=`<tr><td>${i.name}</td><td style="text-align:right;font-weight:bold;color:${c}">${i.ratio}%</td></tr>`}); document.getElementById('menu-cost-area').innerHTML=h+"</tbody></table>"})}
        let workList=[];
        document.getElementById('searchBtn').addEventListener('click',()=>{const v=document.getElementById('searchInput').value; fetch(`${gasUrl}?action=search&item=${v}`).then(r=>r.json()).then(d=>{let h=""; d.forEach(i=>{h+=`<div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;"><span>${i.name}</span><button onclick="addToList('${i.name}','${i.spec}','${i.unit}')" style="font-size:11px; padding:3px 8px; border:1px solid #333; background:white; border-radius:4px;">ë‹´ê¸°</button></div>`}); document.getElementById('search-result').innerHTML=h})});
        function addToList(n,s,u){workList.push({date:new Date().toISOString().split('T')[0],name:n,spec:s,unit:u,qty:1}); renderList();}
        function renderList(){let h=""; workList.forEach((i,idx)=>{h+=`<div class="stage-item"><span>${i.name} 1${i.unit}</span><button onclick="workList.splice(${idx},1);renderList()" style="color:red;border:none;background:none;">âœ•</button></div>`}); document.getElementById('saved-list').innerHTML=h||"<div style='text-align:center;color:#ccc;font-size:12px;padding-top:15px;'>ë¹„ì–´ìˆìŒ</div>";}
        function saveToSheet(){if(workList.length===0)return; fetch(`${gasUrl}?action=save&type=${currentMode}&data=${encodeURIComponent(JSON.stringify(workList))}`).then(()=>{alert("ì €ì¥ë¨"); workList=[]; renderList();})}
        document.getElementById('recipeInput').addEventListener('keypress',e=>{if(e.key==='Enter')loadRecipe()});
        function loadRecipe(){const k=document.getElementById('recipeInput').value; const a=document.getElementById('recipe-list-area'); a.innerHTML="<div style='text-align:center;padding:20px;'>ê²€ìƒ‰ì¤‘...</div>"; fetch(`${gasUrl}?action=recipe&keyword=${encodeURIComponent(k)}`).then(r=>r.json()).then(l=>{let h=""; l.forEach(i=>{let det=""; let g={}; i.details.forEach(d=>{if(!g[d.section])g[d.section]=[];g[d.section].push(d)}); for(let s in g){let r=""; g[s].forEach(d=>{let v=d.video?`<a href="${d.video}" target="_blank" class="video-link">â–¶ ì˜ìƒ</a>`:""; r+=`<div class="recipe-step"><span style="font-weight:bold;font-size:12px;color:#888;">${d.category}</span><div>${d.content}</div>${v}</div>`}); det+=`<div style="margin-top:10px;"><h5 style="margin:0 0 5px 0; color:#e67e22;">${s}</h5>${r}</div>`} h+=`<div class="recipe-card"><div class="recipe-head"><span class="recipe-name">${i.name}</span><span style="font-size:12px;background:rgba(255,255,255,0.2);padding:2px 8px;border-radius:10px;">${i.type}</span></div><div class="recipe-body">${det}</div></div>`}); a.innerHTML=h||"<div style='text-align:center;padding:20px;'>ê²°ê³¼ì—†ìŒ</div>"})}
        function loadRnD(){fetch(`${gasUrl}?action=rnd`).then(r=>r.json()).then(l=>{let p=""; l.slice(0,3).forEach(i=>p+=`<div onclick="openModule('400')" style="padding:10px;border-bottom:1px solid #eee;cursor:pointer;"><b>${i.menu}</b> <span style="float:right;font-size:12px;color:#888;">${i.date}</span></div>`); document.getElementById('recent-rnd').innerHTML=p; let h=""; l.forEach(i=>{let img=`<div class="rnd-thumb" style="background:#eee;"></div>`; if(i.photo&&i.photo.match(/[-\w]{25,}/))img=`<img src="https://drive.google.com/uc?export=view&id=${i.photo.match(/[-\w]{25,}/)[0]}" class="rnd-thumb" onclick="window.open(this.src)">`; h+=`<div class="rnd-card">${img}<div class="rnd-info"><b>${i.menu}</b><div style="font-size:12px;color:#888;">${i.date}</div><div style="font-size:13px;">${i.note}</div></div></div>`}); document.getElementById('rnd-list-area').innerHTML=h})}
        function loadManual(){fetch(`${gasUrl}?action=manual`).then(r=>r.json()).then(l=>{let h=""; l.forEach(i=>{let k=i.link?`<br><a href="${i.link}" target="_blank" style="color:blue;">ì˜ìƒë³´ê¸°</a>`:""; h+=`<div class="manual-item" onclick="this.classList.toggle('active')"><div class="manual-header"><span>${i.title}</span><i class="fas fa-chevron-down"></i></div><div class="manual-body">${i.content}${k}</div></div>`}); document.getElementById('manual-list-area').innerHTML=h})}
        function loadArchive(){fetch(`${gasUrl}?action=archive`).then(r=>r.json()).then(l=>{let h=""; l.forEach(f=>{let i="fa-file",c="#999"; if(f.type.includes("folder")){i="fa-folder";c="#f39c12";}else if(f.type.includes("image")){i="fa-image";c="#27ae60";} h+=`<a href="${f.url}" target="_blank" style="display:flex;padding:15px;border-bottom:1px solid #eee;align-items:center;text-decoration:none;color:#333;"><div style="font-size:24px;color:${c};margin-right:15px;width:30px;text-align:center;"><i class="fas ${i}"></i></div><div style="flex:1;"><div>${f.name}</div><div style="font-size:11px;color:#888;">${f.date}</div></div><i class="fas fa-chevron-right" style="color:#ddd;"></i></a>`}); document.getElementById('archive-list-area').innerHTML=h})}
        document.addEventListener("DOMContentLoaded",()=>loadRnD());
    </script>
</body>
</html>
