<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef_dskim SYSTEM</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }

        /* [ë©”ì¸ ë©”ë‰´] */
        .main-btn { width: 100%; padding: 20px; margin-bottom: 10px; font-size: 16px; font-weight: bold; border: 1px solid #ccc; border-radius: 8px; background: #fff; cursor: pointer; text-align: left; }
        .code-tag { color: #888; font-size: 12px; display: block; margin-bottom: 5px; }
        #submenu-000 { display: none; background: #f8f9fa; margin-top: -5px; margin-bottom: 15px; padding: 5px; border: 1px solid #ddd; border-top: none; }
        .sub-btn { width: 100%; padding: 15px; border: none; border-bottom: 1px solid #eee; background: none; text-align: left; cursor: pointer; font-size: 15px; }
        .sub-btn:hover { background: #e9ecef; font-weight: bold; }

        /* ì‘ì—… ê³µê°„ ê³µí†µ */
        .workspace { display: none; }
        .back-btn { background: none; border: none; color: #555; margin-bottom:15px; cursor:pointer; }
        
        /* [010] ìŠ¤íƒ€ì¼ */
        .asset-box { background: #eaf2f8; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 20px; border: 1px solid #d6eaf8; cursor: pointer; }
        .asset-value { font-size: 24px; color: #2c3e50; font-weight: bold; margin-top: 5px; }
        #asset-detail { display: none; margin-bottom: 20px; background: #fafafa; border: 1px solid #eee; border-radius: 8px; padding: 10px; max-height: 200px; overflow-y: auto; }
        .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; font-size: 13px; }
        
        .mode-switch { display: flex; gap: 5px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-weight: bold; cursor: pointer; background: #fff; color: #777; font-size: 13px; }
        .mode-btn.active-in { background: #e8f8f5; border-color: #27ae60; color: #27ae60; }
        .mode-btn.active-out { background: #fdedec; border-color: #e74c3c; color: #e74c3c; }
        .mode-btn.active-stock { background: #eaf2f8; border-color: #3498db; color: #3498db; }

        .search-box { display: flex; gap: 5px; margin-bottom: 15px; }
        input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        .camera-btn { padding: 10px 15px; background: #ccc; color: white; border: none; border-radius: 4px; cursor: not-allowed; font-size: 18px; }
        .action-btn { padding: 10px 20px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; vertical-align: middle; }
        th { background: #f1f1f1; }
        .save-btn { width: 100%; padding: 15px; color: white; border: none; border-radius: 8px; margin-top: 20px; font-weight: bold; cursor: pointer; }
        .bg-in { background: #27ae60; } .bg-out { background: #c0392b; }

        /* [020] ì†ìµë¶„ê¸°ì  & ë©”ë‰´ì›ê°€ ìŠ¤íƒ€ì¼ */
        .bep-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .bep-title { font-size: 14px; color: #888; font-weight: bold; }
        .bep-amount { font-size: 24px; color: #2c3e50; font-weight: bold; margin: 5px 0 15px 0; }
        .progress-container { background: #f1f1f1; border-radius: 10px; height: 15px; width: 100%; margin-bottom: 5px; overflow: hidden; }
        .progress-bar { height: 100%; border-radius: 10px; transition: width 0.5s; }
        .bar-green { background: #27ae60; }
        .bar-red { background: #e74c3c; }
        .bep-info { display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-top: 5px; }
        .status-badge { padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; display: inline-block; }
        .status-profit { background: #e8f8f5; color: #27ae60; border: 1px solid #27ae60; }
        .status-loss { background: #fdedec; color: #e74c3c; border: 1px solid #e74c3c; }

        /* [NEW] ì¬ë¬´ ì§€í‘œ ìš”ì•½ ê·¸ë¦¬ë“œ */
        .finance-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .finance-item { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; text-align: center; }
        .finance-label { font-size: 12px; color: #7f8c8d; margin-bottom: 5px; }
        .finance-val { font-size: 16px; font-weight: bold; color: #2c3e50; }
        /* ìˆœì´ìµ ê°•ì¡° */
        .finance-profit { color: #e74c3c !important; } /* ì ìì¼ ë•Œ */
        .finance-profit.plus { color: #27ae60 !important; } /* í‘ìì¼ ë•Œ */

        /* ë©”ë‰´ ì›ê°€ ë¦¬ìŠ¤íŠ¸ */
        .menu-card { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 15px 0; }
        .menu-name { font-weight: bold; font-size: 15px; color: #333; }
        .menu-cost-info { font-size: 12px; color: #777; margin-top: 4px; }
        .cost-badge { padding: 5px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .cost-good { background: #e8f8f5; color: #27ae60; } 
        .cost-bad { background: #fdedec; color: #e74c3c; } 

    </style>
</head>
<body>

    <div class="container">
        <h2 id="page-title">MAIN MENU</h2>

        <div id="main-nav">
            <button class="main-btn" onclick="toggleSubMenu()"><span class="code-tag">000</span> ê¸°ì¤€ì •ë³´ (ADMIN) â–¼</button>
            <div id="submenu-000">
                <button class="sub-btn" onclick="openModule('010')">010 ì…ì¶œê³ /ì›ê°€ ê´€ë¦¬</button>
                <button class="sub-btn" onclick="openModule('020')">020 ì‚¬ì—…ê¸°íš_ìš´ì˜</button>
                <button class="sub-btn" onclick="alert('ì¤€ë¹„ ì¤‘')">030 ì§ì›êµìœ¡</button>
            </div>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">100~300</span> êµ­ê°€ë³„ ìš”ë¦¬</button>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">400</span> ì‹¬í™” ì—°êµ¬ (R&D)</button>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">900</span> ìë£Œì‹¤ (ARCHIVE)</button>
        </div>

        <div id="workspace-010" class="workspace">
            <button class="back-btn" onclick="goBackMain()">â—€ ë©”ì¸ìœ¼ë¡œ</button>
            
            <div class="asset-box" onclick="toggleAssetDetail()">
                <div style="font-size:13px; color:#3498db; font-weight:bold;">ğŸ’° í˜„ì¬ ì´ ì¬ê³  ìì‚°</div>
                <div id="asset-value" class="asset-value">ê³„ì‚° ì¤‘...</div>
                <div style="font-size:12px; color:#aaa; margin-top:5px;">â–¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°</div>
            </div>
            <div id="asset-detail"><p style="text-align:center; color:#999;">ë¡œë”© ì¤‘...</p></div>

            <div class="mode-switch">
                <button id="btn-in" class="mode-btn active-in" onclick="setMode('in')">ğŸ“¥ ë§¤ì…(ì…ê³ )</button>
                <button id="btn-out" class="mode-btn" onclick="setMode('out')">ğŸ“¤ ì¶œê³ (ì‚¬ìš©)</button>
                <button id="btn-stock" class="mode-btn" onclick="loadStock()">ğŸ“¦ ì¬ê³  í™•ì¸</button>
            </div>

            <div id="search-area" class="search-box">
                <button class="camera-btn" onclick="alert('ì¹´ë©”ë¼ ì ê²€ ì¤‘')">ğŸ“·</button>
                <input type="text" id="searchInput" placeholder="í’ˆëª©ëª… ì…ë ¥">
                <button class="action-btn" id="searchBtn">ê²€ìƒ‰</button>
            </div>
            <div id="result-list"></div>

            <div id="work-area" style="margin-top:30px; border-top:2px solid #eee; padding-top:15px;">
                <strong id="list-title">ğŸ“‹ ë§¤ì… ë¦¬ìŠ¤íŠ¸</strong>
                <div id="saved-list"></div>
                <button id="send-btn" class="save-btn bg-in" onclick="saveToSheet()" style="display:none;">ë§¤ì…ì¥ ì €ì¥í•˜ê¸°</button>
            </div>
        </div>

        <div id="workspace-020" class="workspace">
            <button class="back-btn" onclick="goBackMain()">â—€ ë©”ì¸ìœ¼ë¡œ</button>
            
            <h3 style="margin-bottom:20px;">ğŸ“Š ì‚¬ì—… ê¸°íš & ìš´ì˜</h3>

            <div class="finance-grid">
                <div class="finance-item">
                    <div class="finance-label">í˜„ì¬ ì´ ë§¤ì¶œì•¡</div>
                    <div class="finance-val" id="fin-current" style="color:#2c3e50;">0 ì›</div>
                </div>
                <div class="finance-item">
                    <div class="finance-label">ì›” ê³ ì •ë¹„</div>
                    <div class="finance-val" id="fin-fixed">0 ì›</div>
                </div>
                <div class="finance-item">
                    <div class="finance-label">ë³€ë™ë¹„ (ì¬ë£Œë¹„ ë“±)</div>
                    <div class="finance-val" id="fin-variable">0 ì›</div>
                </div>
                <div class="finance-item">
                    <div class="finance-label">í˜„ì¬ ìˆœì´ìµ</div>
                    <div class="finance-val finance-profit" id="fin-profit">0 ì›</div>
                </div>
            </div>

            <div class="bep-card">
                <div class="bep-title">ë§¤ì¶œ ë‹¬ì„±ë¥  ê·¸ë˜í”„</div>
                <div class="progress-container" style="margin-top:10px;">
                    <div id="sales-bar" class="progress-bar bar-green" style="width: 0%;"></div>
                </div>
                <div class="bep-info">
                    <span id="sales-percent-text">0% ë‹¬ì„±</span>
                    <span id="bep-gap-text">BEPê¹Œì§€ 0ì› ë‚¨ìŒ</span>
                </div>
                
                <hr style="margin:15px 0; border:0; border-top:1px solid #eee;">
                
                <div class="bep-title">ì†ìµë¶„ê¸°ì  (BEP)</div>
                <div class="bep-amount" id="bep-amount" style="font-size:18px; color:#e67e22;">0 ì›</div>
                <div style="text-align:center;">
                    <span id="status-badge" class="status-badge status-loss">ë°ì´í„° ì¡°íšŒ ì¤‘...</span>
                </div>
            </div>

            <div style="margin-top:30px;">
                <h3 style="border-bottom:2px solid #333; padding-bottom:10px;">ğŸ” ë©”ë‰´ ì›ê°€ ë¶„ì„</h3>
                <div id="menu-loading" style="text-align:center; padding:20px; color:#999;">ë¶„ì„ ì¤‘...</div>
                <div id="menu-list-area"></div>
            </div>

        </div>

    </div>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        
        // --- ê³µí†µ ê¸°ëŠ¥ ---
        function toggleSubMenu() { const el = document.getElementById('submenu-000'); el.style.display = (el.style.display==='block')?'none':'block'; }
        
        function openModule(code) {
            document.getElementById('main-nav').style.display = 'none';
            document.querySelectorAll('.workspace').forEach(el => el.style.display = 'none'); 
            
            if (code === '010') {
                document.getElementById('workspace-010').style.display = 'block';
                document.getElementById('page-title').innerText = "010 ì…ì¶œê³ /ì›ê°€ ê´€ë¦¬";
                setMode('in'); loadAsset();
            } else if (code === '020') {
                document.getElementById('workspace-020').style.display = 'block';
                document.getElementById('page-title').innerText = "020 ì‚¬ì—…ê¸°íš_ìš´ì˜";
                loadBEP();      
                loadMenuCost(); 
            }
        }

        function goBackMain() {
            document.querySelectorAll('.workspace').forEach(el => el.style.display = 'none');
            document.getElementById('main-nav').style.display = 'block';
            document.getElementById('page-title').innerText = "MAIN MENU";
        }

        // --- 020 ê¸°ëŠ¥ (ìˆ˜ì •ë¨) ---
        function loadBEP() {
            fetch(`${gasUrl}?action=bep`).then(r=>r.json()).then(data => {
                const target = data.target; 
                const current = data.current; 
                const bep = data.bep;
                const fixed = data.fixed;
                const varCost = data.variableCost;
                const profit = data.netProfit;

                // [NEW] 4ëŒ€ í•µì‹¬ ì§€í‘œ ë°”ì¸ë”©
                document.getElementById('fin-current').innerText = Number(current).toLocaleString() + " ì›";
                document.getElementById('fin-fixed').innerText = Number(fixed).toLocaleString() + " ì›";
                document.getElementById('fin-variable').innerText = Number(varCost).toLocaleString() + " ì›";
                
                const profitEl = document.getElementById('fin-profit');
                profitEl.innerText = Number(profit).toLocaleString() + " ì›";
                // í‘ìë©´ ì´ˆë¡ìƒ‰, ì ìë©´ ë¹¨ê°„ìƒ‰
                if (profit > 0) profitEl.className = "finance-val finance-profit plus";
                else profitEl.className = "finance-val finance-profit";

                // ê·¸ë˜í”„ ë° BEP
                let salesPct = Math.min((current/target)*100, 100);
                document.getElementById('sales-bar').style.width = salesPct+"%";
                document.getElementById('sales-percent-text').innerText = Math.round((current/target)*100)+"% ë‹¬ì„±";
                document.getElementById('bep-amount').innerText = bep.toLocaleString() + " ì›";

                const diff = current - bep;
                const gapText = document.getElementById('bep-gap-text');
                const badge = document.getElementById('status-badge');

                if (current >= bep) {
                    badge.className = "status-badge status-profit"; badge.innerText = "í‘ì ì „í™˜ ì„±ê³µ! ğŸ‰";
                    gapText.innerText = `+${diff.toLocaleString()}ì› ì´ìµ`;
                    gapText.style.color = "#27ae60";
                } else {
                    badge.className = "status-badge status-loss"; badge.innerText = "ì ì (BEP ë¯¸ë‹¬) ğŸ“‰";
                    gapText.innerText = `BEPê¹Œì§€ -${Math.abs(diff).toLocaleString()}ì›`;
                    gapText.style.color = "#e74c3c";
                }
            });
        }

        function loadMenuCost() {
            const area = document.getElementById('menu-list-area');
            const loader = document.getElementById('menu-loading');
            loader.style.display = 'block';
            area.innerHTML = "";

            fetch(`${gasUrl}?action=menu_cost`).then(r=>r.json()).then(list => {
                loader.style.display = 'none';
                if(list.length === 0) { area.innerHTML = "<p style='text-align:center; color:#999'>ë©”ë‰´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>"; return; }

                let html = "";
                list.forEach(item => {
                    let badgeClass = (item.ratio > 35) ? "cost-bad" : "cost-good";
                    let badgeText = (item.ratio > 35) ? "ì£¼ì˜" : "ì–‘í˜¸";
                    html += `<div class="menu-card">
                        <div>
                            <div class="menu-name">${item.name}</div>
                            <div class="menu-cost-info">ì›ê°€ ${item.cost.toLocaleString()}ì› / íŒë§¤ê°€ ${item.price.toLocaleString()}ì›</div>
                        </div>
                        <div style="text-align:right;">
                            <div class="cost-badge ${badgeClass}">${item.ratio}% (${badgeText})</div>
                        </div>
                    </div>`;
                });
                area.innerHTML = html;
            });
        }

        // --- 010 ê¸°ëŠ¥ (ê¸°ì¡´ ìœ ì§€) ---
        let currentMode='in'; let workList=[]; 
        document.addEventListener("DOMContentLoaded", function() {
            const i=document.getElementById("searchInput"); const b=document.getElementById("searchBtn");
            if(i) i.addEventListener("keypress",e=>{if(e.key==="Enter"){e.preventDefault();b.click();}});
            if(b) b.addEventListener("click",runSearch);
        });
        function loadAsset() {
            fetch(`${gasUrl}?action=asset`).then(r=>r.json()).then(d=>{
                document.getElementById('asset-value').innerText = Number(d.total).toLocaleString() + " ì›";
                let h=""; d.list.forEach(i=>{h+=`<div class="detail-row"><span>${i.name}</span><span>${i.value.toLocaleString()}ì›</span></div>`;});
                document.getElementById('asset-detail').innerHTML = h || "<p style='text-align:center'>ë‚´ì—­ ì—†ìŒ</p>";
            });
        }
        function toggleAssetDetail(){const d=document.getElementById('asset-detail');d.style.display=(d.style.display==='block')?'none':'block';}
        function setMode(m){currentMode=m; 
            document.getElementById('btn-in').className=(m==='in')?"mode-btn active-in":"mode-btn";
            document.getElementById('btn-out').className=(m==='out')?"mode-btn active-out":"mode-btn";
            document.getElementById('btn-stock').className=(m==='stock')?"mode-btn active-stock":"mode-btn";
            document.getElementById('search-area').style.display=(m==='stock')?'none':'flex';
            document.getElementById('work-area').style.display=(m==='stock')?'none':'block';
            document.getElementById('saved-list').innerHTML="";
        }
        function loadStock(){ setMode('stock'); 
            const r=document.getElementById('result-list'); r.innerHTML="<p style='text-align:center'>ì¡°íšŒ ì¤‘...</p>";
            fetch(`${gasUrl}?action=inventory`).then(r=>r.json()).then(d=>{
                if(d.length===0){r.innerHTML="<p>ì¬ê³  ì—†ìŒ</p>";return;}
                let h='<table><tr><th>í’ˆëª©</th><th>ì¬ê³ </th></tr>';
                d.forEach(i=>{h+=`<tr><td>${i.name}<br><small>${i.spec}</small></td><td style='color:${i.qty<0?'red':'blue'}'>${i.qty} ${i.unit}</td></tr>`;});
                r.innerHTML=h+'</table>';
            });
        }
        function runSearch(){
            const v=document.getElementById('searchInput').value; if(!v)return;
            const r=document.getElementById('result-list'); r.innerHTML="ê²€ìƒ‰ ì¤‘...";
            fetch(`${gasUrl}?action=search&item=${encodeURIComponent(v)}`).then(r=>r.json()).then(d=>{
                let h='<table>'; d.forEach(i=>{h+=`<tr><td>${i.name}<br><small>${i.spec}</small></td><td style='text-align:right'><button class='action-btn' onclick="addToList('${i.name}','${i.spec}','${i.unit}')">ì¶”ê°€</button></td></tr>`;});
                r.innerHTML=h+'</table>';
            });
        }
        function addToList(n,s,u){workList.push({date:new Date().toISOString().split('T')[0],name:n,spec:s,unit:u,qty:1}); renderList();}
        function updateQty(i,v){workList[i].qty=v;}
        function renderList(){
            const l=document.getElementById('saved-list'); const b=document.getElementById('send-btn');
            if(workList.length===0){l.innerHTML="";b.style.display='none';return;}
            let h='<table><tr><th>í’ˆëª©</th><th>ìˆ˜ëŸ‰</th></tr>';
            workList.forEach((t,i)=>{h+=`<tr><td>${t.name}</td><td><input type='number' value='${t.qty}' onchange='updateQty(${i},this.value)'> ${t.unit}</td></tr>`;});
            l.innerHTML=h+'</table>'; b.style.display='block';
        }
        function saveToSheet(){
            if(!confirm("ì €ì¥?"))return;
            const b=document.getElementById('send-btn'); b.disabled=true; b.innerText="ì €ì¥ ì¤‘...";
            fetch(`${gasUrl}?action=save&type=${currentMode}&data=${encodeURIComponent(JSON.stringify(workList))}`)
            .then(()=>{alert("ì™„ë£Œ!"); workList=[]; renderList(); b.disabled=false; setMode(currentMode);});
        }
    </script>
</body>
</html>
