<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef_dskim SYSTEM</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        
        /* [NEW] í´ë¦­ ê°€ëŠ¥í•œ ìì‚° ë°•ìŠ¤ */
        .asset-box { background: #eaf2f8; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 20px; border: 1px solid #d6eaf8; cursor: pointer; transition: 0.2s; }
        .asset-box:hover { background: #d4e6f1; }
        .asset-title { font-size: 13px; color: #3498db; font-weight: bold; }
        .asset-value { font-size: 24px; color: #2c3e50; font-weight: bold; margin-top: 5px; }
        .toggle-icon { font-size: 12px; color: #7f8c8d; margin-top: 5px; }

        /* [NEW] ìƒì„¸ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ (ìˆ¨ê¹€ ìƒíƒœ) */
        #asset-detail { display: none; margin-bottom: 20px; background: #fafafa; border: 1px solid #eee; border-radius: 8px; padding: 10px; max-height: 200px; overflow-y: auto; }
        .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; font-size: 13px; }
        .detail-row:last-child { border-bottom: none; }
        .detail-name { font-weight: bold; color: #555; }
        .detail-val { color: #2c3e50; }

        /* ë©”ì¸ ë„¤ë¹„ */
        .main-btn { width: 100%; padding: 20px; margin-bottom: 10px; font-size: 16px; font-weight: bold; border: 1px solid #ccc; border-radius: 8px; background: #fff; cursor: pointer; text-align: left; }
        .code-tag { color: #888; font-size: 12px; display: block; margin-bottom: 5px; }
        #submenu-000 { display: none; background: #f8f9fa; margin-top: -5px; margin-bottom: 15px; padding: 5px; border: 1px solid #ddd; border-top: none; }
        .sub-btn { width: 100%; padding: 15px; border: none; border-bottom: 1px solid #eee; background: none; text-align: left; cursor: pointer; font-size: 15px; }
        .sub-btn:hover { background: #e9ecef; font-weight: bold; }

        /* ì‘ì—…ì°½ */
        #workspace-010 { display: none; } 
        .mode-switch { display: flex; gap: 5px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-weight: bold; cursor: pointer; background: #fff; color: #777; font-size: 13px; }
        .mode-btn.active-in { background: #e8f8f5; border-color: #27ae60; color: #27ae60; }
        .mode-btn.active-out { background: #fdedec; border-color: #e74c3c; color: #e74c3c; }
        .mode-btn.active-stock { background: #eaf2f8; border-color: #3498db; color: #3498db; }

        /* ê³µí†µ UI */
        .search-box { display: flex; gap: 5px; margin-bottom: 15px; }
        input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        input[type="number"] { width: 60px; padding: 5px; border: 1px solid #ddd; text-align: center; }
        .action-btn { padding: 10px 20px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; vertical-align: middle; }
        th { background: #f1f1f1; }
        .save-btn { width: 100%; padding: 15px; color: white; border: none; border-radius: 8px; margin-top: 20px; font-weight: bold; cursor: pointer; }
        .bg-in { background: #27ae60; } .bg-out { background: #c0392b; }
    </style>
</head>
<body>

    <div class="container">
        <h2 id="page-title">MAIN MENU</h2>

        <div id="main-nav">
            <button class="main-btn" onclick="toggleSubMenu()"><span class="code-tag">000</span> ê¸°ì¤€ì •ë³´ (ADMIN) â–¼</button>
            <div id="submenu-000">
                <button class="sub-btn" onclick="openWorkspace()">010 ì…ì¶œê³ /ì›ê°€ ê´€ë¦¬</button>
                <button class="sub-btn" onclick="alert('ì¤€ë¹„ ì¤‘')">020 ì‚¬ì—…ê¸°íš_ìš´ì˜</button>
                <button class="sub-btn" onclick="alert('ì¤€ë¹„ ì¤‘')">030 ì§ì›êµìœ¡</button>
            </div>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">100~300</span> êµ­ê°€ë³„ ìš”ë¦¬</button>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">400</span> ì‹¬í™” ì—°êµ¬ (R&D)</button>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">900</span> ìë£Œì‹¤ (ARCHIVE)</button>
        </div>

        <div id="workspace-010">
            <button onclick="goBackMain()" style="background:none; border:none; color:#555; margin-bottom:15px; cursor:pointer;">â—€ ë©”ì¸ìœ¼ë¡œ</button>
            
            <div class="asset-box" onclick="toggleAssetDetail()">
                <div class="asset-title">ğŸ’° í˜„ì¬ ì´ ì¬ê³  ìì‚°</div>
                <div id="asset-value" class="asset-value">ê³„ì‚° ì¤‘...</div>
                <div class="toggle-icon">â–¼ ìƒì„¸ ë‚´ì—­ ë³´ê¸° (í´ë¦­)</div>
            </div>
            
            <div id="asset-detail">
                <p style="text-align:center; color:#999;">ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <div class="mode-switch">
                <button id="btn-in" class="mode-btn active-in" onclick="setMode('in')">ğŸ“¥ ë§¤ì…(ì…ê³ )</button>
                <button id="btn-out" class="mode-btn" onclick="setMode('out')">ğŸ“¤ ì¶œê³ (ì‚¬ìš©)</button>
                <button id="btn-stock" class="mode-btn" onclick="loadStock()">ğŸ“¦ ì¬ê³  í™•ì¸</button>
            </div>

            <div id="search-area" class="search-box">
                <input type="text" id="searchInput" placeholder="í’ˆëª©ëª… ì…ë ¥">
                <button class="action-btn" id="searchBtn">ê²€ìƒ‰</button>
            </div>

            <div id="result-list"></div>

            <div id="work-area" style="margin-top:30px; border-top:2px solid #eee; padding-top:15px;">
                <strong id="list-title">ğŸ“‹ ë§¤ì… ë¦¬ìŠ¤íŠ¸</strong>
                <div id="saved-list"></div>
                <button id="send-btn" class="save-btn bg-in" onclick="saveToSheet()" style="display:none;">ë§¤ì…ì¥ ì €ì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // ì…°í”„ë‹˜ì˜ GAS URL (ë°°í¬ í›„ ë°”ë€ ì£¼ì†Œ í™•ì¸ í•„ìˆ˜!)
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        
        let currentMode = 'in'; 
        let workList = []; 
        let assetData = null; // ìì‚° ë°ì´í„° ì„ì‹œ ì €ì¥

        document.addEventListener("DOMContentLoaded", function() {
            const input = document.getElementById("searchInput");
            const btn = document.getElementById("searchBtn");
            input.addEventListener("keypress", function(e) { if(e.key==="Enter") { e.preventDefault(); btn.click(); } });
            btn.addEventListener("click", runSearch);
        });

        function toggleSubMenu() { const el = document.getElementById('submenu-000'); el.style.display = (el.style.display==='block')?'none':'block'; }
        
        function openWorkspace() {
            document.getElementById('main-nav').style.display = 'none';
            document.getElementById('workspace-010').style.display = 'block';
            document.getElementById('page-title').innerText = "ì…ì¶œê³ /ì›ê°€ ê´€ë¦¬";
            setMode('in');
            loadAsset(); 
        }

        function goBackMain() {
            document.getElementById('workspace-010').style.display = 'none';
            document.getElementById('main-nav').style.display = 'block';
            document.getElementById('page-title').innerText = "MAIN MENU";
            workList = []; renderList();
        }

        // [NEW] ìì‚° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (JSON ì²˜ë¦¬)
        function loadAsset() {
            fetch(`${gasUrl}?action=asset`)
                .then(res => res.json())
                .then(data => {
                    assetData = data; // ë°ì´í„° ì €ì¥
                    // ì´í•© í‘œì‹œ
                    const formatted = Number(data.total).toLocaleString(); 
                    document.getElementById('asset-value').innerText = formatted + " ì›";
                    
                    // ìƒì„¸ ë¦¬ìŠ¤íŠ¸ ë¯¸ë¦¬ ë Œë”ë§
                    renderAssetDetail(data.list);
                })
                .catch(() => {
                    document.getElementById('asset-value').innerText = "ì¡°íšŒ ì‹¤íŒ¨";
                });
        }

        // [NEW] ìƒì„¸ ë‚´ì—­ í† ê¸€
        function toggleAssetDetail() {
            const detailBox = document.getElementById('asset-detail');
            if (detailBox.style.display === 'block') {
                detailBox.style.display = 'none';
            } else {
                detailBox.style.display = 'block';
            }
        }

        // [NEW] ìƒì„¸ ë‚´ì—­ HTML ìƒì„±
        function renderAssetDetail(list) {
            const box = document.getElementById('asset-detail');
            if (!list || list.length === 0) {
                box.innerHTML = "<p style='text-align:center; color:#999;'>ìƒì„¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
                return;
            }
            let html = "";
            list.forEach(item => {
                html += `<div class="detail-row">
                    <span class="detail-name">${item.name}</span>
                    <span class="detail-val">${Number(item.value).toLocaleString()} ì›</span>
                </div>`;
            });
            box.innerHTML = html;
        }

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-in').className = "mode-btn";
            document.getElementById('btn-out').className = "mode-btn";
            document.getElementById('btn-stock').className = "mode-btn";
            
            document.getElementById('search-area').style.display = 'flex';
            document.getElementById('work-area').style.display = 'block';
            document.getElementById('result-list').innerHTML = "";
            document.getElementById('asset-detail').style.display = 'none'; // ëª¨ë“œ ë³€ê²½ì‹œ ìƒì„¸ë‚´ì—­ ë‹«ê¸°

            if (mode === 'in') {
                document.getElementById('btn-in').className = "mode-btn active-in";
                setupWorkArea("ë§¤ì…ì¥ ì €ì¥í•˜ê¸°", "bg-in", "ğŸ“¥ ë§¤ì… ë¦¬ìŠ¤íŠ¸");
            } else {
                document.getElementById('btn-out').className = "mode-btn active-out";
                setupWorkArea("ì¶œê³ ì¥ ì €ì¥í•˜ê¸°", "bg-out", "ğŸ“¤ ì¶œê³  ë¦¬ìŠ¤íŠ¸");
            }
        }

        function setupWorkArea(btnText, btnClass, titleText) {
            const sendBtn = document.getElementById('send-btn');
            sendBtn.innerText = btnText;
            sendBtn.className = "save-btn " + btnClass;
            document.getElementById('list-title').innerText = titleText;
            renderList(); 
        }

        function loadStock() {
            document.getElementById('btn-in').className = "mode-btn";
            document.getElementById('btn-out').className = "mode-btn";
            document.getElementById('btn-stock').className = "mode-btn active-stock";
            document.getElementById('search-area').style.display = 'none';
            document.getElementById('work-area').style.display = 'none';
            document.getElementById('asset-detail').style.display = 'none'; // ì¬ê³ ëª¨ë“œ ì‹œ ìƒì„¸ë‚´ì—­ ë‹«ê¸°
            
            const resDiv = document.getElementById('result-list');
            resDiv.innerHTML = "<p style='text-align:center;'>ğŸ“¦ ì „ì²´ ì¬ê³ ë¥¼ ê³„ì‚° ì¤‘ì…ë‹ˆë‹¤...</p>";

            fetch(`${gasUrl}?action=inventory`)
                .then(res => res.json())
                .then(data => {
                    if (data.length === 0) { resDiv.innerHTML = "<p>ì¬ê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>"; return; }
                    let html = '<table style="margin-top:0"><tr><th>í’ˆëª©(ê·œê²©)</th><th>í˜„ì¬ê³ </th></tr>';
                    data.forEach(item => {
                        let color = item.qty < 0 ? 'red' : 'blue'; 
                        html += `<tr>
                            <td>${item.name}<br><small style='color:#888'>${item.spec}</small></td>
                            <td style='font-weight:bold; color:${color}'>${item.qty} ${item.unit}</td>
                        </tr>`;
                    });
                    resDiv.innerHTML = html + '</table>';
                });
        }

        function runSearch() {
            const val = document.getElementById('searchInput').value;
            if(!val) return;
            const resDiv = document.getElementById('result-list');
            resDiv.innerHTML = "ê²€ìƒ‰ ì¤‘...";
            fetch(`${gasUrl}?action=search&item=${encodeURIComponent(val)}`)
                .then(res => res.json())
                .then(data => {
                    let html = '<table>';
                    data.forEach(item => {
                        html += `<tr><td>${item.name}<br><small>${item.spec}</small></td><td style='text-align:right'><button class="action-btn" style="padding:5px;" onclick="addToList('${item.name}','${item.spec}','${item.unit}')">ì¶”ê°€</button></td></tr>`;
                    });
                    resDiv.innerHTML = html + '</table>';
                });
        }

        function addToList(name, spec, unit) {
            const date = new Date().toISOString().split('T')[0];
            workList.push({ date, name, spec, unit, qty: 1 });
            renderList();
        }

        function updateQty(index, val) { workList[index].qty = val; }

        function renderList() {
            const listDiv = document.getElementById('saved-list');
            const btn = document.getElementById('send-btn');
            if (workList.length === 0) { listDiv.innerHTML = ""; btn.style.display = 'none'; return; }
            let html = '<table><tr><th>í’ˆëª©</th><th>ìˆ˜ëŸ‰</th></tr>';
            workList.forEach((item, index) => {
                html += `<tr><td>${item.name}<br><small>${item.spec}</small></td><td><input type="number" value="${item.qty}" onchange="updateQty(${index}, this.value)"> ${item.unit}</td></tr>`;
            });
            listDiv.innerHTML = html + '</table>';
            btn.style.display = 'block';
        }

        function saveToSheet() {
            const typeName = (currentMode === 'in') ? "ë§¤ì…ì¥" : "ì¶œê³ ì¥";
            if(!confirm(`${typeName}ì— ì €ì¥í• ê¹Œìš”?`)) return;
            const btn = document.getElementById('send-btn');
            btn.disabled = true; btn.innerText = "ì €ì¥ ì¤‘...";

            fetch(`${gasUrl}?action=save&type=${currentMode}&data=${encodeURIComponent(JSON.stringify(workList))}`)
                .then(res => res.text())
                .then(() => {
                    alert("ì €ì¥ ì™„ë£Œ!");
                    workList = []; renderList();
                    btn.disabled = false; btn.innerText = typeName + " ì €ì¥í•˜ê¸°";
                });
        }
    </script>
</body>
</html>
