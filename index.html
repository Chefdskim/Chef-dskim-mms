<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHEF SYSTEM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main: #2c3e50; --bg: #ffffff; --line: #f1f3f5; --text: #212529; }
        body { font-family: sans-serif; margin: 0; background: var(--bg); color: var(--text); padding-bottom: 70px; }
        
        /* 헤더 */
        .app-header { height: 60px; display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid var(--line); font-weight: bold; font-size: 18px; }
        .back-btn { margin-right: 15px; cursor: pointer; }

        /* 메인 메뉴 */
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; padding: 20px; }
        .grid-item { text-align: center; cursor: pointer; }
        .icon { width: 50px; height: 50px; background: #f8f9fa; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; font-size: 20px; }

        /* 검색창 및 분류 버튼 영역 */
        .search-box { padding: 15px 20px 5px 20px; background: white; display: flex; gap: 10px; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; }
        button { padding: 10px 20px; background: var(--main); color: white; border: none; border-radius: 8px; font-weight: bold; }
        
        .category-area { padding: 10px 20px 15px 20px; border-bottom: 1px solid var(--line); background: white; }
        .category-title { font-size: 12px; font-weight: bold; color: #888; margin-bottom: 8px; margin-top: 10px; }
        .tag-group { display: flex; gap: 6px; flex-wrap: wrap; }
        .tag-btn { padding: 6px 14px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 20px; font-size: 13px; color: #333; cursor: pointer; }
        .tag-btn:active { background: var(--main); color: white; border-color: var(--main); }

        /* 레시피 리스트 (제목만 나오는 형태) */
        .list-item { padding: 15px 20px; border-bottom: 1px solid var(--line); }
        .list-title-row { font-weight: bold; font-size: 16px; display: flex; justify-content: space-between; cursor: pointer; }
        .list-type { font-size: 12px; color: #888; font-weight: normal; }
        
        /* 하단 네비 */
        .nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: white; border-top: 1px solid var(--line); display: flex; justify-content: space-around; align-items: center; }
        .nav-item { color: #adb5bd; font-size: 10px; text-align: center; cursor: pointer; }
        .nav-item.active { color: var(--main); font-weight: bold; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 3px; }

        .workspace { display: none; }
    </style>
</head>
<body>

    <div id="main-view">
        <div class="app-header">CHEF DSKIM SYSTEM</div>
        <div class="grid">
            <div class="grid-item" onclick="openModule('100')"><div class="icon" style="color:#f39c12"><i class="fas fa-book"></i></div>레시피</div>
            <div class="grid-item" onclick="openModule('400')"><div class="icon" style="color:#9b59b6"><i class="fas fa-flask"></i></div>연구노트</div>
            <div class="grid-item" onclick="openModule('010')"><div class="icon" style="color:#34495e"><i class="fas fa-boxes"></i></div>자산재고</div>
            <div class="grid-item" onclick="openModule('020')"><div class="icon" style="color:#e74c3c"><i class="fas fa-chart-pie"></i></div>손익관리</div>
            <div class="grid-item" onclick="openModule('030')"><div class="icon" style="color:#27ae60"><i class="fas fa-graduation-cap"></i></div>교육</div>
            <div class="grid-item" onclick="openModule('900')"><div class="icon" style="color:#2980b9"><i class="fas fa-cloud"></i></div>자료실</div>
            <div class="grid-item" onclick="openModule('500')"><div class="icon" style="color:#e67e22"><i class="fas fa-calendar"></i></div>일정</div>
            <div class="grid-item" onclick="openModule('600')"><div class="icon" style="color:#7f8c8d"><i class="fas fa-bullhorn"></i></div>공지</div>
        </div>
    </div>

    <div id="workspace-100" class="workspace">
        <div class="app-header"><i class="fas fa-arrow-left back-btn" onclick="goMain()"></i> 표준 레시피</div>
        
        <div class="search-box">
            <input type="text" id="recipeInput" placeholder="메뉴 검색 (엔터)">
            <button onclick="loadRecipe(document.getElementById('recipeInput').value)">찾기</button>
        </div>

        <div class="category-area">
            <div class="category-title">식재료별 분류</div>
            <div class="tag-group">
                <div class="tag-btn" onclick="loadRecipe('소고기')">소고기</div>
                <div class="tag-btn" onclick="loadRecipe('돼지')">돼지고기</div>
                <div class="tag-btn" onclick="loadRecipe('닭')">닭고기</div>
                <div class="tag-btn" onclick="loadRecipe('해산물')">해산물</div>
                <div class="tag-btn" onclick="loadRecipe('채소')">채소</div>
            </div>

            <div class="category-title">조리법별 분류</div>
            <div class="tag-group">
                <div class="tag-btn" onclick="loadRecipe('구이')">구이</div>
                <div class="tag-btn" onclick="loadRecipe('볶음')">볶음</div>
                <div class="tag-btn" onclick="loadRecipe('튀김')">튀김</div>
                <div class="tag-btn" onclick="loadRecipe('찜')">찜</div>
                <div class="tag-btn" onclick="loadRecipe('탕')">탕/찌개</div>
                <div class="tag-btn" onclick="loadRecipe('면')">면요리</div>
            </div>
        </div>

        <div id="recipe-list">
            </div>
    </div>

    <div id="workspace-010" class="workspace"><div class="app-header"><i class="fas fa-arrow-left back-btn" onclick="goMain()"></i> 자산/재고</div></div>
    <div id="workspace-020" class="workspace"><div class="app-header"><i class="fas fa-arrow-left back-btn" onclick="goMain()"></i> 손익관리</div></div>
    <div id="workspace-400" class="workspace"><div class="app-header"><i class="fas fa-arrow-left back-btn" onclick="goMain()"></i> 연구노트</div></div>
    <div id="workspace-030" class="workspace"><div class="app-header"><i class="fas fa-arrow-left back-btn" onclick="goMain()"></i> 직원 교육</div></div>
    <div id="workspace-900" class="workspace"><div class="app-header"><i class="fas fa-arrow-left back-btn" onclick="goMain()"></i> 자료실</div></div>
    <div id="workspace-500" class="workspace"><div class="app-header"><i class="fas fa-arrow-left back-btn" onclick="goMain()"></i> 매장 일정</div></div>
    <div id="workspace-600" class="workspace"><div class="app-header"><i class="fas fa-arrow-left back-btn" onclick="goMain()"></i> 공지사항</div></div>

    <nav class="nav">
        <div class="nav-item active" onclick="goMain()"><i class="fas fa-home"></i>홈</div>
        <div class="nav-item" onclick="openModule('100')"><i class="fas fa-book"></i>레시피</div>
        <div class="nav-item" onclick="openModule('010')"><i class="fas fa-bars"></i>관리</div>
    </nav>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";

        function goMain() { 
            document.querySelectorAll('.workspace').forEach(e=>e.style.display='none'); 
            document.getElementById('main-view').style.display='block'; 
        }

        function openModule(id) {
            document.getElementById('main-view').style.display='none';
            document.querySelectorAll('.workspace').forEach(e=>e.style.display='none');
            document.getElementById('workspace-'+id).style.display='block';
            
            // 레시피 화면에 처음 들어갈 때는 목록을 비워둠 (자동으로 쫙 나열되는 것 방지)
            if(id === '100') {
                document.getElementById('recipeInput').value = "";
                document.getElementById('recipe-list').innerHTML = "<div style='padding:40px 20px; text-align:center; color:#adb5bd; font-size:14px;'>위에서 분류를 선택하거나 검색해주세요.</div>";
            }
        }

        function loadRecipe(keywordStr) {
            const area = document.getElementById('recipe-list');
            area.innerHTML = "<div style='padding:20px; color:#999; text-align:center;'>데이터를 불러오는 중입니다...</div>";

            fetch(`${gasUrl}?action=recipe&keyword=${encodeURIComponent(keywordStr)}`).then(r=>r.json()).then(l => {
                let h = "";
                l.forEach((i, idx) => {
                    // 이미지 처리
                    let imgHtml = "";
                    if (i.img && i.img.includes("http")) {
                        let src = i.img;
                        if (src.includes("drive.google.com")) {
                            let matchId = src.match(/[-\w]{25,}/);
                            if (matchId) src = `https://drive.google.com/uc?export=view&id=${matchId[0]}`;
                        }
                        imgHtml = `<img src="${src}" style="width:100%; border-radius:8px; margin-top:10px; border:1px solid #eee; display:block;">`;
                    }

                    let dStr = i.details.map(d => `<b>${d.cat}:</b> ${d.text}`).join("<br>");
                    
                    // 제목 라인 (클릭 시 아래 상세내용 토글)
                    h += `<div class="list-item">
                            <div class="list-title-row" onclick="toggleDetail('recipe-detail-${idx}')">
                                <span>${i.name}</span> 
                                <span class="list-type">${i.type} ▼</span>
                            </div>
                            <div id="recipe-detail-${idx}" style="display:none; margin-top:15px; padding-top:10px; border-top:1px dashed #eee;">
                                ${imgHtml}
                                <div style="margin-top:8px; font-size:14px; line-height:1.6; color:#495057;">${dStr}</div>
                            </div>
                          </div>`;
                });
                area.innerHTML = h || "<div style='padding:30px 20px; text-align:center; color:#999;'>해당하는 레시피가 없습니다.</div>";
            });
        }

        // 클릭 시 내용을 접었다 폈다 하는 함수
        function toggleDetail(id) {
            const el = document.getElementById(id);
            if(el.style.display === 'none') {
                el.style.display = 'block';
            } else {
                el.style.display = 'none';
            }
        }

        document.getElementById('recipeInput').addEventListener('keypress', e => { 
            if(e.key === 'Enter') loadRecipe(document.getElementById('recipeInput').value); 
        });
    </script>
</body>
</html>
