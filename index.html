<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef_dskim SYSTEM</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }

        /* ë²„íŠ¼ ë° ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .main-btn { width: 100%; padding: 20px; margin-bottom: 10px; font-size: 16px; font-weight: bold; border: 1px solid #ccc; border-radius: 8px; background: #fff; cursor: pointer; text-align: left; }
        .code-tag { color: #888; font-size: 12px; display: block; margin-bottom: 5px; }
        #submenu-000 { display: none; background: #f8f9fa; margin-top: -5px; margin-bottom: 15px; padding: 5px; border: 1px solid #ddd; border-top: none; }
        .sub-btn { width: 100%; padding: 15px; border: none; border-bottom: 1px solid #eee; background: none; text-align: left; cursor: pointer; font-size: 15px; }
        .sub-btn:hover { background: #e9ecef; font-weight: bold; }
        .workspace { display: none; }
        .back-btn { background: none; border: none; color: #555; margin-bottom:15px; cursor:pointer; }
        
        /* ê³µí†µ UI ìš”ì†Œ */
        .mode-switch { display: flex; gap: 5px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-weight: bold; cursor: pointer; background: #fff; color: #777; font-size: 13px; }
        .mode-btn.active-in { background: #e8f8f5; border-color: #27ae60; color: #27ae60; }
        .mode-btn.active-out { background: #fdedec; border-color: #e74c3c; color: #e74c3c; }
        .mode-btn.active-stock { background: #eaf2f8; border-color: #3498db; color: #3498db; }
        .search-box { display: flex; gap: 5px; margin-bottom: 15px; }
        input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        .action-btn { padding: 10px 20px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        
        /* 020 ìŠ¤íƒ€ì¼ */
        .finance-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .finance-item { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; text-align: center; }
        .finance-label { font-size: 12px; color: #7f8c8d; margin-bottom: 5px; }
        .finance-val { font-size: 16px; font-weight: bold; color: #2c3e50; }
        .finance-profit { color: #e74c3c !important; } .finance-profit.plus { color: #27ae60 !important; }
        .status-box { text-align: center; padding: 15px; border-radius: 8px; font-weight: bold; margin-bottom: 30px; font-size: 14px; }
        .status-box.plus { background: #e8f8f5; color: #27ae60; border: 1px solid #d1f2eb; }
        .status-box.minus { background: #fdedec; color: #e74c3c; border: 1px solid #fadbd8; }
        .menu-card { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 15px 0; }
        .menu-name { font-weight: bold; font-size: 15px; color: #333; }
        .menu-cost-info { font-size: 12px; color: #777; margin-top: 4px; }
        .cost-badge { padding: 5px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .cost-good { background: #e8f8f5; color: #27ae60; } .cost-bad { background: #fdedec; color: #e74c3c; } 
        
        /* [100] ë ˆì‹œí”¼ ìƒì„¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .recipe-card { background: white; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; overflow: hidden; }
        .recipe-header { background: #2c3e50; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .recipe-title { font-size: 18px; font-weight: bold; }
        .recipe-type { background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 15px; font-size: 12px; }
        .recipe-body { padding: 15px; }
        .recipe-section { margin-bottom: 15px; }
        .section-title { font-size: 14px; color: #e67e22; font-weight: bold; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 8px; }
        .ing-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px; border-bottom: 1px dashed #f4f4f4; padding-bottom: 2px; }
        .step-row { display: flex; gap: 10px; font-size: 13px; margin-bottom: 10px; }
        .step-num { font-weight: bold; color: #2c3e50; min-width: 50px; }
        .step-txt { line-height: 1.5; color: #555; }
        .tip-box { background: #fffbe6; border: 1px solid #ffe58f; padding: 10px; border-radius: 5px; font-size: 12px; color: #856404; margin-top: 10px; }
        .video-link { display: inline-block; font-size: 11px; color: #3498db; text-decoration: none; border: 1px solid #3498db; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }

        /* ë§¤ë‰´ì–¼ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .info-card { background: white; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .info-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .info-title { font-size: 16px; font-weight: bold; color: #2c3e50; }
        .info-cat { font-size: 11px; background: #f1f1f1; padding: 3px 8px; border-radius: 12px; color: #666; }
        .info-content { font-size: 13px; color: #555; line-height: 1.6; white-space: pre-wrap; margin-top:10px; border-top:1px dashed #eee; padding-top:10px;}

    </style>
</head>
<body>

    <div class="container">
        <h2 id="page-title">MAIN MENU</h2>

        <div id="main-nav">
            <button class="main-btn" onclick="toggleSubMenu()"><span class="code-tag">000</span> ê¸°ì¤€ì •ë³´ (ADMIN) â–¼</button>
            <div id="submenu-000">
                <button class="sub-btn" onclick="openModule('010')">010 ì…ì¶œê³ /ì›ê°€ ê´€ë¦¬</button>
                <button class="sub-btn" onclick="openModule('020')">020 ì‚¬ì—…ê¸°íš_ìš´ì˜</button>
                <button class="sub-btn" onclick="openModule('030')">030 ì§ì›êµìœ¡ (ë§¤ë‰´ì–¼)</button>
            </div>
            <button class="main-btn" onclick="openModule('100')"><span class="code-tag">100~300</span> êµ­ê°€ë³„ ìš”ë¦¬ (ë ˆì‹œí”¼) ğŸ“–</button>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">400</span> ì‹¬í™” ì—°êµ¬ (R&D)</button>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">900</span> ìë£Œì‹¤ (ARCHIVE)</button>
        </div>

        <div id="workspace-010" class="workspace">
            <button class="back-btn" onclick="goBackMain()">â—€ ë©”ì¸ìœ¼ë¡œ</button>
            <div class="asset-box"><div style="font-size:13px; color:#3498db; font-weight:bold;">ğŸ’° í˜„ì¬ ì´ ì¬ê³  ìì‚°</div><div id="asset-value" style="font-size:24px; font-weight:bold;">0 ì›</div></div>
            <div class="mode-switch" style="margin-top:20px;"><button id="btn-in" class="mode-btn active-in" onclick="setMode('in')">ğŸ“¥ ë§¤ì…</button><button id="btn-out" class="mode-btn" onclick="setMode('out')">ğŸ“¤ ì¶œê³ </button><button id="btn-stock" class="mode-btn" onclick="loadStock()">ğŸ“¦ ì¬ê³ </button></div>
            <div id="search-area" class="search-box"><input type="text" id="searchInput" placeholder="í’ˆëª©ëª… ì…ë ¥"><button class="action-btn" id="searchBtn">ê²€ìƒ‰</button></div>
            <div id="result-list"></div><div id="work-area" style="margin-top:30px; border-top:2px solid #eee; padding-top:15px;"><strong id="list-title">ğŸ“‹ ë§¤ì… ë¦¬ìŠ¤íŠ¸</strong><div id="saved-list"></div><button id="send-btn" class="save-btn bg-in" onclick="saveToSheet()" style="display:none; width:100%; padding:15px; border:none; border-radius:8px; margin-top:20px; font-weight:bold; color:white;">ì €ì¥í•˜ê¸°</button></div>
        </div>
        <div id="workspace-020" class="workspace">
            <button class="back-btn" onclick="goBackMain()">â—€ ë©”ì¸ìœ¼ë¡œ</button><h3 style="margin-bottom:20px;">ğŸ“Š ì‚¬ì—… ê¸°íš & ìš´ì˜</h3>
            <div class="finance-grid"><div class="finance-item"><div class="finance-label">ë§¤ì¶œ</div><div class="finance-val" id="fin-current">0</div></div><div class="finance-item"><div class="finance-label">ê³ ì •ë¹„</div><div class="finance-val" id="fin-fixed">0</div></div><div class="finance-item"><div class="finance-label">ë³€ë™ë¹„</div><div class="finance-val" id="fin-variable">0</div></div><div class="finance-item"><div class="finance-label">ìˆœì´ìµ</div><div class="finance-val finance-profit" id="fin-profit">0</div></div></div>
            <div id="status-msg-box" class="status-box">ë¶„ì„ ì¤‘...</div><div style="margin-top:30px;"><h3 style="border-bottom:2px solid #333; padding-bottom:10px;">ğŸ” ë©”ë‰´ ì›ê°€ ë¶„ì„</h3><div id="menu-list-area"></div></div>
        </div>
        <div id="workspace-030" class="workspace">
            <button class="back-btn" onclick="goBackMain()">â—€ ë©”ì¸ìœ¼ë¡œ</button><h3 style="margin-bottom:20px;">ğŸ“˜ ì§ì› êµìœ¡ ë§¤ë‰´ì–¼</h3><div id="manual-list-area"></div>
        </div>

        <div id="workspace-100" class="workspace">
            <button class="back-btn" onclick="goBackMain()">â—€ ë©”ì¸ìœ¼ë¡œ</button>
            <h3 style="margin-bottom:20px;">ğŸ“– ë ˆì‹œí”¼ ë°ì´í„°ë² ì´ìŠ¤</h3>
            <div class="search-box">
                <input type="text" id="recipeInput" placeholder="ë©”ë‰´ëª… ê²€ìƒ‰ (ì˜ˆ: ë¶ˆê³ ê¸°, íŒŒìŠ¤íƒ€)">
                <button class="action-btn" onclick="loadRecipe()">ê²€ìƒ‰</button>
            </div>
            <div id="recipe-loading" style="text-align:center; padding:20px; color:#999; display:none;">ë ˆì‹œí”¼ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</div>
            <div id="recipe-list-area"></div>
        </div>
    </div>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        
        function toggleSubMenu() { const el = document.getElementById('submenu-000'); el.style.display = (el.style.display==='block')?'none':'block'; }
        
        function openModule(code) {
            document.getElementById('main-nav').style.display = 'none';
            document.querySelectorAll('.workspace').forEach(el => el.style.display = 'none'); 
            if (code === '010') { document.getElementById('workspace-010').style.display = 'block'; document.getElementById('page-title').innerText = "010 ìì‚°/ì¬ê³ "; setMode('in'); loadAsset(); }
            else if (code === '020') { document.getElementById('workspace-020').style.display = 'block'; document.getElementById('page-title').innerText = "020 ì†ìµ/ì›ê°€"; loadBEP(); loadMenuCost(); }
            else if (code === '030') { document.getElementById('workspace-030').style.display = 'block'; document.getElementById('page-title').innerText = "030 ì§ì›êµìœ¡"; loadManual(); }
            else if (code === '100') { document.getElementById('workspace-100').style.display = 'block'; document.getElementById('page-title').innerText = "100~300 ë ˆì‹œí”¼ DB"; loadRecipe(); }
        }
        function goBackMain() { document.querySelectorAll('.workspace').forEach(el => el.style.display = 'none'); document.getElementById('main-nav').style.display = 'block'; document.getElementById('page-title').innerText = "MAIN MENU"; }

        // [100] ë ˆì‹œí”¼ ë¡œë“œ (NEW!)
        function loadRecipe() {
            const keyword = document.getElementById('recipeInput').value;
            const area = document.getElementById('recipe-list-area');
            const loader = document.getElementById('recipe-loading');
            
            loader.style.display = 'block'; area.innerHTML = "";

            fetch(`${gasUrl}?action=recipe&keyword=${encodeURIComponent(keyword)}`)
                .then(r => r.json())
                .then(list => {
                    loader.style.display = 'none';
                    if(list.length === 0) { area.innerHTML = "<p style='text-align:center; color:#999'>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>"; return; }

                    let html = "";
                    list.forEach(item => {
                        // ì¬ë£Œ HTML ìƒì„±
                        let ingHtml = "";
                        item.ingredients.forEach(ing => {
                            ingHtml += `<div class="ing-row"><span>${ing.item}</span><span style="color:#888; font-size:11px;">${ing.type}</span></div>`;
                        });
                        // ì¡°ë¦¬ê³µì • HTML ìƒì„±
                        let stepHtml = "";
                        item.steps.forEach(st => {
                            let vid = st.video ? `<a href="${st.video}" target="_blank" class="video-link">ğŸ“º ì˜ìƒ</a>` : "";
                            stepHtml += `<div class="step-row"><div class="step-num">${st.step}</div><div class="step-txt">${st.action}${vid}</div></div>`;
                        });
                        // íŒ HTML ìƒì„±
                        let tipHtml = item.tips.length > 0 ? `<div class="tip-box">ğŸ’¡ <b>Chef's Tip:</b> ${item.tips.join("<br>")}</div>` : "";

                        html += `<div class="recipe-card">
                            <div class="recipe-header">
                                <span class="recipe-title">${item.name}</span>
                                <span class="recipe-type">${item.type || 'General'}</span>
                            </div>
                            <div class="recipe-body">
                                ${ingHtml ? `<div class="recipe-section"><div class="section-title">ğŸ¥• ì‹ì¬ë£Œ</div>${ingHtml}</div>` : ""}
                                ${stepHtml ? `<div class="recipe-section"><div class="section-title">ğŸ³ ì¡°ë¦¬ ê³µì •</div>${stepHtml}</div>` : ""}
                                ${tipHtml}
                            </div>
                        </div>`;
                    });
                    area.innerHTML = html;
                });
        }

        // --- ê¸°ì¡´ í•¨ìˆ˜ë“¤ (ê°„ì†Œí™”) ---
        function loadManual() { fetch(`${gasUrl}?action=manual`).then(r=>r.json()).then(l => { const a=document.getElementById('manual-list-area'); if(l.length===0){a.innerHTML="<p>ë°ì´í„° ì—†ìŒ</p>";return;} let h=""; l.forEach(i=>{ let link=i.link?`<a href="${i.link}" target="_blank" style="display:block;margin-top:10px;">ğŸ”— ì˜ìƒ</a>`:""; h+=`<div class="info-card"><div class="info-head"><span class="info-title">${i.title}</span><span class="info-cat">${i.category}</span></div><div class="info-content">${i.content}</div>${link}</div>`; }); a.innerHTML=h; }); }
        function loadBEP() { fetch(`${gasUrl}?action=bep`).then(r=>r.json()).then(d => { document.getElementById('fin-current').innerText=Number(d.current).toLocaleString(); document.getElementById('fin-fixed').innerText=Number(d.fixed).toLocaleString(); document.getElementById('fin-variable').innerText=Number(d.variableCost).toLocaleString(); const p=document.getElementById('fin-profit'); p.innerText=Number(d.netProfit).toLocaleString(); p.className=d.netProfit>0?"finance-val finance-profit plus":"finance-val finance-profit"; document.getElementById('status-msg-box').innerText=d.netProfit>0?"ğŸ‰ í‘ì":"ğŸ“‰ ì ì"; }); }
        function loadMenuCost() { fetch(`${gasUrl}?action=menu_cost`).then(r=>r.json()).then(l => { let h=""; l.forEach(i=>{ let c=i.ratio>35?"cost-bad":"cost-good"; h+=`<div class="menu-card"><div><div class="menu-name">${i.name}</div><div class="menu-cost-info">${Number(i.cost).toLocaleString()} / ${Number(i.price).toLocaleString()}</div></div><div class="cost-badge ${c}">${i.ratio}%</div></div>`; }); document.getElementById('menu-list-area').innerHTML=h||"<p>ë°ì´í„° ì—†ìŒ</p>"; }); }
        let currentMode='in'; let workList=[]; 
        document.addEventListener("DOMContentLoaded", function() {
            const i=document.getElementById("searchInput"), b=document.getElementById("searchBtn"), ri=document.getElementById("recipeInput"); 
            if(i) i.addEventListener("keypress",e=>{if(e.key==="Enter"){e.preventDefault();b.click();}}); if(b) b.addEventListener("click",runSearch); if(ri) ri.addEventListener("keypress",e=>{if(e.key==="Enter"){e.preventDefault();loadRecipe();}});
        });
        function loadAsset(){fetch(`${gasUrl}?action=asset`).then(r=>r.json()).then(d=>{document.getElementById('asset-value').innerText=Number(d.total).toLocaleString()+" ì›";});}
        function setMode(m){currentMode=m;document.getElementById('search-area').style.display=(m==='stock')?'none':'flex';document.getElementById('work-area').style.display=(m==='stock')?'none':'block';document.getElementById('result-list').innerHTML="";document.getElementById('saved-list').innerHTML="";}
        function loadStock(){setMode('stock');fetch(`${gasUrl}?action=inventory`).then(r=>r.json()).then(d=>{let h='<table>';d.forEach(i=>{h+=`<tr><td>${i.name}</td><td>${i.qty}</td></tr>`});document.getElementById('result-list').innerHTML=h+'</table>';});}
        function runSearch(){const v=document.getElementById('searchInput').value;fetch(`${gasUrl}?action=search&item=${v}`).then(r=>r.json()).then(d=>{let h='<table>';d.forEach(i=>{h+=`<tr><td>${i.name}</td><td><button class='action-btn' onclick="addToList('${i.name}','${i.spec}','${i.unit}')">ì¶”ê°€</button></td></tr>`});document.getElementById('result-list').innerHTML=h+'</table>';});}
        function addToList(n,s,u){workList.push({date:new Date().toISOString().split('T')[0],name:n,spec:s,unit:u,qty:1});renderList();}
        function renderList(){let h='<table>';workList.forEach((t,i)=>{h+=`<tr><td>${t.name}</td><td><input type='number' value='${t.qty}' onchange='workList[${i}].qty=this.value'></td></tr>`});document.getElementById('saved-list').innerHTML=h+'</table>';document.getElementById('send-btn').style.display='block';}
        function saveToSheet(){fetch(`${gasUrl}?action=save&type=${currentMode}&data=${encodeURIComponent(JSON.stringify(workList))}`).then(()=>{alert("ì™„ë£Œ");workList=[];renderList();});}
    </script>
</body>
</html>
