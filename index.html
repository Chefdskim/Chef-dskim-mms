<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef_dskim SYSTEM</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        
        /* ë©”ì¸ ë©”ë‰´ ë²„íŠ¼ */
        .main-btn { width: 100%; padding: 20px; margin-bottom: 10px; font-size: 16px; font-weight: bold; border: 1px solid #ccc; border-radius: 8px; background: #fff; cursor: pointer; text-align: left; }
        .code-tag { color: #888; font-size: 12px; display: block; margin-bottom: 5px; }
        
        /* ì„œë¸Œ ë©”ë‰´ */
        #submenu-000 { display: none; background: #f8f9fa; margin-top: -5px; margin-bottom: 15px; border: 1px solid #ddd; border-top: none; padding: 5px; }
        .sub-btn { width: 100%; padding: 15px; border: none; border-bottom: 1px solid #eee; background: none; text-align: left; cursor: pointer; font-size: 15px; }
        .sub-btn:hover { background: #e9ecef; font-weight: bold; }

        /* ì‘ì—… ê³µê°„ ì œì–´ */
        #workspace-010 { display: none; } 
        
        /* ì…ì¶œê³  ëª¨ë“œ ìŠ¤ìœ„ì¹˜ */
        .mode-switch { display: flex; gap: 10px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-weight: bold; cursor: pointer; background: #fff; color: #aaa; }
        
        /* í™œì„±í™”ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .mode-btn.active-in { background: #e8f8f5; border-color: #27ae60; color: #27ae60; }
        .mode-btn.active-out { background: #fdedec; border-color: #e74c3c; color: #e74c3c; }

        /* ê²€ìƒ‰ ë° ë¦¬ìŠ¤íŠ¸ */
        .search-box { display: flex; gap: 5px; margin-bottom: 15px; }
        input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        input[type="number"] { width: 60px; padding: 5px; border: 1px solid #ddd; text-align: center; font-weight: bold; }
        .action-btn { padding: 10px 20px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }

        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; vertical-align: middle; }
        th { background: #f1f1f1; }
        
        .save-btn { width: 100%; padding: 15px; color: white; border: none; border-radius: 8px; margin-top: 20px; font-weight: bold; cursor: pointer; }
        .bg-in { background: #27ae60; } /* ë§¤ì… ë²„íŠ¼ìƒ‰ */
        .bg-out { background: #c0392b; } /* ì¶œê³  ë²„íŠ¼ìƒ‰ */
    </style>
</head>
<body>

    <div class="container">
        <h2 id="page-title">MAIN MENU</h2>

        <div id="main-nav">
            <button class="main-btn" onclick="toggleSubMenu()"><span class="code-tag">000</span> ê¸°ì¤€ì •ë³´ (ADMIN) â–¼</button>
            <div id="submenu-000">
                <button class="sub-btn" onclick="openWorkspace()">010 ì…ì¶œê³ /ì›ê°€ ê´€ë¦¬</button>
                <button class="sub-btn" onclick="alert('ì¤€ë¹„ ì¤‘')">020 ì‚¬ì—…ê¸°íš_ìš´ì˜</button>
                <button class="sub-btn" onclick="alert('ì¤€ë¹„ ì¤‘')">030 ì§ì›êµìœ¡</button>
            </div>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">100~300</span> êµ­ê°€ë³„ ìš”ë¦¬ (CUISINE)</button>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">400</span> ì‹¬í™” ì—°êµ¬ (R&D)</button>
            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')"><span class="code-tag">900</span> ìë£Œì‹¤ (ARCHIVE)</button>
        </div>

        <div id="workspace-010">
            <button onclick="goBackMain()" style="background:none; border:none; color:#555; margin-bottom:15px; cursor:pointer;">â—€ ë©”ì¸ìœ¼ë¡œ</button>

            <div class="mode-switch">
                <button id="btn-in" class="mode-btn active-in" onclick="setMode('in')">ğŸ“¥ ë§¤ì…(ì…ê³ )</button>
                <button id="btn-out" class="mode-btn" onclick="setMode('out')">ğŸ“¤ ì¶œê³ (ì‚¬ìš©)</button>
            </div>

            <div class="search-box">
                <input type="text" id="searchInput" placeholder="í’ˆëª©ëª… ì…ë ¥ (ì˜ˆ: ëŒ€ê²Œ)">
                <button class="action-btn" id="searchBtn">ê²€ìƒ‰</button>
            </div>

            <div id="result-list"></div>

            <div style="margin-top:30px; border-top:2px solid #eee; padding-top:15px;">
                <strong id="list-title">ğŸ“‹ ë§¤ì… ë¦¬ìŠ¤íŠ¸</strong>
                <div id="saved-list"></div>
                <button id="send-btn" class="save-btn bg-in" onclick="saveToSheet()" style="display:none;">ë§¤ì…ì¥ ì €ì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        
        let currentMode = 'in'; // ê¸°ë³¸ê°’: ë§¤ì…
        let workList = []; // ì‘ì—… ì¤‘ì¸ ë¦¬ìŠ¤íŠ¸

        document.addEventListener("DOMContentLoaded", function() {
            const input = document.getElementById("searchInput");
            const btn = document.getElementById("searchBtn");
            input.addEventListener("keypress", function(e) { if(e.key==="Enter") { e.preventDefault(); btn.click(); } });
            btn.addEventListener("click", runSearch);
        });

        // [í™”ë©´ ì „í™˜]
        function toggleSubMenu() {
            const el = document.getElementById('submenu-000');
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }
        function openWorkspace() {
            document.getElementById('main-nav').style.display = 'none';
            document.getElementById('workspace-010').style.display = 'block';
            document.getElementById('page-title').innerText = "ì…ì¶œê³ /ì›ê°€ ê´€ë¦¬";
            document.getElementById('searchInput').focus();
            setMode('in'); // ì—´ë¦´ ë•Œ ë§¤ì… ëª¨ë“œë¡œ ì´ˆê¸°í™”
        }
        function goBackMain() {
            document.getElementById('workspace-010').style.display = 'none';
            document.getElementById('main-nav').style.display = 'block';
            document.getElementById('page-title').innerText = "MAIN MENU";
            workList = []; renderList(); // ì´ˆê¸°í™”
        }

        // [ëª¨ë“œ ë³€ê²½]
        function setMode(mode) {
            currentMode = mode;
            const btnIn = document.getElementById('btn-in');
            const btnOut = document.getElementById('btn-out');
            const sendBtn = document.getElementById('send-btn');
            const listTitle = document.getElementById('list-title');

            if (mode === 'in') {
                btnIn.className = "mode-btn active-in";
                btnOut.className = "mode-btn";
                sendBtn.className = "save-btn bg-in";
                sendBtn.innerText = "ë§¤ì…ì¥ ì €ì¥í•˜ê¸°";
                listTitle.innerText = "ğŸ“¥ ë§¤ì… ë¦¬ìŠ¤íŠ¸ (ì…ê³ )";
            } else {
                btnIn.className = "mode-btn";
                btnOut.className = "mode-btn active-out";
                sendBtn.className = "save-btn bg-out";
                sendBtn.innerText = "ì¶œê³ ì¥ ì €ì¥í•˜ê¸°";
                listTitle.innerText = "ğŸ“¤ ì¶œê³  ë¦¬ìŠ¤íŠ¸ (ì‚¬ìš©/íê¸°)";
            }
        }

        // [ê²€ìƒ‰ ë° ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬]
        function runSearch() {
            const val = document.getElementById('searchInput').value;
            if(!val) return;
            const resDiv = document.getElementById('result-list');
            resDiv.innerHTML = "ê²€ìƒ‰ ì¤‘...";

            fetch(`${gasUrl}?action=search&item=${encodeURIComponent(val)}`)
                .then(res => res.json())
                .then(data => {
                    if (data.length === 0) { resDiv.innerHTML = "<p style='color:red'>ê²°ê³¼ ì—†ìŒ</p>"; return; }
                    let html = '<table>';
                    data.forEach(item => {
                        html += `<tr>
                            <td>${item.name}<br><small style='color:#888'>${item.spec}</small></td>
                            <td style='text-align:right'><button class="action-btn" style="padding:5px 10px; font-size:12px;" onclick="addToList('${item.name}','${item.spec}','${item.unit}')">ì¶”ê°€</button></td>
                        </tr>`;
                    });
                    resDiv.innerHTML = html + '</table>';
                });
        }

        function addToList(name, spec, unit) {
            const date = new Date().toISOString().split('T')[0];
            workList.push({ date, name, spec, unit, qty: 1 });
            renderList();
        }

        function updateQty(index, val) {
            workList[index].qty = val;
        }

        function renderList() {
            const listDiv = document.getElementById('saved-list');
            const btn = document.getElementById('send-btn');
            
            if (workList.length === 0) {
                listDiv.innerHTML = "";
                btn.style.display = 'none';
                return;
            }
            let html = '<table><tr><th>í’ˆëª©</th><th>ìˆ˜ëŸ‰</th></tr>';
            workList.forEach((item, index) => {
                html += `<tr>
                    <td>${item.name}<br><small>${item.spec}</small></td>
                    <td><input type="number" value="${item.qty}" onchange="updateQty(${index}, this.value)"> ${item.unit}</td>
                </tr>`;
            });
            listDiv.innerHTML = html + '</table>';
            btn.style.display = 'block';
        }

        function saveToSheet() {
            const typeName = (currentMode === 'in') ? "ë§¤ì…ì¥" : "ì¶œê³ ì¥";
            if(!confirm(`${typeName}ì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            const btn = document.getElementById('send-btn');
            btn.innerText = "ì €ì¥ ì¤‘...";
            btn.disabled = true;

            // action=save ë’¤ì— &type=in ë˜ëŠ” &type=out íŒŒë¼ë¯¸í„° ì¶”ê°€
            fetch(`${gasUrl}?action=save&type=${currentMode}&data=${encodeURIComponent(JSON.stringify(workList))}`)
                .then(res => res.text())
                .then(text => {
                    alert("ì €ì¥ ì™„ë£Œ!");
                    workList = []; renderList();
                    btn.innerText = (currentMode === 'in') ? "ë§¤ì…ì¥ ì €ì¥í•˜ê¸°" : "ì¶œê³ ì¥ ì €ì¥í•˜ê¸°";
                    btn.disabled = false;
                });
        }
    </script>
</body>
</html>
