<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chef Dskim System</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        body, html { width: 100%; height: 100%; overflow: hidden; background: #f8fafc; }
        #root { width: 100%; height: 100%; display: flex; flex-direction: column; }
        
        /* ÏûêÎ£åÏã§ Ïπ¥Îìú */
        .file-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; border: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 1px 2px rgba(0,0,0,0.03); }
        .file-icon { font-size: 24px; margin-right: 12px; }
        .btn-down { background: #eff6ff; color: #2563eb; padding: 8px 14px; border-radius: 8px; font-size: 11px; font-weight: 900; text-decoration: none; border: 1px solid #dbeafe; }

        /* ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
        .btm-nav { height: 60px; background: white; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-around; align-items: center; padding-bottom: env(safe-area-inset-bottom); z-index: 50; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #cbd5e1; font-size: 10px; font-weight: 700; cursor: pointer; }
        .nav-item.active { color: #2563eb; }

        /* Îã¨Î†• Ïä§ÌÉÄÏùº */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); background: #cbd5e1; gap: 1px; flex: 1; overflow-y: auto; grid-auto-rows: minmax(60px, 1fr); border-radius: 12px; overflow: hidden; border: 1px solid #cbd5e1; }
        .calendar-header { background: #f8fafc; text-align: center; font-size: 9px; font-weight: 900; color: #94a3b8; padding: 4px 0; }
        .calendar-day { background: white; padding: 2px; display: flex; flex-direction: column; min-height: 0; cursor: pointer; }
        .calendar-day.selected { background: #eff6ff !important; box-shadow: inset 0 0 0 2px #3b82f6; z-index: 10; }
        
        /* Î°úÍ∑∏Ïù∏ */
        .login-box { background: white; padding: 40px; border-radius: 24px; width: 100%; max-width: 320px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .login-input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px; margin-bottom: 10px; text-align: center; font-weight: 700; outline: none; }
        .login-btn { width: 100%; background: #2563eb; color: white; padding: 12px; border-radius: 12px; font-weight: 900; }
        
        .spin-anim { animation: spin 1s linear infinite; } @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ÏÖ∞ÌîÑÎãòÏù¥ Î≥¥ÎÇ¥Ï£ºÏã† Ï£ºÏÜå Ï†ÅÏö©
        const DRIVE_APP_URL = "https://script.google.com/macros/s/AKfycbzv9AeNIaJ4RFX_r7ek0NPOreudELL7UJBKuNpNXx1TC8vBk1eQ5lXw8TjnFROwWSfa9w/exec"; 
        const MENU_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSnsej-xGogyedNPYTs2iqEMFKAwIL3tipLoSiDDKxKHot-PITnmxYETDseGckqpb6EMiQm39Sfol0-/pub?gid=0&single=true&output=csv";

        const App = () => {
            const [page, setPage] = useState('home'); 
            const [isAuth, setIsAuth] = useState(false);
            const [user, setUser] = useState('');
            const [name, setName] = useState('');
            const [code, setCode] = useState('');
            
            const [files, setFiles] = useState([]);
            const [loading, setLoading] = useState(false);
            const [menus, setMenus] = useState([]);
            const [selDate, setSelDate] = useState(null);
            const [currMonth, setCurrMonth] = useState(new Date());

            useEffect(() => {
                const u = localStorage.getItem('chef_user');
                if(u) { setIsAuth(true); setUser(u); loadMenu(); }
            }, []);

            const login = () => {
                if(!name || !code) return alert('Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
                setIsAuth(true); setUser(name); localStorage.setItem('chef_user', name);
                loadMenu();
            };

            const loadMenu = () => {
                Papa.parse(MENU_CSV, {
                    download: true,
                    header: false,
                    complete: (res) => {
                        let parsed = [];
                        const raw = res.data;
                        let dateIdx = -1;
                        let headers = [];
                        raw.forEach((r, i) => { if(r[0] && r[0].includes('ÎÇ†Ïßú')) { dateIdx = i; headers = r; } });

                        if(dateIdx > -1) {
                            for(let c=1; c<headers.length; c++) {
                                const dStr = headers[c];
                                if(!dStr) continue;
                                const m = dStr.match(/(\d{4}).*(\d{1,2}).*(\d{1,2})/);
                                if(m) {
                                    const y=m[1], mo=m[2].padStart(2,'0'), d=m[3].padStart(2,'0');
                                    const std = `${y}-${mo}-${d}`;
                                    let mo_m='', lu_m='', di_m='';
                                    for(let r=dateIdx+1; r<raw.length; r++) {
                                        const lbl = (raw[r][0]||'').trim();
                                        const val = (raw[r][c]||'').trim();
                                        if(!val) continue;
                                        if(lbl.includes('ÏïÑÏπ®')) mo_m = val;
                                        if(lbl.includes('Ï†êÏã¨')) lu_m = val;
                                        if(lbl.includes('Ï†ÄÎÖÅ')) di_m = val;
                                    }
                                    parsed.push({ date: std, morning: mo_m, lunch: lu_m, dinner: di_m });
                                }
                            }
                        }
                        setMenus(parsed);
                        const today = new Date().toISOString().split('T')[0];
                        const tData = parsed.find(m => m.date === today);
                        setSelDate(tData || { date: today, morning:'', lunch:'', dinner:'' });
                    }
                });
            };

            const loadFiles = () => {
                setLoading(true);
                fetch(DRIVE_APP_URL).then(r=>r.json()).then(d=>{ setFiles(d); setLoading(false); })
                .catch(()=>{ setLoading(false); alert('ÏûêÎ£åÎ•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.'); });
            };

            useEffect(() => { if(page === 'drive' && files.length === 0) loadFiles(); }, [page]);

            const calDays = useMemo(() => {
                const y = currMonth.getFullYear();
                const m = currMonth.getMonth();
                const first = new Date(y, m, 1).getDay();
                const last = new Date(y, m+1, 0).getDate();
                const days = [];
                for(let i=0; i<first; i++) days.push(null);
                for(let i=1; i<=last; i++) {
                    const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                    days.push({ day: i, dateStr: ds, data: menus.find(x => x.date === ds) });
                }
                return days;
            }, [currMonth, menus]);

            if(!isAuth) return (
                <div className="fixed inset-0 flex items-center justify-center bg-slate-50">
                    <div className="login-box">
                        <h1 className="text-2xl font-black italic mb-2">CHEF DSKIM</h1>
                        <p className="text-xs text-blue-500 font-bold mb-6 tracking-widest">SYSTEM ACCESS</p>
                        <input className="login-input" placeholder="Ïù¥Î¶Ñ" value={name} onChange={e=>setName(e.target.value)} />
                        <input className="login-input" type="password" placeholder="ÏΩîÎìú" value={code} onChange={e=>setCode(e.target.value)} />
                        <button className="login-btn mt-2" onClick={login}>Ï†ëÏÜç</button>
                    </div>
                </div>
            );

            return (
                <div className="flex flex-col h-full w-full bg-slate-50">
                    <header className="bg-white px-5 py-4 border-b flex justify-between items-center shadow-sm z-10">
                        <div>
                            <div className="font-black italic text-xl tracking-tighter">CHEF DSKIM</div>
                            <div className="text-[10px] text-slate-400 font-bold tracking-widest">SYSTEM v2.0</div>
                        </div>
                        <div className="text-xs font-bold bg-blue-50 text-blue-600 px-2 py-1 rounded">üë®‚Äçüç≥ {user}</div>
                    </header>

                    <div className="flex-1 overflow-hidden relative">
                        {page === 'home' && (
                            <div className="h-full flex flex-col p-4">
                                <div className="flex justify-between items-center mb-3">
                                    <h2 className="font-black text-lg italic text-slate-700">SCHEDULE</h2>
                                    <div className="flex gap-2 text-sm font-bold bg-white px-2 py-1 rounded-lg border">
                                        <button onClick={()=>setCurrMonth(new Date(currMonth.setMonth(currMonth.getMonth()-1)))}>‚óÄ</button>
                                        <span>{currMonth.getMonth()+1}Ïõî</span>
                                        <button onClick={()=>setCurrMonth(new Date(currMonth.setMonth(currMonth.getMonth()+1)))}>‚ñ∂</button>
                                    </div>
                                </div>
                                <div className="calendar-grid mb-4 bg-white shadow-sm">
                                    {['Ïùº','Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†'].map(d=><div key={d} className="calendar-header">{d}</div>)}
                                    {calDays.map((d,i) => (
                                        <div key={i} className={`calendar-day ${d?.dateStr === selDate?.date ? 'selected' : ''}`}
                                             onClick={()=> d && (d.data ? setSelDate(d.data) : setSelDate({date:d.dateStr}))}>
                                            {d && <span className={`text-[10px] font-bold text-center ${d.data?'text-slate-800':'text-slate-300'}`}>{d.day}</span>}
                                            {d?.data && (d.data.morning || d.data.lunch) && <div className="w-1 h-1 rounded-full bg-blue-500 mx-auto mt-1"></div>}
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-white p-4 rounded-xl border flex-1 shadow-sm overflow-y-auto">
                                    {selDate ? (
                                        <div className="space-y-3">
                                            <div className="flex justify-between border-b pb-2 mb-2">
                                                <span className="font-black text-slate-700">MENU</span>
                                                <span className="font-bold text-blue-600">{selDate.date}</span>
                                            </div>
                                            <div className="bg-slate-50 p-3 rounded border">
                                                <div className="text-[10px] font-black text-orange-500 mb-1">MORNING</div>
                                                <div className="text-sm font-bold">{selDate.morning || '-'}</div>
                                            </div>
                                            <div className="bg-slate-50 p-3 rounded border">
                                                <div className="text-[10px] font-black text-blue-500 mb-1">LUNCH</div>
                                                <div className="text-sm font-bold">{selDate.lunch || '-'}</div>
                                            </div>
                                            <div className="bg-slate-50 p-3 rounded border">
                                                <div className="text-[10px] font-black text-purple-500 mb-1">DINNER</div>
                                                <div className="text-sm font-bold">{selDate.dinner || '-'}</div>
                                            </div>
                                        </div>
                                    ) : <div className="text-center text-slate-300 font-bold mt-10">ÎÇ†Ïßú ÏÑ†ÌÉù</div>}
                                </div>
                            </div>
                        )}

                        {page === 'drive' && (
                            <div className="h-full flex flex-col bg-white">
                                <div className="p-4 border-b bg-slate-50">
                                    <h2 className="font-black text-xl italic">DATA ROOM</h2>
                                    <div className="text-xs text-slate-500 font-bold">Google Drive Connection</div>
                                </div>
                                <div className="flex-1 overflow-y-auto p-4">
                                    {loading ? <div className="text-center py-20 text-blue-500 font-bold spin-anim">Ïä§Ï∫î Ï§ë...</div> :
                                     files.length === 0 ? <div className="text-center py-20 text-slate-300 font-bold">ÏûêÎ£åÍ∞Ä ÏóÜÏäµÎãàÎã§.</div> :
                                     files.map((f, i) => (
                                        <div key={i} className="file-card">
                                            <div className="flex items-center overflow-hidden flex-1">
                                                <div className="file-icon">{f.type.includes('image')?'üñºÔ∏è':f.type.includes('pdf')?'üìÑ':'üìÅ'}</div>
                                                <div className="truncate font-bold text-slate-700 text-sm flex-1">{f.name}</div>
                                            </div>
                                            <a href={f.url} target="_blank" className="btn-down ml-3 shrink-0">Ïó¥Í∏∞</a>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="btm-nav">
                        <div className={`nav-item ${page==='home'?'active':''}`} onClick={()=>setPage('home')}>
                            <div className="nav-icon">üè†</div><span>Ìôà</span>
                        </div>
                        <div className={`nav-item ${page==='drive'?'active':''}`} onClick={()=>setPage('drive')}>
                            <div className="nav-icon">üìÇ</div><span>ÏûêÎ£åÏã§</span>
                        </div>
                        <div className="nav-item" onClick={()=>alert('ÏÑ§Ï†ï Ï§ÄÎπÑÏ§ë')}>
                            <div className="nav-icon">‚öôÔ∏è</div><span>ÏÑ§Ï†ï</span>
                        </div>
                    </div>
                </div>
            );
        };
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
