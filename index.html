<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHEF DSKIM SYSTEM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --bg: #f5f7fa;
            --white: #ffffff;
            --border: #e1e4e8;
            --text-main: #222;
            --point-blue: #3498db;
            --point-red: #e74c3c;
            --point-green: #27ae60;
        }
        
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: var(--text-main); padding-bottom: 80px; }
        
        /* í—¤ë” & ë ˆì´ì•„ì›ƒ */
        .app-header {
            background: url('https://images.unsplash.com/photo-1556910103-1c02745a30bf?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80') center/cover;
            height: 160px; position: relative; display: flex; align-items: flex-end; padding: 20px;
        }
        .header-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.8)); }
        .header-content { position: relative; z-index: 1; color: white; }
        .header-title { font-size: 24px; font-weight: 700; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .header-sub { font-size: 13px; opacity: 0.9; margin-top: 5px; font-weight: 300; }

        .container { max-width: 600px; margin: 0 auto; }
        
        /* ë°”ë¡œê°€ê¸° ê·¸ë¦¬ë“œ */
        .shortcut-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px 5px;
            background: var(--white); padding: 25px 10px; margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-radius: 0 0 20px 20px;
        }
        .shortcut-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .icon-box {
            width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: white; margin-bottom: 8px; box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }
        .shortcut-label { font-size: 11px; font-weight: 500; color: #444; }

        /* ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê³µí†µ */
        .workspace { display: none; background: var(--bg); min-height: 100vh; }
        .page-header {
            padding: 15px 20px; background: var(--white); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; position: sticky; top: 0; z-index: 50;
        }
        .back-btn { border: none; background: none; font-size: 20px; margin-right: 15px; cursor: pointer; color: var(--text-main); }
        .page-name { font-size: 18px; font-weight: 700; color: var(--primary); }
        .detail-container { padding: 15px; }

        /* [ìì‚°/ì¬ê³ ] ì…ë ¥ ì½˜ì†” */
        .console-box { background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .mode-tabs { display: flex; background: #f0f0f0; border-radius: 8px; padding: 4px; margin-bottom: 15px; }
        .mode-tab { flex: 1; border: none; background: none; padding: 8px; font-size: 13px; font-weight: bold; color: #777; cursor: pointer; border-radius: 6px; }
        .mode-tab.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .mode-tab.active.out { color: var(--point-red); }
        .input-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .console-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; outline: none; }
        .console-btn { padding: 0 15px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .staging-list { background: #f9f9f9; border: 1px dashed #ddd; border-radius: 6px; padding: 10px; margin-bottom: 10px; min-height: 50px; }
        .stage-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; font-size: 13px; }
        .save-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 14px; cursor: pointer; }

        /* [ì†ìµê´€ë¦¬] ë‹¬ë ¥ ìŠ¤íƒ€ì¼ (NEW) */
        .calendar-wrap { background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .cal-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; font-size: 16px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .cal-day-name { font-size: 12px; color: #888; padding-bottom: 5px; }
        .cal-day { 
            height: 60px; border: 1px solid #eee; border-radius: 4px; display: flex; flex-direction: column; 
            justify-content: flex-start; align-items: center; padding-top: 5px; cursor: pointer; position: relative;
        }
        .cal-day.today { border: 1px solid var(--point-blue); background: #f0f7ff; }
        .cal-num { font-size: 11px; margin-bottom: 2px; }
        .cal-val { font-size: 10px; font-weight: bold; color: var(--point-blue); word-break: break-all; }
        .cal-input-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); 
            display: none; align-items: center; justify-content: center; z-index: 200;
        }
        .modal-content { background: white; padding: 20px; border-radius: 12px; width: 80%; max-width: 300px; text-align: center; }

        /* í…Œì´ë¸” ë° ê¸°íƒ€ */
        .total-box { background: var(--primary); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .data-table { width: 100%; border-collapse: collapse; background: white; font-size: 13px; }
        .data-table th { background: #f8f9fa; padding: 10px; border-bottom: 2px solid #ddd; text-align: left; color: #555; }
        .data-table td { padding: 12px 10px; border-bottom: 1px solid #eee; }

        /* ë ˆì‹œí”¼, R&D, êµìœ¡ ë“± ê¸°ì¡´ ìŠ¤íƒ€ì¼ */
        .recipe-card { background: white; border-radius: 12px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 1px solid #eee; }
        .recipe-head { background: var(--primary); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .recipe-name { font-size: 18px; font-weight: bold; }
        .recipe-body { padding: 20px; }
        .recipe-step { margin-bottom: 15px; border-bottom: 1px dashed #eee; padding-bottom: 15px; }
        .video-link { display: inline-block; margin-top: 8px; background: #e74c3c; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; font-weight: bold; }
        .rnd-card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); display: flex; gap: 15px; }
        .rnd-thumb { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; background: #eee; flex-shrink: 0; cursor: pointer; }
        .rnd-info { flex: 1; }
        .manual-item { background: white; border-bottom: 1px solid #eee; }
        .manual-header { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 500; }
        .manual-body { display: none; padding: 15px; background: #fafafa; border-top: 1px solid #eee; font-size: 14px; line-height: 1.6; color: #444; }
        .manual-item.active .manual-body { display: block; }
        
        /* í•˜ë‹¨ë°” */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; color: #999; font-size: 10px; cursor: pointer; flex: 1; }
        .nav-btn.active { color: var(--primary); font-weight: bold; }
        .nav-btn i { font-size: 20px; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div id="main-view">
        <div class="app-header">
            <div class="header-overlay"></div>
            <div class="header-content">
                <h1 class="header-title">CHEF DSKIM</h1>
                <div class="header-sub">Professional Kitchen Management</div>
            </div>
        </div>
        <div class="container">
            <div class="shortcut-grid">
                <div class="shortcut-item" onclick="openModule('100')"><div class="icon-box" style="background:#f39c12"><i class="fas fa-book-open"></i></div><span class="shortcut-label">ë ˆì‹œí”¼</span></div>
                <div class="shortcut-item" onclick="openModule('400')"><div class="icon-box" style="background:#9b59b6"><i class="fas fa-flask"></i></div><span class="shortcut-label">ì—°êµ¬ë…¸íŠ¸</span></div>
                <div class="shortcut-item" onclick="openModule('010')"><div class="icon-box" style="background:#34495e"><i class="fas fa-boxes"></i></div><span class="shortcut-label">ìì‚°/ì¬ê³ </span></div>
                <div class="shortcut-item" onclick="openModule('020')"><div class="icon-box" style="background:#e74c3c"><i class="fas fa-chart-line"></i></div><span class="shortcut-label">ì†ìµê´€ë¦¬</span></div>
                <div class="shortcut-item" onclick="openModule('030')"><div class="icon-box" style="background:#27ae60"><i class="fas fa-graduation-cap"></i></div><span class="shortcut-label">ì§ì›êµìœ¡</span></div>
                <div class="shortcut-item" onclick="openModule('900')"><div class="icon-box" style="background:#3498db"><i class="fas fa-folder-open"></i></div><span class="shortcut-label">ìë£Œì‹¤</span></div>
                <div class="shortcut-item" onclick="alert('ì¤€ë¹„ì¤‘')"><div class="icon-box" style="background:#bdc3c7"><i class="fas fa-calendar-alt"></i></div><span class="shortcut-label">ì¼ì •</span></div>
                <div class="shortcut-item" onclick="alert('ì¤€ë¹„ì¤‘')"><div class="icon-box" style="background:#bdc3c7"><i class="fas fa-bullhorn"></i></div><span class="shortcut-label">ê³µì§€ì‚¬í•­</span></div>
            </div>
            <div style="padding: 10px 20px; font-weight: bold; color: #333; display: flex; justify-content: space-between;">
                <span>ìµœì‹  ì—°êµ¬ ê¸°ë¡</span>
                <span style="font-size:12px; color:#888; font-weight:normal;" onclick="openModule('400')">ë”ë³´ê¸° ></span>
            </div>
            <div id="recent-rnd" style="padding: 0 20px;"></div>
        </div>
    </div>

    <div id="workspace-010" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ìì‚° ë° ì¬ê³ </span></div>
        <div class="detail-container">
            <div class="console-box">
                <div style="font-size:12px; font-weight:bold; margin-bottom:10px; color:#555;">ğŸ“‹ ì…ì¶œê³  ë° ì¬ê³ í™•ì¸</div>
                <div class="mode-tabs">
                    <button id="tab-in" class="mode-tab active" onclick="setMode('in')">ğŸ“¥ ë§¤ì…</button>
                    <button id="tab-out" class="mode-tab" onclick="setMode('out')">ğŸ“¤ ì¶œê³ </button>
                    <button id="tab-stock" class="mode-tab" onclick="setMode('stock')">ğŸ“¦ ì¬ê³ í™•ì¸</button>
                </div>
                <div id="input-area">
                    <div class="input-row">
                        <input type="text" id="searchInput" class="console-input" placeholder="í’ˆëª©ëª… ì…ë ¥ (ì˜ˆ: ì–‘íŒŒ)">
                        <button class="console-btn" id="searchBtn">ì°¾ê¸°</button>
                    </div>
                    <div id="search-result" style="margin-bottom:10px;"></div>
                    <div class="staging-list" id="saved-list">
                        <div style="text-align:center; color:#ccc; font-size:12px; padding-top:15px;">ëª©ë¡ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤</div>
                    </div>
                    <button class="save-btn" onclick="saveToSheet()">ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
                </div>
            </div>
            <div class="total-box">
                <div style="font-size:13px; opacity:0.8;">í˜„ì¬ ì´ ì¬ê³  ìì‚°</div>
                <div id="asset-value" style="font-size:28px; font-weight:bold;">0 ì›</div>
            </div>
            <h4 style="margin: 20px 0 10px 0;">ğŸ“¦ ìƒì„¸ ë‚´ì—­</h4>
            <div id="stock-list-area"></div>
        </div>
    </div>

    <div id="workspace-020" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ì†ìµ ë° ì›ê°€</span></div>
        <div class="detail-container">
            <div class="calendar-wrap">
                <div class="cal-header">
                    <span>ğŸ“… ì´ë²ˆë‹¬ ë§¤ì¶œ ê¸°ë¡</span>
                    <span style="font-size:12px; color:#888;">ë‚ ì§œë¥¼ ëˆŒëŸ¬ ì…ë ¥</span>
                </div>
                <div class="cal-grid" id="calendar-grid"></div>
            </div>

            <div class="total-box" style="background:#2c3e50;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>ì›” ë§¤ì¶œ í•©ê³„</span> <span id="fin-current" style="font-weight:bold;">0</span></div>
                <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:12px; opacity:0.8;"><span>(ê³ ì •ë¹„+ë³€ë™ë¹„)</span> <span id="fin-cost">0</span></div>
                <div style="display:flex; justify-content:space-between; color:#e74c3c; background:white; padding:10px; border-radius:8px; margin-top:10px;">
                    <span style="color:#333;">ì˜ˆìƒ ìˆœì´ìµ</span> <span id="fin-profit" style="font-weight:bold; font-size:18px;">0</span>
                </div>
            </div>
            <h4 style="margin: 20px 0 10px 0;">ğŸ“Š ë©”ë‰´ë³„ ì›ê°€ìœ¨</h4>
            <div id="menu-cost-area"></div>
        </div>
    </div>

    <div id="sales-modal" class="cal-input-modal">
        <div class="modal-content">
            <h3 id="modal-date" style="margin-top:0;">2024-02-06</h3>
            <input type="number" id="modal-amount" class="console-input" placeholder="ë§¤ì¶œì•¡ ì…ë ¥" style="width:100%; box-sizing:border-box; margin-bottom:15px;">
            <div style="display:flex; gap:10px;">
                <button class="console-btn" style="flex:1; background:#ccc;" onclick="document.getElementById('sales-modal').style.display='none'">ì·¨ì†Œ</button>
                <button class="console-btn" style="flex:1;" onclick="saveSales()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <div id="workspace-100" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">í‘œì¤€ ë ˆì‹œí”¼</span></div>
        <div style="padding:15px; background:white; border-bottom:1px solid #eee; display:flex; gap:10px;">
            <input type="text" id="recipeInput" class="console-input" style="flex:1;" placeholder="ë©”ë‰´ëª… ì…ë ¥">
            <button class="console-btn" onclick="loadRecipe()">ê²€ìƒ‰</button>
        </div>
        <div id="recipe-list-area" class="detail-container"></div>
    </div>

    <div id="workspace-400" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">R&D ì—°êµ¬ë…¸íŠ¸</span></div>
        <div style="height:400px; border-bottom:1px solid #eee;">
            <iframe id="google-form-frame" style="width:100%; height:100%; border:none;"></iframe>
        </div>
        <div style="padding:15px; display:flex; justify-content:space-between; align-items:center; background:#f9f9f9;">
            <span style="font-weight:bold;">ê¸°ë¡ ëª©ë¡</span>
            <button onclick="loadRnD()" style="font-size:11px; padding:5px 10px; border:1px solid #ddd; background:white; border-radius:4px;">ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div id="rnd-list-area" class="detail-container"></div>
    </div>

    <div id="workspace-030" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ì§ì› êµìœ¡ ë§¤ë‰´ì–¼</span></div>
        <div id="manual-list-area"></div>
    </div>

    <div id="workspace-900" class="workspace">
        <div class="page-header"><button class="back-btn" onclick="goMain()">â†</button><span class="page-name">ìë£Œì‹¤ (Drive)</span></div>
        <div style="text-align:center; padding:20px; color:#666; font-size:13px; background:#f0f7ff;">
            <i class="fab fa-google-drive"></i> êµ¬ê¸€ ë“œë¼ì´ë¸Œì™€ ì—°ë™ëœ íŒŒì¼ ëª©ë¡ì…ë‹ˆë‹¤.
        </div>
        <div id="archive-list-area"></div>
    </div>

    <div class="bottom-nav">
        <div class="nav-btn active" onclick="goMain()"><i class="fas fa-home"></i><span>í™ˆ</span></div>
        <div class="nav-btn" onclick="openModule('100')"><i class="fas fa-book"></i><span>ë ˆì‹œí”¼</span></div>
        <div class="nav-btn" onclick="openModule('400')"><i class="fas fa-flask"></i><span>ì—°êµ¬</span></div>
        <div class="nav-btn" onclick="openModule('900')"><i class="fas fa-folder"></i><span>ìë£Œì‹¤</span></div>
        <div class="nav-btn" onclick="openModule('010')"><i class="fas fa-bars"></i><span>ê´€ë¦¬</span></div>
    </div>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSejJy628hEvS5_0QpukHJsFJF228YCEBgW0W6BDutfpjm-UDQ/viewform?embedded=true"; 

        // ë„¤ë¹„ê²Œì´ì…˜
        function goMain() { document.querySelectorAll('.workspace').forEach(e=>e.style.display='none'); document.getElementById('main-view').style.display='block'; window.scrollTo(0,0); updateNav('í™ˆ'); }
        function openModule(code) {
            document.getElementById('main-view').style.display='none'; document.querySelectorAll('.workspace').forEach(e=>e.style.display='none');
            if(code==='100'){document.getElementById('workspace-100').style.display='block'; loadRecipe(); updateNav('ë ˆì‹œí”¼');}
            else if(code==='400'){document.getElementById('workspace-400').style.display='block'; document.getElementById('google-form-frame').src=formUrl; loadRnD(); updateNav('ì—°êµ¬');}
            else if(code==='900'){document.getElementById('workspace-900').style.display='block'; loadArchive(); updateNav('ìë£Œì‹¤');}
            else if(code==='010'){document.getElementById('workspace-010').style.display='block'; loadAsset(); setMode('in'); updateNav('ê´€ë¦¬');}
            else if(code==='020'){document.getElementById('workspace-020').style.display='block'; loadCalendar(); updateNav('ê´€ë¦¬');}
            else if(code==='030'){document.getElementById('workspace-030').style.display='block'; loadManual(); updateNav('ê´€ë¦¬');}
        }
        function updateNav(n){ document.querySelectorAll('.nav-btn').forEach(b=>{ b.classList.remove('active'); if(b.querySelector('span').innerText===n) b.classList.add('active'); }); }

        // [010] ìì‚°/ì¬ê³ : ì¬ê³ í™•ì¸ ë²„íŠ¼ ìˆ˜ë¦¬ ì™„ë£Œ
        let currentMode = 'in'; let workList = [];
        function setMode(m) {
            currentMode = m;
            document.querySelectorAll('.mode-tab').forEach(t=>t.classList.remove('active'));
            document.getElementById('tab-'+m).classList.add('active');
            
            if(m === 'stock') { 
                document.getElementById('input-area').style.display='none'; 
                loadStockTable(); // ì¬ê³  íƒ­ ëˆ„ë¥´ë©´ ë°”ë¡œ ì¡°íšŒ í•¨ìˆ˜ ì‹¤í–‰
            } else {
                document.getElementById('input-area').style.display='block';
            }
        }
        document.getElementById('searchBtn').addEventListener('click', () => {
            const v = document.getElementById('searchInput').value;
            fetch(`${gasUrl}?action=search&item=${v}`).then(r=>r.json()).then(d => {
                let h = "";
                if(d.length===0) h="<div style='font-size:12px; color:red; padding:5px;'>ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>";
                d.forEach(i => {
                    h += `<div style="padding:10px; background:#f9f9f9; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size:13px;"><b>${i.name}</b> (${i.spec})</span>
                        <button onclick="addToList('${i.name}','${i.spec}','${i.unit}')" style="font-size:11px; padding:4px 8px; background:#333; color:white; border:none; border-radius:4px;">ë‹´ê¸°</button>
                    </div>`;
                });
                document.getElementById('search-result').innerHTML = h;
            });
        });
        function addToList(n,s,u) { workList.push({date: new Date().toISOString().split('T')[0], name:n, spec:s, unit:u, qty:1}); renderList(); }
        function renderList() {
            let h = "";
            workList.forEach((i, idx) => {
                h += `<div class="stage-item"><span>${i.name} 1${i.unit}</span><button onclick="workList.splice(${idx},1);renderList()" style="color:red; background:none; border:none;">âœ•</button></div>`;
            });
            document.getElementById('saved-list').innerHTML = h || "<div style='text-align:center; color:#ccc; font-size:12px; padding-top:15px;'>ëª©ë¡ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤</div>";
        }
        function saveToSheet() {
            if(workList.length === 0) { alert("ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
            fetch(`${gasUrl}?action=save&type=${currentMode}&data=${encodeURIComponent(JSON.stringify(workList))}`)
            .then(() => { alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); workList=[]; renderList(); document.getElementById('search-result').innerHTML=""; });
        }
        function loadAsset() {
            fetch(`${gasUrl}?action=asset`).then(r=>r.json()).then(d => {
                document.getElementById('asset-value').innerText = Number(d.total).toLocaleString() + " ì›";
                let h = `<table class="data-table"><thead><tr><th>ìì‚° í’ˆëª©</th><th style="text-align:right">ê¸ˆì•¡</th></tr></thead><tbody>`;
                d.list.forEach(i => h += `<tr><td>${i.name}</td><td style="text-align:right;">${Number(i.value).toLocaleString()}</td></tr>`);
                document.getElementById('stock-list-area').innerHTML = h+"</tbody></table>";
            });
        }
        function loadStockTable() {
            document.getElementById('stock-list-area').innerHTML = "<div style='padding:20px; text-align:center;'>ì¬ê³  ì¡°íšŒ ì¤‘...</div>";
            fetch(`${gasUrl}?action=inventory`).then(r=>r.json()).then(d => {
                let h = `<table class="data-table"><thead><tr><th>ì¬ê³  í’ˆëª©</th><th style="text-align:right">ìˆ˜ëŸ‰</th></tr></thead><tbody>`;
                d.forEach(i => h += `<tr><td>${i.name}</td><td style="text-align:right;">${i.qty}</td></tr>`);
                document.getElementById('stock-list-area').innerHTML = h+"</tbody></table>";
            });
        }

        // [020] ì†ìµê´€ë¦¬: ë‹¬ë ¥ + í•©ì‚° ë¡œì§
        let salesData = {};
        function loadCalendar() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth(); 
            
            // ë§¤ì¶œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            fetch(`${gasUrl}?action=get_sales`).then(r=>r.json()).then(d => {
                salesData = {};
                d.forEach(i => { salesData[i.date] = i.amount; });
                renderCalendar(year, month);
                calculateProfit(); // ì´í•© ê³„ì‚°
            });
            // ì›ê°€ìœ¨ ë¡œë“œ
            fetch(`${gasUrl}?action=menu_cost`).then(r=>r.json()).then(l=>{
                let h = `<table class="data-table"><thead><tr><th>ë©”ë‰´</th><th style="text-align:right">ì›ê°€ìœ¨(%)</th></tr></thead><tbody>`;
                l.forEach(i => {
                    let c = i.ratio >= 35 ? "red" : "green";
                    h += `<tr><td>${i.name}</td><td style="text-align:right; font-weight:bold; color:${c}">${i.ratio}%</td></tr>`;
                });
                document.getElementById('menu-cost-area').innerHTML = h+"</tbody></table>";
            });
        }
        function renderCalendar(y, m) {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = "";
            const firstDay = new Date(y, m, 1).getDay();
            const lastDate = new Date(y, m+1, 0).getDate();
            
            // ìš”ì¼ í—¤ë”
            const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
            days.forEach(d => grid.innerHTML += `<div class="cal-day-name">${d}</div>`);

            // ë¹ˆì¹¸
            for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;

            // ë‚ ì§œ
            for(let i=1; i<=lastDate; i++) {
                let dateStr = `${y}-${(m+1).toString().padStart(2,'0')}-${i.toString().padStart(2,'0')}`;
                let val = salesData[dateStr] ? Number(salesData[dateStr]).toLocaleString() : "";
                let isToday = (i === new Date().getDate() && m === new Date().getMonth()) ? "today" : "";
                
                grid.innerHTML += `<div class="cal-day ${isToday}" onclick="openSalesModal('${dateStr}')">
                    <span class="cal-num">${i}</span>
                    <span class="cal-val">${val}</span>
                </div>`;
            }
        }
        function openSalesModal(date) {
            document.getElementById('modal-date').innerText = date;
            document.getElementById('modal-amount').value = salesData[date] || "";
            document.getElementById('sales-modal').style.display = 'flex';
        }
        function saveSales() {
            const date = document.getElementById('modal-date').innerText;
            const amt = document.getElementById('modal-amount').value;
            
            fetch(`${gasUrl}?action=save_sales&date=${date}&amount=${amt}`).then(() => {
                document.getElementById('sales-modal').style.display='none';
                loadCalendar(); // ìƒˆë¡œê³ ì¹¨
            });
        }
        function calculateProfit() {
            // ì´ë²ˆë‹¬ ì´ë§¤ì¶œ í•©ì‚°
            const now = new Date();
            const prefix = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}`;
            let totalSales = 0;
            for (let d in salesData) { if(d.startsWith(prefix)) totalSales += Number(salesData[d]); }
            
            document.getElementById('fin-current').innerText = totalSales.toLocaleString();
            
            // ê³ ì •ë¹„/ë³€ë™ë¹„ ê³„ì‚° (BEP ì•¡ì…˜ì—ì„œ ê°€ì ¸ì˜´)
            fetch(`${gasUrl}?action=bep`).then(r=>r.json()).then(b => {
                let variableCost = Math.round(totalSales * b.variableRatio);
                let totalCost = b.fixed + variableCost;
                let profit = totalSales - totalCost;
                
                document.getElementById('fin-cost').innerText = totalCost.toLocaleString();
                document.getElementById('fin-profit').innerText = profit.toLocaleString();
            });
        }

        // [ë‚˜ë¨¸ì§€ ê¸°ëŠ¥] (ë ˆì‹œí”¼ ì—”í„°í‚¤, R&D ë“± ê¸°ì¡´ ë™ì¼)
        document.getElementById('recipeInput').addEventListener('keypress', e=>{if(e.key==='Enter')loadRecipe()});
        function loadRecipe(){/*ê¸°ì¡´ë™ì¼*/}
        function loadRnD(){/*ê¸°ì¡´ë™ì¼*/}
        function loadManual(){/*ê¸°ì¡´ë™ì¼*/}
        function loadArchive(){/*ê¸°ì¡´ë™ì¼*/}

        // ë‚˜ë¨¸ì§€ ë¡œë“œ í•¨ìˆ˜ë“¤ (index.html ë‚´ì—ì„œ ìœ„ì— ì •ì˜ëœ ëŒ€ë¡œ ì‘ë™)
        document.addEventListener("DOMContentLoaded", ()=>loadRnD());
    </script>
</body>
</html>
