<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHEF DSKIM SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;    /* ì§„í•œ ë„¤ì´ë¹„ (ì‹ ë¢°) */
            --accent: #e67e22;     /* ì˜¤ë Œì§€ (ìš”ë¦¬, í™œë ¥) */
            --bg: #f0f2f5;         /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
            --card: #ffffff;       /* ì¹´ë“œ ë°°ê²½ */
            --text: #333333;       /* ê¸°ë³¸ ê¸€ì */
            --gray: #888888;       /* ë³´ì¡° ê¸€ì */
            --radius: 16px;        /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            --shadow: 0 4px 12px rgba(0,0,0,0.08); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
        }

        body { font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 0; background-color: var(--bg); color: var(--text); -webkit-tap-highlight-color: transparent; }
        
        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .app-header { background: var(--primary); color: white; padding: 20px; text-align: center; border-radius: 0 0 20px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); position: sticky; top: 0; z-index: 100; }
        .app-title { margin: 0; font-size: 18px; font-weight: 700; letter-spacing: 1px; }
        .app-subtitle { font-size: 12px; opacity: 0.8; margin-top: 5px; }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; }

        /* ë©”ì¸ ëŒ€ì‹œë³´ë“œ (ê·¸ë¦¬ë“œ) */
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .dash-card { background: var(--card); border-radius: var(--radius); padding: 20px; text-align: center; box-shadow: var(--shadow); cursor: pointer; transition: transform 0.1s; border: none; width: 100%; box-sizing: border-box; }
        .dash-card:active { transform: scale(0.97); background: #fafafa; }
        .dash-icon { font-size: 32px; display: block; margin-bottom: 10px; }
        .dash-title { font-weight: bold; font-size: 15px; color: var(--primary); display: block; }
        .dash-desc { font-size: 11px; color: var(--gray); display: block; margin-top: 4px; }
        
        /* í’€ì‚¬ì´ì¦ˆ ì¹´ë“œ (ê´€ë¦¬ììš© ë“±) */
        .dash-card.full { grid-column: span 2; background: linear-gradient(135deg, #34495e, #2c3e50); color: white; }
        .dash-card.full .dash-title { color: white; }
        .dash-card.full .dash-desc { color: #bdc3c7; }

        /* ì„œë¸Œë©”ë‰´ (ìˆ¨ê¹€) */
        #submenu-000 { display: none; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }
        .sub-chip { background: white; border: 1px solid #ddd; padding: 10px; border-radius: 12px; font-size: 13px; font-weight: bold; color: #555; cursor: pointer; }
        
        /* ì›Œí¬ìŠ¤í˜ì´ìŠ¤ (ê°œë³„ í™”ë©´) */
        .workspace { display: none; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
        .nav-header { display: flex; align-items: center; margin-bottom: 20px; }
        .back-btn { background: none; border: none; font-size: 20px; cursor: pointer; padding: 10px; margin-left: -10px; }
        .page-name { font-weight: bold; font-size: 18px; margin-left: 5px; color: var(--primary); }

        /* ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .info-card { background: var(--card); padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 15px; }
        
        /* ì…ë ¥ì°½ & ë²„íŠ¼ */
        .search-box { display: flex; gap: 10px; margin-bottom: 15px; }
        input[type="text"] { flex: 1; padding: 15px; border: 1px solid #eee; border-radius: 12px; font-size: 16px; background: #f9f9f9; outline: none; transition: 0.2s; }
        input[type="text"]:focus { border-color: var(--primary); background: white; }
        
        .action-btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 12px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 6px rgba(44, 62, 80, 0.2); }
        .action-btn:active { transform: translateY(2px); box-shadow: none; }
        
        /* íƒ­ ë²„íŠ¼ (ë§¤ì…/ì¶œê³ ) */
        .mode-switch { background: #e0e0e0; padding: 4px; border-radius: 14px; display: flex; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 10px; border: none; border-radius: 10px; background: transparent; color: #777; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .mode-btn.active-in { background: white; color: #27ae60; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .mode-btn#btn-out.active-in { color: #e74c3c; } /* ì¶œê³ ì¼ ë•Œ ë¹¨ê°• */
        
        /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .list-item { padding: 15px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .list-item:last-child { border-bottom: none; }

        /* 900ë²ˆ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ (ì—…ê·¸ë ˆì´ë“œ) */
        .file-item { display: flex; align-items: center; padding: 16px; background: white; margin-bottom: 10px; border-radius: 12px; text-decoration: none; color: var(--text); box-shadow: 0 2px 5px rgba(0,0,0,0.03); transition: 0.2s; }
        .file-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.08); }
        .file-icon { width: 40px; height: 40px; background: #f4f6f8; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-right: 15px; }
        .file-info { flex: 1; overflow: hidden; }
        .file-name { font-weight: bold; font-size: 15px; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-date { font-size: 12px; color: var(--gray); }
        .file-arrow { color: #ddd; font-size: 18px; }

        /* ë±ƒì§€ */
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: bold; }
        .badge.idea { background: #fff3cd; color: #856404; }
        .badge.test { background: #f8d7da; color: #721c24; }
        .badge.success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>

    <div class="app-header">
        <h1 class="app-title">CHEF DSKIM</h1>
        <div class="app-subtitle">Kitchen Management System</div>
    </div>

    <div class="container">
        <div id="main-nav">
            <button class="dash-card full" onclick="toggleSubMenu()">
                <span class="dash-icon">âš™ï¸</span>
                <span class="dash-title">ADMIN (ê¸°ì¤€ì •ë³´)</span>
                <span class="dash-desc">ìì‚° / ì†ìµ / êµìœ¡ê´€ë¦¬</span>
            </button>
            
            <div id="submenu-000">
                <button class="sub-chip" onclick="openModule('010')">ğŸ’° ìì‚°/ì¬ê³ </button>
                <button class="sub-chip" onclick="openModule('020')">ğŸ“Š ì†ìµ/ì›ê°€</button>
                <button class="sub-chip" onclick="openModule('030')">ğŸ“ ì§ì›êµìœ¡</button>
            </div>

            <div class="dashboard-grid">
                <button class="dash-card" onclick="openModule('100')">
                    <span class="dash-icon">ğŸ“–</span>
                    <span class="dash-title">ë ˆì‹œí”¼</span>
                    <span class="dash-desc">í‘œì¤€ ì¡°ë¦¬ë²•</span>
                </button>
                <button class="dash-card" onclick="openModule('400')">
                    <span class="dash-icon">ğŸ”¬</span>
                    <span class="dash-title">R&D ì—°êµ¬</span>
                    <span class="dash-desc">ì‹ ë©”ë‰´ ê°œë°œ</span>
                </button>
                <button class="dash-card" onclick="openModule('900')" style="grid-column: span 2; border: 2px solid #8e44ad;">
                    <span class="dash-icon">ğŸ“‚</span>
                    <span class="dash-title" style="color:#8e44ad">ë¹„ë°€ ìë£Œì‹¤</span>
                    <span class="dash-desc">ì¤‘ìš” ë¬¸ì„œ & ì˜ìƒ í´ë¼ìš°ë“œ</span>
                </button>
            </div>
        </div>

        <div id="workspace-010" class="workspace">
            <div class="nav-header"><button class="back-btn" onclick="goBackMain()">â†</button><span class="page-name">ìì‚° ë° ì¬ê³ ê´€ë¦¬</span></div>
            <div class="info-card" style="background: linear-gradient(135deg, #2c3e50, #4ca1af); color:white;">
                <div style="font-size:12px; opacity:0.8; margin-bottom:5px;">ğŸ’° í˜„ì¬ ì´ ì¬ê³  ìì‚°</div>
                <div id="asset-value" style="font-size:28px; font-weight:bold;">0 ì›</div>
            </div>
            <div class="mode-switch">
                <button id="btn-in" class="mode-btn active-in" onclick="setMode('in')">ğŸ“¥ ë§¤ì…</button>
                <button id="btn-out" class="mode-btn" onclick="setMode('out')">ğŸ“¤ ì¶œê³ </button>
                <button id="btn-stock" class="mode-btn" onclick="loadStock()">ğŸ“¦ ì¬ê³ ì¡°íšŒ</button>
            </div>
            <div id="search-area" class="search-box"><input type="text" id="searchInput" placeholder="í’ˆëª©ëª… ê²€ìƒ‰"><button class="action-btn" id="searchBtn">ê²€ìƒ‰</button></div>
            <div class="info-card"><div id="result-list"></div></div>
            <div id="work-area" style="margin-top:20px; display:none;">
                <strong style="display:block; margin-bottom:10px;">ğŸ“‹ ì‘ì—… ë¦¬ìŠ¤íŠ¸</strong>
                <div id="saved-list" class="info-card"></div>
                <button id="send-btn" class="action-btn" onclick="saveToSheet()" style="width:100%;">ì €ì¥í•˜ê¸°</button>
            </div>
        </div>

        <div id="workspace-020" class="workspace">
            <div class="nav-header"><button class="back-btn" onclick="goBackMain()">â†</button><span class="page-name">ì†ìµ ë° ì›ê°€ê´€ë¦¬</span></div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px;">
                <div class="info-card" style="margin:0; text-align:center;"><div>ì´ë²ˆë‹¬ ë§¤ì¶œ</div><div id="fin-current" style="font-size:20px; font-weight:bold; margin-top:5px;">0</div></div>
                <div class="info-card" style="margin:0; text-align:center;"><div>ìˆœì´ìµ</div><div id="fin-profit" style="font-size:20px; font-weight:bold; margin-top:5px; color:#e74c3c;">0</div></div>
            </div>
            <h3 style="font-size:16px; margin-bottom:10px;">ğŸ” ë©”ë‰´ë³„ ì›ê°€ìœ¨</h3>
            <div id="menu-list-area" class="info-card"></div>
        </div>

        <div id="workspace-030" class="workspace">
            <div class="nav-header"><button class="back-btn" onclick="goBackMain()">â†</button><span class="page-name">ì§ì› êµìœ¡ ë§¤ë‰´ì–¼</span></div>
            <div id="manual-list-area"></div>
        </div>

        <div id="workspace-100" class="workspace">
            <div class="nav-header"><button class="back-btn" onclick="goBackMain()">â†</button><span class="page-name">ë ˆì‹œí”¼ ì¡°íšŒ</span></div>
            <div class="search-box"><input type="text" id="recipeInput" placeholder="ë©”ë‰´ëª… (ì˜ˆ: íŒŒìŠ¤íƒ€)"><button class="action-btn" onclick="loadRecipe()">ğŸ”</button></div>
            <div id="recipe-list-area"></div>
        </div>

        <div id="workspace-400" class="workspace">
            <div class="nav-header"><button class="back-btn" onclick="goBackMain()">â†</button><span class="page-name">R&D ì—°êµ¬ë…¸íŠ¸</span></div>
            
            <div class="info-card" style="padding:0; overflow:hidden; height:500px;">
                 <iframe id="google-form-frame" style="width:100%; height:100%; border:none;"></iframe>
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center; margin:20px 0 10px 0;">
                <strong style="font-size:16px;">ğŸ“‹ ì§€ë‚œ ê¸°ë¡</strong>
                <button onclick="loadRnD()" class="action-btn" style="padding:8px 12px; font-size:12px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div id="rnd-list-area"></div>
        </div>

        <div id="workspace-900" class="workspace">
            <div class="nav-header"><button class="back-btn" onclick="goBackMain()">â†</button><span class="page-name">ë¹„ë°€ ìë£Œì‹¤ (Cloud)</span></div>
            <div class="info-card" style="background:#f8f9fa; text-align:center; padding:30px 20px;">
                <div style="font-size:40px; margin-bottom:10px;">â˜ï¸</div>
                <h3 style="margin:0 0 5px 0;">Google Drive ì—°ë™ë¨</h3>
                <p style="font-size:12px; color:#888;">2TB ê³ ì† ì„œë²„ì—ì„œ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</p>
            </div>
            <div style="margin-bottom:10px; font-weight:bold; color:#555;">ğŸ“‚ íŒŒì¼ ëª©ë¡ (ìµœì‹ ìˆœ)</div>
            <div id="archive-list-area"></div>
        </div>
    </div>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSejJy628hEvS5_0QpukHJsFJF228YCEBgW0W6BDutfpjm-UDQ/viewform?embedded=true"; 

        function toggleSubMenu() { 
            const el = document.getElementById('submenu-000'); 
            el.style.display = (el.style.display==='grid')?'none':'grid'; 
        }
        function goBackMain() { 
            document.querySelectorAll('.workspace').forEach(el=>el.style.display='none'); 
            document.getElementById('main-nav').style.display='block'; 
            window.scrollTo(0,0);
        }
        
        function openModule(code) {
            document.getElementById('main-nav').style.display='none'; 
            document.querySelectorAll('.workspace').forEach(el=>el.style.display='none');
            
            if(code==='010'){document.getElementById('workspace-010').style.display='block'; loadAsset(); setMode('in');}
            else if(code==='020'){document.getElementById('workspace-020').style.display='block'; loadBEP(); loadMenuCost();}
            else if(code==='030'){document.getElementById('workspace-030').style.display='block'; loadManual();}
            else if(code==='100'){document.getElementById('workspace-100').style.display='block'; loadRecipe();}
            else if(code==='400'){
                document.getElementById('workspace-400').style.display='block';
                document.getElementById('google-form-frame').src = formUrl;
                loadRnD();
            }
            else if(code==='900'){
                document.getElementById('workspace-900').style.display='block';
                loadArchive();
            }
        }

        // [900] ìë£Œì‹¤
        function loadArchive() {
            const area = document.getElementById('archive-list-area');
            area.innerHTML = "<div style='text-align:center; padding:20px; color:#999;'>ğŸ”„ íŒŒì¼ì„ ì°¾ì•„ì˜¤ëŠ” ì¤‘...</div>";

            fetch(`${gasUrl}?action=archive`).then(r => r.json()).then(list => {
                if(list.length === 0) {
                    area.innerHTML = "<div style='text-align:center; padding:20px; color:#999;'>í´ë”ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</div>";
                    return;
                }
                
                let html = "";
                list.forEach(f => {
                    let icon = "ğŸ“„";
                    let bg = "#f4f6f8";
                    
                    if(f.type.includes("folder")) { icon = "ğŸ“"; bg = "#fff3cd"; }
                    else if(f.type.includes("image")) { icon = "ğŸ–¼ï¸"; bg = "#e8f0fe"; }
                    else if(f.type.includes("pdf")) { icon = "ğŸ“•"; bg = "#fce8e6"; }
                    else if(f.type.includes("video")) { icon = "ğŸ¬"; bg = "#e6fffa"; }
                    else if(f.type.includes("sheet") || f.type.includes("excel")) { icon = "ğŸ“Š"; bg = "#e6fffa"; }

                    html += `<a href="${f.url}" target="_blank" class="file-item">
                        <div class="file-icon" style="background:${bg}">${icon}</div>
                        <div class="file-info">
                            <div class="file-name">${f.name}</div>
                            <div class="file-date">${f.date}</div>
                        </div>
                        <div class="file-arrow">â€º</div>
                    </a>`;
                });
                area.innerHTML = html;
            });
        }

        // [R&D]
        function loadRnD() {
            const area = document.getElementById('rnd-list-area');
            area.innerHTML = "<div style='text-align:center; padding:20px; color:#999;'>ğŸ”„ ë¡œë”© ì¤‘...</div>";
            fetch(`${gasUrl}?action=rnd`).then(r => r.json()).then(l => {
                if(l.length === 0) { area.innerHTML = "<div style='text-align:center; padding:20px;'>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; return; }
                let html = "";
                l.forEach(i => {
                    let badgeClass = "badge";
                    if(i.status && i.status.includes("ì•„ì´ë””ì–´")) badgeClass += " idea";
                    else if(i.status && i.status.includes("í…ŒìŠ¤íŠ¸")) badgeClass += " test";
                    else if(i.status && i.status.includes("ì„±ê³µ")) badgeClass += " success";

                    let imgHtml = "";
                    if (i.photo && i.photo.trim() !== "") {
                        try {
                            let match = i.photo.match(/[-\w]{25,}/);
                            if(match) {
                                let thumbUrl = `https://drive.google.com/uc?export=view&id=${match[0]}`;
                                imgHtml = `<div style="margin-top:10px; text-align:center;">
                                     <img src="${thumbUrl}" style="width:100%; height:200px; object-fit:cover; border-radius:8px;" referrerpolicy="no-referrer" onerror="this.style.display='none';">
                                     <div style="margin-top:5px;"><a href="${thumbUrl}" target="_blank" class="photo-link-btn">ğŸ“· í¬ê²Œ ë³´ê¸°</a></div>
                                   </div>`;
                            } else {
                                imgHtml = `<div style="margin-top:5px;"><a href="${i.photo}" target="_blank" class="photo-link-btn">ğŸ“· ì‚¬ì§„ ë§í¬</a></div>`;
                            }
                        } catch(e) {}
                    }
                    html += `<div class="info-card">
                        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                            <span style="font-weight:bold; font-size:16px; color:#2c3e50;">${i.menu}</span>
                            <span class="${badgeClass}">${i.status}</span>
                        </div>
                        <div style="font-size:12px; color:#999; margin-bottom:10px;">ğŸ“… ${i.date}</div>
                        <p style="font-size:14px; color:#444; line-height:1.5; white-space:pre-wrap;">${i.note}</p>
                        ${imgHtml}
                    </div>`;
                });
                area.innerHTML = html;
            });
        }

        // [ê³µí†µ ë° ê¸°íƒ€]
        function loadRecipe(){const k=document.getElementById('recipeInput').value;const a=document.getElementById('recipe-list-area');a.innerHTML="<div style='text-align:center; padding:20px;'>ğŸ”„ ê²€ìƒ‰ ì¤‘...</div>";fetch(`${gasUrl}?action=recipe&keyword=${encodeURIComponent(k)}`).then(r=>r.json()).then(l=>{if(l.length===0){a.innerHTML="<div style='text-align:center; padding:20px;'>ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>";return;}let h="";l.forEach(i=>{let g={};i.details.forEach(d=>{if(!g[d.section])g[d.section]=[];g[d.section].push(d)});let b="";for(let s in g){if(!s)continue;let r="";g[s].forEach(row=>{let v=row.video?`<a href="${row.video}" target="_blank" class="badge" style="background:red; color:white; text-decoration:none; margin-left:5px;">â–¶ ì˜ìƒ</a>`:"";r+=`<div class="list-item" style="display:block;"><div style="font-weight:bold; font-size:13px; color:#666; margin-bottom:2px;">${row.category}</div><div style="line-height:1.5;">${row.content}${v}</div></div>`});b+=`<div style="margin-top:15px;"><div style="font-weight:bold; color:#e67e22; border-bottom:1px solid #eee; padding-bottom:5px; margin-bottom:5px;">${s}</div>${r}</div>`}h+=`<div class="info-card"><div style="background:#2c3e50; color:white; padding:12px; border-radius:8px; display:flex; justify-content:space-between;"><span style="font-weight:bold;">${i.name}</span><span style="font-size:12px; opacity:0.8; background:rgba(255,255,255,0.2); padding:2px 8px; border-radius:10px;">${i.type}</span></div><div style="padding:10px;">${b}</div></div>`});a.innerHTML=h})}
        let currentMode='in'; let workList=[];
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById('searchBtn').addEventListener('click', ()=>{ const v=document.getElementById('searchInput').value; fetch(`${gasUrl}?action=search&item=${v}`).then(r=>r.json()).then(d=>{ let h=""; d.forEach(i=>{h+=`<div class="list-item"><div><b>${i.name}</b> <small style='color:#888'>(${i.spec})</small></div> <button class="action-btn" onclick="addToList('${i.name}','${i.spec}','${i.unit}')" style="padding:6px 12px; font-size:12px;">ì¶”ê°€</button></div>`}); document.getElementById('result-list').innerHTML=h; }); });
            document.getElementById('recipeInput').addEventListener('keypress',e=>{if(e.key==='Enter')loadRecipe();});
        });
        function loadAsset(){fetch(`${gasUrl}?action=asset`).then(r=>r.json()).then(d=>document.getElementById('asset-value').innerText=Number(d.total).toLocaleString()+" ì›")}
        function loadBEP(){fetch(`${gasUrl}?action=bep`).then(r=>r.json()).then(d=>{document.getElementById('fin-current').innerText=Number(d.current).toLocaleString();const p=document.getElementById('fin-profit');p.innerText=Number(d.netProfit).toLocaleString();p.style.color=d.netProfit>0?"#27ae60":"#e74c3c"})}
        function loadMenuCost(){fetch(`${gasUrl}?action=menu_cost`).then(r=>r.json()).then(l=>{let h="";l.forEach(i=>{let c=i.ratio>35?"badge test":"badge success";h+=`<div class="list-item"><div><b>${i.name}</b><br><small style='color:#888'>${Number(i.cost).toLocaleString()} / ${Number(i.price).toLocaleString()}</small></div><div class="${c}">${i.ratio}%</div></div>`});document.getElementById('menu-list-area').innerHTML=h})}
        function loadManual(){fetch(`${gasUrl}?action=manual`).then(r=>r.json()).then(l=>{let h="";l.forEach(i=>{let link=i.link?`<a href="${i.link}" target="_blank" class="badge" style="background:#3498db; color:white; text-decoration:none;">ğŸ”— ì˜ìƒë³´ê¸°</a>`:"";h+=`<div class="info-card"><b>${i.title}</b> <span style='font-size:12px; color:#888'>| ${i.category}</span><p style='margin:10px 0; line-height:1.5;'>${i.content}</p>${link}</div>`});document.getElementById('manual-list-area').innerHTML=h})}
        function loadStock(){setMode('stock');fetch(`${gasUrl}?action=inventory`).then(r=>r.json()).then(d=>{let h='<table style="width:100%; border-collapse:collapse;">';d.forEach(i=>{h+=`<tr style="border-bottom:1px solid #eee;"><td style="padding:10px;">${i.name}</td><td style="text-align:right; font-weight:bold;">${i.qty}</td></tr>`});document.getElementById('result-list').innerHTML=h+'</table>'})}
        function setMode(m){currentMode=m; document.getElementById('work-area').style.display=m==='stock'?'none':'block'; document.getElementById('search-area').style.display=m==='stock'?'none':'flex'; document.getElementById('result-list').innerHTML=""; 
            document.getElementById('btn-in').className = m==='in'?'mode-btn active-in':'mode-btn';
            document.getElementById('btn-out').className = m==='out'?'mode-btn active-in':'mode-btn';
            document.getElementById('btn-stock').className = m==='stock'?'mode-btn active-in':'mode-btn';
        }
        function addToList(n,s,u){workList.push({date:new Date().toISOString().split('T')[0],name:n,spec:s,unit:u,qty:1}); renderList()}
        function saveToSheet(){fetch(`${gasUrl}?action=save&type=${currentMode}&data=${encodeURIComponent(JSON.stringify(workList))}`).then(()=>{alert("ì €ì¥ ì™„ë£Œ!");workList=[];renderList()})}
        function renderList(){let h=""; workList.forEach((i,idx)=>{h+=`<div class="list-item"><span>${i.name} 1${i.unit}</span> <button onclick="workList.splice(${idx},1);renderList()" style="color:red; border:none; background:none;">ğŸ—‘</button></div>`}); document.getElementById('saved-list').innerHTML=h||"<div style='text-align:center; color:#ccc; padding:10px;'>ëª©ë¡ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤</div>";}
    </script>
</body>
</html>
