<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHEF DSKIM SYSTEM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50; --bg: #f8f9fa; --white: #ffffff;
            --border: #e9ecef; --text: #343a40; --point: #e67e22;
        }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: var(--text); padding-bottom: 80px; }
        
        /* 헤더 & 메인 */
        .app-header { background: var(--white); height: 60px; display: flex; align-items: center; justify-content: center; position: sticky; top: 0; z-index: 50; border-bottom: 1px solid var(--border); }
        .header-title { font-size: 18px; font-weight: 700; color: var(--primary); }
        .back-btn { position: absolute; left: 20px; border: none; background: none; font-size: 20px; cursor: pointer; }
        .container { max-width: 600px; margin: 0 auto; }
        .main-hero { height: 160px; background: linear-gradient(rgba(44,62,80,0.8), rgba(44,62,80,0.8)), url('https://images.unsplash.com/photo-1556910103-1c02745a30bf') center/cover; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
        .hero-title { font-size: 22px; font-weight: bold; margin: 0; }
        .hero-sub { font-size: 12px; opacity: 0.8; margin-top: 5px; }
        .grid-menu { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px 10px; background: white; padding: 25px 15px; border-bottom: 1px solid var(--border); }
        .grid-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .grid-icon { width: 45px; height: 45px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: white; margin-bottom: 8px; }
        .grid-text { font-size: 11px; font-weight: 500; color: #495057; }

        /* 레시피: 카테고리 버튼 및 아코디언 리스트 */
        .search-box { padding: 15px 20px 5px 20px; background: white; display: flex; gap: 10px; }
        .form-input { flex: 1; padding: 10px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 14px; outline: none; }
        .action-btn { padding: 10px 15px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .category-area { padding: 10px 20px 15px 20px; border-bottom: 1px solid var(--border); background: white; }
        .category-title { font-size: 12px; font-weight: bold; color: #888; margin-bottom: 8px; margin-top: 10px; }
        .tag-group { display: flex; gap: 6px; flex-wrap: wrap; }
        .tag-btn { padding: 6px 14px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 20px; font-size: 13px; color: #333; cursor: pointer; }
        .tag-btn:active { background: var(--main); color: white; border-color: var(--main); }
        
        .slim-list { padding: 0; margin: 0; list-style: none; background: white; }
        .slim-item { border-bottom: 1px solid var(--border); }
        .slim-head { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; background: white; transition: background 0.2s; }
        .slim-head:active { background: #f1f3f5; }
        .slim-title { font-size: 15px; font-weight: 500; color: #212529; }
        .slim-badge { font-size: 11px; color: #868e96; background: #f1f3f5; padding: 2px 8px; border-radius: 10px; margin-left: 10px; }
        .slim-body { display: none; padding: 20px; background: #fafafa; border-top: 1px solid #f1f3f5; font-size: 14px; line-height: 1.6; color: #495057; }
        .slim-item.active .slim-body { display: block; }
        .slim-item.active .slim-title { color: var(--point); font-weight: bold; }
        .detail-row { display: flex; margin-bottom: 8px; border-bottom: 1px dashed #e9ecef; padding-bottom: 8px; }
        .detail-label { min-width: 60px; font-weight: bold; color: #868e96; font-size: 12px; margin-right: 10px; }
        .detail-content { flex: 1; }
        .detail-img { width: 100%; border-radius: 8px; margin-bottom: 15px; display: block; border: 1px solid #eee; }

        /* 팝업 모달 & FAB (일정, 공지용) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 200; display: none; align-items: center; justify-content: center; }
        .modal-box { background: white; width: 85%; max-width: 350px; padding: 25px; border-radius: 12px; }
        .modal-title { font-size: 16px; font-weight: bold; margin-bottom: 15px; text-align: center; }
        .fab { position: fixed; bottom: 85px; right: 20px; width: 50px; height: 50px; background: var(--point); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; z-index: 90; }

        /* 기타 공통 모듈 (자산, 손익) */
        .workspace { display: none; min-height: 100vh; background: var(--bg); }
        .console-box { background: white; border-radius: 12px; padding: 15px; margin: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .mode-tabs { display: flex; background: #f8f9fa; padding: 4px; border-radius: 8px; margin-bottom: 15px; }
        .mode-tab { flex: 1; padding: 8px; border: none; background: none; font-size: 13px; font-weight: bold; color: #868e96; cursor: pointer; border-radius: 6px; }
        .mode-tab.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .total-box { background: var(--primary); color: white; padding: 20px; margin: 15px; border-radius: 12px; text-align: center; }
        .data-table { width: 100%; border-collapse: collapse; background: white; font-size: 13px; }
        .data-table td { padding: 12px 10px; border-bottom: 1px solid #eee; }
        .data-table th { padding: 10px; background: #f8f9fa; text-align: left; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; padding: 15px; text-align: center; background: white; margin: 15px; border-radius: 12px; }
        .cal-day { padding: 10px 0; font-size: 14px; border-radius: 6px; cursor: pointer; }
        .cal-day.today { background: var(--primary); color: white; }

        /* 하단 네비 */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: white; border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #adb5bd; font-size: 10px; cursor: pointer; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-icon { font-size: 20px; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div id="main-view">
        <div class="main-hero"><h1 class="hero-title">CHEF DSKIM</h1><div class="hero-sub">System v2.0</div></div>
        <div class="container">
            <div class="grid-menu">
                <div class="grid-item" onclick="openModule('100')"><div class="grid-icon" style="background:#f39c12"><i class="fas fa-book-open"></i></div><span class="grid-text">레시피</span></div>
                <div class="grid-item" onclick="openModule('400')"><div class="grid-icon" style="background:#9b59b6"><i class="fas fa-flask"></i></div><span class="grid-text">연구노트</span></div>
                <div class="grid-item" onclick="openModule('010')"><div class="grid-icon" style="background:#34495e"><i class="fas fa-boxes"></i></div><span class="grid-text">자산재고</span></div>
                <div class="grid-item" onclick="openModule('020')"><div class="grid-icon" style="background:#c0392b"><i class="fas fa-chart-pie"></i></div><span class="grid-text">손익관리</span></div>
                <div class="grid-item" onclick="openModule('030')"><div class="grid-icon" style="background:#27ae60"><i class="fas fa-graduation-cap"></i></div><span class="grid-text">직원교육</span></div>
                <div class="grid-item" onclick="openModule('900')"><div class="grid-icon" style="background:#2980b9"><i class="fas fa-cloud"></i></div><span class="grid-text">자료실</span></div>
                <div class="grid-item" onclick="openModule('500')"><div class="grid-icon" style="background:#e67e22"><i class="fas fa-calendar-check"></i></div><span class="grid-text">일정</span></div>
                <div class="grid-item" onclick="openModule('600')"><div class="grid-icon" style="background:#7f8c8d"><i class="fas fa-bullhorn"></i></div><span class="grid-text">공지</span></div>
            </div>
            <div style="padding:10px 20px; font-weight:bold; color:#868e96; font-size:12px;">최신 활동</div>
            <div id="recent-rnd" style="background:white; border-top:1px solid #eee;"></div>
        </div>
    </div>

    <div id="workspace-100" class="workspace">
        <div class="app-header"><button class="back-btn" onclick="goMain()">←</button><span class="header-title">표준 레시피</span></div>
        <div class="search-box">
            <input type="text" id="recipeInput" class="form-input" placeholder="메뉴 검색 (엔터)">
            <button class="action-btn" onclick="loadRecipe(document.getElementById('recipeInput').value)">검색</button>
        </div>
        <div class="category-area">
            <div class="category-title">식재료별 분류</div>
            <div class="tag-group">
                <div class="tag-btn" onclick="loadRecipe('육류')">육류</div>
                <div class="tag-btn" onclick="loadRecipe('가금류')">가금류</div>
                <div class="tag-btn" onclick="loadRecipe('해산물')">해산물</div>
                <div class="tag-btn" onclick="loadRecipe('채소')">채소</div>
            </div>
            <div class="category-title">조리법별 분류</div>
            <div class="tag-group">
                <div class="tag-btn" onclick="loadRecipe('구이')">구이</div>
                <div class="tag-btn" onclick="loadRecipe('볶음')">볶음</div>
                <div class="tag-btn" onclick="loadRecipe('튀김')">튀김</div>
                <div class="tag-btn" onclick="loadRecipe('찜')">찜</div>
                <div class="tag-btn" onclick="loadRecipe('탕')">탕/찌개</div>
                <div class="tag-btn" onclick="loadRecipe('면')">면요리</div>
            </div>
        </div>
        <div id="recipe-list"></div>
    </div>

    <div id="workspace-500" class="workspace">
        <div class="app-header"><button class="back-btn" onclick="goMain()">←</button><span class="header-title">매장 일정</span></div>
        <div id="schedule-list"></div>
        <div class="fab" onclick="openSchForm()">+</div>
        <div id="schedule-form" class="modal-overlay">
            <div class="modal-box">
                <div class="modal-title">일정 등록</div>
                <input type="hidden" id="sch-row">
                <input type="date" id="sch-date" class="form-input" style="margin-bottom:10px;">
                <select id="sch-type" class="form-input" style="margin-bottom:10px;"><option>휴무</option><option>예약</option><option>행사</option><option>기타</option></select>
                <input type="text" id="sch-content" class="form-input" placeholder="내용" style="margin-bottom:15px;">
                <div style="display:flex; gap:10px;"><button class="action-btn" style="flex:1; background:#ccc;" onclick="document.getElementById('schedule-form').style.display='none'">취소</button><button class="action-btn" style="flex:1;" onclick="saveSchedule()">저장</button></div>
            </div>
        </div>
    </div>

    <div id="workspace-600" class="workspace">
        <div class="app-header"><button class="back-btn" onclick="goMain()">←</button><span class="header-title">공지사항</span></div>
        <div id="notice-list"></div>
        <div class="fab" onclick="openNotForm()">+</div>
        <div id="notice-form" class="modal-overlay">
            <div class="modal-box">
                <div class="modal-title">공지 작성</div>
                <input type="hidden" id="not-row">
                <select id="not-type" class="form-input" style="margin-bottom:10px;"><option value="일반">일반</option><option value="필독">필독</option></select>
                <input type="text" id="not-title" class="form-input" placeholder="제목" style="margin-bottom:10px;">
                <textarea id="not-content" class="form-input" rows="4" placeholder="내용" style="margin-bottom:15px;"></textarea>
                <div style="display:flex; gap:10px;"><button class="action-btn" style="flex:1; background:#ccc;" onclick="document.getElementById('notice-form').style.display='none'">취소</button><button class="action-btn" style="flex:1;" onclick="saveNotice()">저장</button></div>
            </div>
        </div>
    </div>

    <div id="workspace-010" class="workspace">
        <div class="app-header"><button class="back-btn" onclick="goMain()">←</button><span class="header-title">자산/재고</span></div>
        <div class="console-box">
            <div class="mode-tabs">
                <button id="tab-in" class="mode-tab active" onclick="setMode('in')">매입</button>
                <button id="tab-out" class="mode-tab" onclick="setMode('out')">출고</button>
                <button id="tab-stock" class="mode-tab" onclick="setMode('stock')">재고</button>
            </div>
            <div id="input-area">
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" id="searchInput" class="form-input" placeholder="품목명 입력">
                    <button class="action-btn" id="searchBtn">찾기</button>
                </div>
                <div id="search-result" style="margin-bottom:10px;"></div>
                <div id="saved-list" style="padding:10px; text-align:center; color:#adb5bd; background:#f8f9fa; border-radius:8px; margin-bottom:10px;">비어있음</div>
                <button class="action-btn" style="width:100%;" onclick="saveToSheet()">저장</button>
            </div>
        </div>
        <div class="total-box"><div style="font-size:12px; opacity:0.8;">총 자산 가치</div><div id="asset-value" style="font-size:24px; font-weight:bold;">0 원</div></div>
        <div id="stock-list-area" style="margin:15px;"></div>
    </div>

    <div id="workspace-020" class="workspace">
        <div class="app-header"><button class="back-btn" onclick="goMain()">←</button><span class="header-title">손익 관리</span></div>
        <div style="text-align:center; padding:15px; background:white; font-weight:bold; font-size:18px;">
            <span onclick="changeMonth(-1)" style="cursor:pointer;">◀</span> <span id="cal-title" style="margin:0 15px;">2026.02</span> <span onclick="changeMonth(1)" style="cursor:pointer;">▶</span>
        </div>
        <div id="calendar-grid" class="cal-grid"></div>
        <div class="total-box">
            <div style="font-size:12px;">이번달 예상 순이익</div>
            <div id="fin-profit" style="font-size:28px; font-weight:bold;">0</div>
            <div style="font-size:12px; margin-top:5px;">매출: <span id="fin-current">0</span></div>
        </div>
        <div id="menu-cost-area" style="background:white; margin:15px; padding:15px; border-radius:12px;"></div>
        <div id="sales-modal" class="modal-overlay">
            <div class="modal-box">
                <div class="modal-title" id="modal-date-title"></div>
                <input type="number" id="modal-amount" class="form-input" placeholder="매출액 (숫자만)">
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button class="action-btn" style="flex:1; background:#ccc;" onclick="document.getElementById('sales-modal').style.display='none'">취소</button>
                    <button class="action-btn" style="flex:1;" onclick="saveSales()">저장</button>
                </div>
            </div>
        </div>
    </div>

    <div id="workspace-400" class="workspace">
        <div class="app-header"><button class="back-btn" onclick="goMain()">←</button><span class="header-title">연구노트</span></div>
        <div style="height:400px;"><iframe id="google-form-frame" style="width:100%; height:100%; border:none;"></iframe></div>
        <div style="padding:10px; text-align:right;"><button class="action-btn" onclick="loadRnD()">새로고침</button></div>
        <div id="rnd-list-area" style="padding:15px;"></div>
    </div>

    <div id="workspace-030" class="workspace"><div class="app-header"><button class="back-btn" onclick="goMain()">←</button><span class="header-title">직원 교육</span></div><div id="manual-list-area" style="padding:15px;"></div></div>
    <div id="workspace-900" class="workspace"><div class="app-header"><button class="back-btn" onclick="goMain()">←</button><span class="header-title">자료실</span></div><div id="archive-list-area" style="padding:15px;"></div></div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="goMain()"><i class="fas fa-home nav-icon"></i><span>홈</span></div>
        <div class="nav-item" onclick="openModule('100')"><i class="fas fa-book nav-icon"></i><span>레시피</span></div>
        <div class="nav-item" onclick="openModule('400')"><i class="fas fa-flask nav-icon"></i><span>연구</span></div>
        <div class="nav-item" onclick="openModule('900')"><i class="fas fa-folder nav-icon"></i><span>자료실</span></div>
        <div class="nav-item" onclick="openModule('010')"><i class="fas fa-bars nav-icon"></i><span>관리</span></div>
    </div>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSejJy628hEvS5_0QpukHJsFJF228YCEBgW0W6BDutfpjm-UDQ/viewform?embedded=true"; 
        
        let currentMode = 'in';

        /* --- 네비게이션 --- */
        function goMain() { document.querySelectorAll('.workspace').forEach(e=>e.style.display='none'); document.getElementById('main-view').style.display='block'; window.scrollTo(0,0); updateNav('홈'); }
        function openModule(code) {
            document.getElementById('main-view').style.display='none'; document.querySelectorAll('.workspace').forEach(e=>e.style.display='none');
            if(code==='010'){ document.getElementById('workspace-010').style.display='block'; loadAssetValueOnly(); setMode('in'); updateNav('관리'); }
            else if(code==='020'){ document.getElementById('workspace-020').style.display='block'; initCalendar(); updateNav('관리'); }
            else if(code==='100'){ 
                document.getElementById('workspace-100').style.display='block'; 
                document.getElementById('recipeInput').value = "";
                document.getElementById('recipe-list').innerHTML = "<div style='padding:40px 20px; text-align:center; color:#adb5bd; font-size:14px;'>위에서 분류를 선택하거나 검색해주세요.</div>";
                updateNav('레시피'); 
            }
            else if(code==='400'){ document.getElementById('workspace-400').style.display='block'; document.getElementById('google-form-frame').src=formUrl; loadRnD(); updateNav('연구'); }
            else if(code==='900'){ document.getElementById('workspace-900').style.display='block'; loadArchive(); updateNav('자료실'); }
            else if(code==='030'){ document.getElementById('workspace-030').style.display='block'; loadManual(); updateNav('홈'); }
            else if(code==='500'){ document.getElementById('workspace-500').style.display='block'; loadSchedule(); updateNav('홈'); }
            else if(code==='600'){ document.getElementById('workspace-600').style.display='block'; loadNotice(); updateNav('홈'); }
        }
        function updateNav(n){ document.querySelectorAll('.nav-item').forEach(b=>{ b.classList.remove('active'); if(b.querySelector('span').innerText===n) b.classList.add('active'); }); }

        /* --- [100] 레시피 (분류형) --- */
        document.getElementById('recipeInput').addEventListener('keypress', e => { if(e.key==='Enter') loadRecipe(document.getElementById('recipeInput').value); });
        function loadRecipe(keywordStr) {
            const area = document.getElementById('recipe-list');
            area.innerHTML = "<div style='padding:20px; text-align:center; color:#999;'>검색 중...</div>";
            fetch(`${gasUrl}?action=recipe&keyword=${encodeURIComponent(keywordStr)}`).then(r=>r.json()).then(l => {
                let h = `<ul class="slim-list">`;
                l.forEach((i, idx) => {
                    let imgHtml = "";
                    if (i.img && i.img.includes("http")) {
                        let src = i.img;
                        if (src.includes("drive.google.com")) { let m = src.match(/[-\w]{25,}/); if(m) src = `https://drive.google.com/uc?export=view&id=${m[0]}`; }
                        imgHtml = `<img src="${src}" class="detail-img">`;
                    }
                    let dStr = i.details.map(d => `<div class="detail-row"><span class="detail-label">${d.cat}</span><div class="detail-content">${d.text}</div></div>`).join("");
                    h += `<li class="slim-item">
                            <div class="slim-head" onclick="this.parentNode.classList.toggle('active')">
                                <div><span class="slim-title">${i.name}</span> <span class="slim-badge">${i.type}</span></div>
                                <i class="fas fa-chevron-down" style="color:#adb5bd;font-size:12px;"></i>
                            </div>
                            <div class="slim-body">${imgHtml}${dStr}</div>
                          </li>`;
                });
                h += `</ul>`;
                area.innerHTML = l.length ? h : "<div style='padding:30px 20px; text-align:center; color:#999;'>결과가 없습니다.</div>";
            });
        }

        /* --- [500] 일정 & [600] 공지 --- */
        function loadSchedule() { document.getElementById('schedule-list').innerHTML="<div style='text-align:center;padding:20px;'>로딩...</div>"; fetch(`${gasUrl}?action=get_schedule`).then(r=>r.json()).then(l => { let h=""; l.forEach(i=>{ h+=`<div style="padding:15px; border-bottom:1px solid #eee; background:white; display:flex; justify-content:space-between;"><div><span style="color:#e67e22;font-weight:bold;margin-right:10px;">${i.date.substring(5)}</span><b>${i.content}</b> <small style='color:#aaa'>${i.type}</small></div><div><i class="fas fa-edit" style="color:#ddd;margin-right:10px;cursor:pointer;" onclick="editSchedule('${i.row}','${i.date}','${i.type}','${i.content}')"></i><i class="fas fa-trash" style="color:#ddd;cursor:pointer;" onclick="deleteItem('일정관리','${i.row}')"></i></div></div>`; }); document.getElementById('schedule-list').innerHTML = h; }); }
        function openSchForm() { document.getElementById('schedule-form').style.display='flex'; document.getElementById('sch-row').value=""; document.getElementById('sch-content').value=""; }
        function editSchedule(r,d,t,c) { document.getElementById('schedule-form').style.display='flex'; document.getElementById('sch-row').value=r; document.getElementById('sch-date').value=d; document.getElementById('sch-type').value=t; document.getElementById('sch-content').value=c; }
        function saveSchedule() { const r=document.getElementById('sch-row').value, d=document.getElementById('sch-date').value, t=document.getElementById('sch-type').value, c=document.getElementById('sch-content').value; if(!d || !c) return alert("입력하세요"); fetch(`${gasUrl}?action=save_schedule&row=${r}&date=${d}&type=${t}&content=${c}`).then(()=>{ document.getElementById('schedule-form').style.display='none'; loadSchedule(); }); }
        
        function loadNotice() { document.getElementById('notice-list').innerHTML="<div style='text-align:center;padding:20px;'>로딩...</div>"; fetch(`${gasUrl}?action=get_notice`).then(r=>r.json()).then(l => { let h=`<ul class="slim-list">`; l.forEach(i=>{ let b=i.type==='필독'?'color:red':'color:#888'; h+=`<li class="slim-item"><div class="slim-head" onclick="this.parentNode.classList.toggle('active')"><div><span style="font-weight:bold;margin-right:5px;${b}">[${i.type}]</span> <b>${i.title}</b></div><span style="font-size:11px;color:#aaa;">${i.date}</span></div><div class="slim-body"><div style="white-space:pre-wrap;margin-bottom:10px;">${i.content}</div><div style="text-align:right;"><button class="action-btn" style="background:#eee;color:#333;padding:5px 10px;font-size:11px;" onclick="editNotice('${i.row}','${i.date}','${i.type}','${i.title}',\`${i.content.replace(/`/g,"\\`")}\`)">수정</button><button class="action-btn" style="background:white;border:1px solid #ddd;color:red;padding:5px 10px;font-size:11px;margin-left:5px;" onclick="deleteItem('공지사항','${i.row}')">삭제</button></div></div></li>`; }); document.getElementById('notice-list').innerHTML = h+`</ul>`; }); }
        function openNotForm() { document.getElementById('notice-form').style.display='flex'; document.getElementById('not-row').value=""; document.getElementById('not-title').value=""; document.getElementById('not-content').value=""; }
        function editNotice(r,d,t,ti,c) { document.getElementById('notice-form').style.display='flex'; document.getElementById('not-row').value=r; document.getElementById('not-type').value=t; document.getElementById('not-title').value=ti; document.getElementById('not-content').value=c; }
        function saveNotice() { const r=document.getElementById('not-row').value, t=document.getElementById('not-type').value, ti=document.getElementById('not-title').value, c=document.getElementById('not-content').value; if(!ti||!c) return alert("입력하세요"); const d=new Date().toISOString().split('T')[0]; fetch(`${gasUrl}?action=save_notice&row=${r}&date=${d}&type=${t}&title=${ti}&content=${encodeURIComponent(c)}`).then(()=>{ document.getElementById('notice-form').style.display='none'; loadNotice(); }); }
        function deleteItem(s, r) { if(confirm("삭제?")) { fetch(`${gasUrl}?action=delete_item&sheetName=${s}&row=${r}`).then(()=>{ if(s==='일정관리') loadSchedule(); else loadNotice(); }); } }

        /* --- [010] 자산 & [020] 손익 --- */
        function setMode(m) { currentMode=m; document.querySelectorAll('.mode-tab').forEach(t=>t.classList.remove('active')); document.getElementById('tab-'+m).classList.add('active'); if(m==='stock'){document.getElementById('input-area').style.display='none';loadStockTableSafe();}else{document.getElementById('input-area').style.display='block';loadAssetListSafe();} }
        function loadAssetValueOnly(){ fetch(`${gasUrl}?action=asset`).then(r=>r.json()).then(d=>{document.getElementById('asset-value').innerText=Number(d.total).toLocaleString()+" 원"}); }
        function loadAssetListSafe(){ if(currentMode==='stock')return; document.getElementById('stock-list-area').innerHTML="<div style='text-align:center;padding:20px;color:#adb5bd;'>로딩 중...</div>"; fetch(`${gasUrl}?action=asset`).then(r=>r.json()).then(d=>{if(currentMode==='stock')return; let h=`<table class="data-table"><thead><tr><th>품목</th><th style="text-align:right">금액</th></tr></thead><tbody>`; d.list.forEach(i=>h+=`<tr><td>${i.name}</td><td style="text-align:right;">${Number(i.value).toLocaleString()}</td></tr>`); document.getElementById('stock-list-area').innerHTML=h+"</tbody></table>"}); }
        function loadStockTableSafe(){ if(currentMode!=='stock')return; document.getElementById('stock-list-area').innerHTML="<div style='text-align:center;padding:20px;color:#adb5bd;'>로딩 중...</div>"; fetch(`${gasUrl}?action=inventory`).then(r=>r.json()).then(d=>{if(currentMode!=='stock')return; let h=`<table class="data-table"><thead><tr><th>품목</th><th style="text-align:right">수량</th></tr></thead><tbody>`; d.forEach(i=>h+=`<tr><td>${i.name}</td><td style="text-align:right;">${i.qty}</td></tr>`); document.getElementById('stock-list-area').innerHTML=h+"</tbody></table>"}); }
        
        let salesData={}, viewYear=new Date().getFullYear(), viewMonth=new Date().getMonth();
        function initCalendar(){ loadSalesData(); }
        function changeMonth(d){ viewMonth+=d; if(viewMonth>11){viewMonth=0;viewYear++;} else if(viewMonth<0){viewMonth=11;viewYear--;} renderCalendar(); calculateProfit(); }
        function loadSalesData(){ fetch(`${gasUrl}?action=get_sales`).then(r=>r.json()).then(d=>{ salesData={}; d.forEach(i=>{salesData[i.date]=i.amount}); renderCalendar(); calculateProfit(); loadMenuCost(); }); }
        function renderCalendar(){ const g=document.getElementById('calendar-grid'); g.innerHTML=""; const f=new Date(viewYear,viewMonth,1).getDay(), l=new Date(viewYear,viewMonth+1,0).getDate(); document.getElementById('cal-title').innerText=`${viewYear}.${(viewMonth+1).toString().padStart(2,'0')}`; ['일','월','화','수','목','금','토'].forEach(d=>g.innerHTML+=`<div style="font-size:12px;color:#adb5bd;padding-bottom:5px;">${d}</div>`); for(let i=0;i<f;i++)g.innerHTML+=`<div></div>`; for(let i=1;i<=l;i++){ let ds=`${viewYear}-${(viewMonth+1).toString().padStart(2,'0')}-${i.toString().padStart(2,'0')}`; let v=salesData[ds]?"●":"", t=(i===new Date().getDate()&&viewMonth===new Date().getMonth()&&viewYear===new Date().getFullYear())?"today":""; g.innerHTML+=`<div class="cal-day ${t}" onclick="openSalesModal('${ds}')"><div>${i}</div><div style="font-size:8px;color:#e67e22;">${v}</div></div>`; } }
        document.getElementById('modal-amount').addEventListener('keypress',e=>{if(e.key==='Enter')saveSales()});
        function openSalesModal(d){document.getElementById('modal-date-title').innerText=d; document.getElementById('modal-amount').value=salesData[d]||""; document.getElementById('sales-modal').style.display='flex'; setTimeout(()=>document.getElementById('modal-amount').focus(),100);}
        function saveSales(){const d=document.getElementById('modal-date-title').innerText, a=document.getElementById('modal-amount').value; salesData[d]=a; renderCalendar(); calculateProfit(); document.getElementById('sales-modal').style.display='none'; fetch(`${gasUrl}?action=save_sales&date=${d}&amount=${a}`);}
        function calculateProfit(){ const pf=`${viewYear}-${(viewMonth+1).toString().padStart(2,'0')}`; let t=0; for(let d in salesData)if(d.startsWith(pf))t+=Number(salesData[d]); document.getElementById('fin-current').innerText=t.toLocaleString(); fetch(`${gasUrl}?action=bep`).then(r=>r.json()).then(b=>{let v=Math.round(t*b.variableRatio), tc=b.fixed+v; document.getElementById('fin-profit').innerText=(t-tc).toLocaleString();}); }
        function loadMenuCost(){fetch(`${gasUrl}?action=menu_cost`).then(r=>r.json()).then(l=>{let h=`<table class="data-table"><thead><tr><th>메뉴</th><th style="text-align:right">원가율</th></tr></thead><tbody>`; l.forEach(i=>{let c=i.ratio>=35?"red":"green"; h+=`<tr><td>${i.name}</td><td style="text-align:right;font-weight:bold;color:${c}">${i.ratio}%</td></tr>`}); document.getElementById('menu-cost-area').innerHTML=h+"</tbody></table>"})}

        /* --- 검색 및 자산 입력 로직 --- */
        let workList=[];
        document.getElementById('searchBtn').addEventListener('click',()=>{const v=document.getElementById('searchInput').value; fetch(`${gasUrl}?action=search&item=${v}`).then(r=>r.json()).then(d=>{let h=""; d.forEach(i=>{h+=`<div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; font-size:13px; background:white;"><span>${i.name}</span><button onclick="addToList('${i.name}','${i.spec}','${i.unit}')" class="action-btn" style="padding:4px 8px; font-size:11px;">담기</button></div>`}); document.getElementById('search-result').innerHTML=h})});
        function addToList(n,s,u){workList.push({date:new Date().toISOString().split('T')[0],name:n,spec:s,unit:u,qty:1}); renderList();}
        function renderList(){let h=""; workList.forEach((i,idx)=>{h+=`<div style="display:flex; justify-content:space-between; font-size:13px; margin-bottom:5px;"><span>${i.name} 1${i.unit}</span><span onclick="workList.splice(${idx},1);renderList()" style="color:#e03131; cursor:pointer;">✕</span></div>`}); document.getElementById('saved-list').innerHTML=h||"비어있음";}
        function saveToSheet(){if(workList.length===0)return; fetch(`${gasUrl}?action=save&type=${currentMode}&data=${encodeURIComponent(JSON.stringify(workList))}`).then(()=>{alert("저장됨"); workList=[]; renderList();})}
        
        /* --- R&D, 교육, 자료실 --- */
        function loadRnD(){fetch(`${gasUrl}?action=rnd`).then(r=>r.json()).then(l=>{let p=""; l.slice(0,3).forEach(i=>p+=`<div onclick="openModule('400')" style="padding:12px 20px; border-bottom:1px solid #f1f3f5; cursor:pointer; background:white; font-size:13px; display:flex; justify-content:space-between;"><b>${i.menu}</b> <span style="color:#adb5bd; font-size:11px;">${i.date}</span></div>`); document.getElementById('recent-rnd').innerHTML=p; let h=""; l.forEach(i=>{let img=`<div style="width:80px;height:80px;background:#eee;border-radius:8px;margin-right:15px;flex-shrink:0;"></div>`; if(i.photo&&i.photo.match(/[-\w]{25,}/))img=`<img src="https://drive.google.com/uc?export=view&id=${i.photo.match(/[-\w]{25,}/)[0]}" style="width:80px;height:80px;border-radius:8px;margin-right:15px;object-fit:cover;flex-shrink:0;">`; h+=`<div style="background:white;padding:15px;border-radius:12px;margin-bottom:15px;box-shadow:0 2px 5px rgba(0,0,0,0.03);display:flex;">${img}<div><b>${i.menu}</b><div style="font-size:12px;color:#888;">${i.date}</div><div style="font-size:13px;margin-top:5px;">${i.note}</div></div></div>`}); document.getElementById('rnd-list-area').innerHTML=h})}
        function loadManual(){fetch(`${gasUrl}?action=manual`).then(r=>r.json()).then(l=>{let h=`<ul class="slim-list">`; l.forEach(i=>{let k=i.link?`<br><a href="${i.link}" target="_blank" style="color:#1971c2;">영상보기</a>`:""; h+=`<li class="slim-item"><div class="slim-head" onclick="this.parentNode.classList.toggle('active')"><span class="slim-title">${i.title}</span><i class="fas fa-chevron-down" style="color:#adb5bd;font-size:12px;"></i></div><div class="slim-body">${i.content}${k}</div></li>`}); document.getElementById('manual-list-area').innerHTML=h+`</ul>`})}
        function loadArchive(){fetch(`${gasUrl}?action=archive`).then(r=>r.json()).then(l=>{let h=""; l.forEach(f=>{let i="fa-file",c="#adb5bd"; if(f.type.includes("folder")){i="fa-folder";c="#f39c12";}else if(f.type.includes("image")){i="fa-image";c="#27ae60";} h+=`<a href="${f.url}" target="_blank" style="display:flex;padding:15px;border-bottom:1px solid #f1f3f5;align-items:center;text-decoration:none;color:#343a40;background:white;"><div style="font-size:24px;color:${c};margin-right:15px;width:30px;text-align:center;"><i class="fas ${i}"></i></div><div style="flex:1;"><div style="font-weight:500;font-size:14px;">${f.name}</div><div style="font-size:11px;color:#adb5bd;">${f.date}</div></div><i class="fas fa-chevron-right" style="color:#dee2e6;"></i></a>`}); document.getElementById('archive-list-area').innerHTML=h})}
        
        document.addEventListener("DOMContentLoaded",()=>loadRnD());
    </script>
</body>
</html>
