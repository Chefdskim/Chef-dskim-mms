<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef_dskim SYSTEM</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        #search-section { margin-top: 20px; padding: 15px; border: 2px solid #2c3e50; border-radius: 8px; }
        .search-box { display: flex; gap: 5px; margin-top: 10px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        .action-btn { padding: 10px 20px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        
        /* ê²°ê³¼ ë° ì €ì¥ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” */
        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; }
        th { background: #f8f9fa; }
        
        .save-section { margin-top: 30px; padding-top: 20px; border-top: 2px dashed #ccc; }
        .add-btn { background: #27ae60; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .date-tag { font-size: 11px; color: #7f8c8d; }
    </style>
</head>
<body>

    <div class="container">
        <h2>010 ì›ê°€_ë§¤ì…ê´€ë¦¬</h2>

        <div id="search-section">
            <strong>í’ˆëª© ê²€ìƒ‰ (Enter ì§€ì›)</strong>
            <div class="search-box">
                <input type="text" id="itemName" placeholder="í’ˆëª©ëª… ì…ë ¥ í›„ ì—”í„°" onkeypress="if(event.keyCode==13) runSearch()">
                <button class="action-btn" onclick="runSearch()">ê²€ìƒ‰</button>
            </div>
            <div id="result-list"></div>
        </div>

        <div class="save-section">
            <strong>ğŸ“‹ ì˜¤ëŠ˜ì˜ ë§¤ì… ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸</strong>
            <div id="saved-list">
                <p style="color: #999; font-size: 12px; margin-top: 10px;">ì¶”ê°€ëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            <button onclick="clearSaved()" style="margin-top:10px; font-size:11px; color:red; background:none; border:none; cursor:pointer;">ì „ì²´ ì‚­ì œ</button>
        </div>
    </div>

    <script>
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        let savedItems = JSON.parse(localStorage.getItem('myPurchaseList')) || [];

        window.onload = displaySaved;

        function runSearch() {
            const val = document.getElementById('itemName').value;
            if(!val) return;
            const resDiv = document.getElementById('result-list');
            resDiv.innerHTML = "ì°¾ëŠ” ì¤‘...";

            fetch(`${gasUrl}?item=${encodeURIComponent(val)}`)
                .then(res => res.json())
                .then(data => {
                    if (data.length === 0) { resDiv.innerHTML = "<p>ê²°ê³¼ ì—†ìŒ</p>"; return; }
                    let html = '<table>';
                    data.forEach(item => {
                        html += `<tr>
                            <td>${item.name}<br><small>${item.spec}</small></td>
                            <td><button class="add-btn" onclick="addItem('${item.name}', '${item.spec}', '${item.unit}')">ì¶”ê°€</button></td>
                        </tr>`;
                    });
                    html += '</table>';
                    resDiv.innerHTML = html;
                });
        }

        // ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ (ë‚ ì§œ í¬í•¨)
        function addItem(name, spec, unit) {
            const date = new Date().toLocaleDateString();
            savedItems.push({ date, name, spec, unit });
            localStorage.setItem('myPurchaseList', JSON.stringify(savedItems));
            displaySaved();
        }

        // ì €ì¥ëœ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
        function displaySaved() {
            const listDiv = document.getElementById('saved-list');
            if (savedItems.length === 0) {
                listDiv.innerHTML = '<p style="color:#999; font-size:12px; margin-top:10px;">ì¶”ê°€ëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            let html = '<table><tr><th>ë‚ ì§œ</th><th>í’ˆëª©</th><th>ë‹¨ìœ„</th></tr>';
            savedItems.forEach(item => {
                html += `<tr>
                    <td class="date-tag">${item.date}</td>
                    <td>${item.name}<br><small>${item.spec}</small></td>
                    <td>${item.unit}</td>
                </tr>`;
            });
            html += '</table>';
            listDiv.innerHTML = html;
        }

        function clearSaved() {
            if(confirm("ë¦¬ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ë¹„ìš¸ê¹Œìš”?")) {
                savedItems = [];
                localStorage.removeItem('myPurchaseList');
                displaySaved();
            }
        }
    </script>
</body>
</html>
