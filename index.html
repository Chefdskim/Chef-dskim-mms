<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chef_dskim SYSTEM</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        
        /* [ë©”ì¸ ë©”ë‰´ ë²„íŠ¼ ìŠ¤íƒ€ì¼] */
        .main-btn { 
            width: 100%; padding: 20px; margin-bottom: 15px; 
            font-size: 16px; font-weight: bold; 
            border: 1px solid #ccc; border-radius: 8px; 
            background: #fff; cursor: pointer; text-align: left; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .main-btn:hover { background-color: #f9f9f9; border-color: #bbb; }
        .code-tag { color: #888; font-size: 12px; display: block; margin-bottom: 5px; }

        /* [ì„œë¸Œ ë©”ë‰´ ìŠ¤íƒ€ì¼ (000 í•˜ìœ„)] */
        #submenu-000 { 
            display: none; 
            background-color: #f8f9fa; 
            margin-top: -10px; margin-bottom: 15px; 
            border: 1px solid #ddd; border-top: none; 
            border-radius: 0 0 8px 8px; 
            padding: 5px;
        }
        .sub-btn { 
            width: 100%; padding: 15px; 
            border: none; border-bottom: 1px solid #eee; 
            background: none; text-align: left; cursor: pointer; 
            font-size: 15px; color: #555;
        }
        .sub-btn:last-child { border-bottom: none; }
        .sub-btn:hover { background-color: #e9ecef; color: #333; font-weight: bold; }

        /* [010 ì‘ì—… í™”ë©´ ìŠ¤íƒ€ì¼] */
        #workspace-010 { display: none; } /* ì´ˆê¸°ì—” ìˆ¨ê¹€ */
        
        .search-box { display: flex; gap: 5px; margin-bottom: 15px; }
        input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        input[type="number"] { width: 50px; padding: 5px; border: 1px solid #ddd; text-align: center; }
        
        .action-btn { padding: 10px 20px; background: #2c3e50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; vertical-align: middle; }
        th { background: #f1f1f1; }
        
        .save-btn { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 8px; margin-top: 20px; font-weight: bold; cursor: pointer; }
        .back-btn { background: none; border: none; color: #e74c3c; cursor: pointer; text-decoration: underline; margin-bottom: 15px; font-size: 14px; }
    </style>
</head>
<body>

    <div class="container">
        <h2 id="page-title">MAIN MENU</h2>

        <div id="main-nav">
            
            <button class="main-btn" onclick="toggleSubMenu()">
                <span class="code-tag">000</span>
                ê¸°ì¤€ì •ë³´ (ADMIN) â–¼
            </button>
            
            <div id="submenu-000">
                <button class="sub-btn" onclick="openWorkspace()">
                    010 ì›ê°€_ë§¤ì…ê´€ë¦¬
                </button>
                <button class="sub-btn" onclick="alert('020 ì¤€ë¹„ ì¤‘')">
                    020 ì‚¬ì—…ê¸°íš_ìš´ì˜
                </button>
                <button class="sub-btn" onclick="alert('030 ì¤€ë¹„ ì¤‘')">
                    030 ì§ì›êµìœ¡
                </button>
            </div>

            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')">
                <span class="code-tag">100~300</span>
                êµ­ê°€ë³„ ìš”ë¦¬ (CUISINE)
            </button>

            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')">
                <span class="code-tag">400</span>
                ì‹¬í™” ì—°êµ¬ (R&D / DEEP DIVE)
            </button>

            <button class="main-btn" onclick="alert('ì¤€ë¹„ ì¤‘')">
                <span class="code-tag">900</span>
                ìë£Œì‹¤ (ARCHIVE)
            </button>
        </div>

        <div id="workspace-010">
            <button class="back-btn" onclick="goBackMain()">â—€ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="í’ˆëª©ëª… ì…ë ¥ (ì˜ˆ: ëŒ€ê²Œ)">
                <button class="action-btn" id="searchBtn">ê²€ìƒ‰</button>
            </div>

            <div id="result-list"></div>

            <div style="margin-top:30px; border-top:2px solid #eee; padding-top:15px;">
                <strong>ğŸ“‹ ë§¤ì… ë¦¬ìŠ¤íŠ¸ (ìˆ˜ëŸ‰ ì…ë ¥)</strong>
                <div id="saved-list"></div>
                <button id="send-btn" class="save-btn" onclick="saveToSheet()" style="display:none;">ë§¤ì…ì¥ ì‹œíŠ¸ë¡œ ì „ì†¡</button>
            </div>
        </div>

    </div>

    <script>
        // ì…°í”„ë‹˜ì˜ ìµœì‹  GAS URL
        const gasUrl = "https://script.google.com/macros/s/AKfycbwtNgSrgkjEiaJm4bPIXjddIlU19IYUCgZvx6WIRPLCCar7QndBmiEG-EIaRk3yXLUa/exec";
        
        let purchaseList = [];

        // í™”ë©´ ë¡œë“œ í›„ ì—”í„°í‚¤ ì´ë²¤íŠ¸ ê°•ì œ ë°”ì¸ë”© (í™•ì‹¤í•œ ë°©ë²•)
        document.addEventListener("DOMContentLoaded", function() {
            const input = document.getElementById("searchInput");
            const btn = document.getElementById("searchBtn");

            // ì—”í„°í‚¤ ëˆ„ë¥´ë©´ ë²„íŠ¼ í´ë¦­ íš¨ê³¼
            input.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    btn.click();
                }
            });

            // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰
            btn.addEventListener("click", runSearch);
        });

        // [í™”ë©´ ì „í™˜ ë¡œì§]
        function toggleSubMenu() {
            const sub = document.getElementById('submenu-000');
            sub.style.display = (sub.style.display === 'block') ? 'none' : 'block';
        }

        function openWorkspace() {
            document.getElementById('main-nav').style.display = 'none';
            document.getElementById('workspace-010').style.display = 'block';
            document.getElementById('page-title').innerText = "010 ì›ê°€_ë§¤ì…ê´€ë¦¬";
            // í™”ë©´ ì—´ë¦¬ë©´ ì…ë ¥ì°½ì— ë°”ë¡œ í¬ì»¤ìŠ¤
            document.getElementById('searchInput').focus();
        }

        function goBackMain() {
            document.getElementById('workspace-010').style.display = 'none';
            document.getElementById('main-nav').style.display = 'block';
            document.getElementById('page-title').innerText = "MAIN MENU";
            // ì´ˆê¸°í™”
            document.getElementById('result-list').innerHTML = "";
            document.getElementById('searchInput').value = "";
        }

        // [ê¸°ëŠ¥ ë¡œì§]
        function runSearch() {
            const val = document.getElementById('searchInput').value;
            if(!val) return;
            
            const resDiv = document.getElementById('result-list');
            resDiv.innerHTML = "ê²€ìƒ‰ ì¤‘...";

            fetch(`${gasUrl}?action=search&item=${encodeURIComponent(val)}`)
                .then(res => res.json())
                .then(data => {
                    if (data.length === 0) {
                        resDiv.innerHTML = "<p style='color:red'>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                        return;
                    }
                    let html = '<table>';
                    data.forEach(item => {
                        html += `<tr>
                            <td>${item.name}<br><small style='color:#888'>${item.spec}</small></td>
                            <td style='text-align:right'>
                                <button class="action-btn" style="padding:5px 10px; font-size:12px;" 
                                onclick="addToList('${item.name}','${item.spec}','${item.unit}')">ì¶”ê°€</button>
                            </td>
                        </tr>`;
                    });
                    resDiv.innerHTML = html + '</table>';
                })
                .catch(err => {
                    resDiv.innerHTML = "ì˜¤ë¥˜ ë°œìƒ: " + err;
                });
        }

        function addToList(name, spec, unit) {
            const date = new Date().toISOString().split('T')[0];
            purchaseList.push({ date, name, spec, unit, qty: 1 });
            renderList();
        }

        function updateQty(index, val) {
            purchaseList[index].qty = val;
        }

        function renderList() {
            const listDiv = document.getElementById('saved-list');
            if (purchaseList.length === 0) {
                listDiv.innerHTML = "";
                document.getElementById('send-btn').style.display = 'none';
                return;
            }

            let html = '<table><tr><th>í’ˆëª©</th><th>ìˆ˜ëŸ‰</th></tr>';
            purchaseList.forEach((item, index) => {
                html += `<tr>
                    <td>${item.name}<br><small>${item.date}</small></td>
                    <td>
                        <input type="number" value="${item.qty}" min="0" 
                        onchange="updateQty(${index}, this.value)"> ${item.unit}
                    </td>
                </tr>`;
            });
            listDiv.innerHTML = html + '</table>';
            document.getElementById('send-btn').style.display = 'block';
        }

        function saveToSheet() {
            if(!confirm("ë§¤ì…ì¥ì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            
            const btn = document.getElementById('send-btn');
            btn.innerText = "ì €ì¥ ì¤‘...";
            btn.disabled = true;

            fetch(`${gasUrl}?action=save&data=${encodeURIComponent(JSON.stringify(purchaseList))}`)
                .then(res => res.text())
                .then(text => {
                    alert("ë§¤ì…ì¥ì— ì„±ê³µì ìœ¼ë¡œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    purchaseList = []; // ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
                    renderList();
                    btn.innerText = "ë§¤ì…ì¥ ì‹œíŠ¸ë¡œ ì „ì†¡";
                    btn.disabled = false;
                })
                .catch(err => {
                    alert("ì €ì¥ ì‹¤íŒ¨: " + err);
                    btn.innerText = "ë§¤ì…ì¥ ì‹œíŠ¸ë¡œ ì „ì†¡";
                    btn.disabled = false;
                });
        }
    </script>
</body>
</html>
